<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Oracle - Ultimate Horoscope Application</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tab-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab-button.active {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #1e3c72;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .zodiac-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .zodiac-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .zodiac-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-5px);
        }

        .zodiac-card.selected {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
        }

        .zodiac-symbol {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .calendar-nav {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .calendar-day.today {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #1e3c72;
            font-weight: bold;
        }

        .calendar-day.has-event {
            border: 2px solid #ffd700;
        }
        
        .calendar-day.selected-date {
            background: rgba(255, 215, 0, 0.4);
            border: 2px solid #ffd700;
        }


        .day-of-week {
            font-weight: bold;
            padding: 10px;
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
        }

        .horoscope-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .sign-combination {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .sign-selector {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }

        .sign-selector select, .sign-selector input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #1e3c72;
            font-weight: bold;
        }

        .interpretation {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .interpretation ul, .interpretation ol {
            margin-left: 20px;
            padding-left: 10px;
        }
        .interpretation li {
            margin-bottom: 8px;
        }


        .compatibility-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .compatibility-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .compatibility-score {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .moon-phase {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .moon-visual {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #f0f0f0; /* Default color, will be updated by JS */
            position: relative;
            margin-right: 20px;
            box-shadow: inset -10px 0px 10px rgba(0,0,0,0.3); /* Simulates shadow */
        }


        .search-bar {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            color: #1e3c72;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .knowledge-section {
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #ffd700;
        }
         .knowledge-section.hidden-by-search {
            display: none;
        }


        .knowledge-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ffd700;
        }

        .element-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .element-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }

        .daily-insight {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 170, 0, 0.2));
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .tarot-card {
            width: 120px;
            height: 180px;
            background: linear-gradient(135deg, #4a148c, #7b1fa2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin: 10px;
            border: 2px solid #ffd700;
            color: white; /* Default text color for unrevealed card */
        }

        .tarot-card:hover {
            transform: scale(1.05);
        }

        .tarot-spread {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .birth-chart {
            width: 300px;
            height: 300px;
            border: 3px solid #ffd700;
            border-radius: 50%;
            position: relative;
            margin: 20px auto;
            background: radial-gradient(circle, rgba(255,215,0,0.1), rgba(255,215,0,0.05));
        }

        .chart-house { /* Style for house lines */
            position: absolute;
            width: 50%;
            height: 50%;
            top: 50%; /* Center origin */
            left: 50%; /* Center origin */
            transform-origin: 0% 0%; /* Rotate from top-left of this div */
            border-left: 1px solid rgba(255, 215, 0, 0.3); /* Line going outwards */
        }
        .chart-house .house-number { /* Style for house numbers */
            position: absolute;
            font-size: 0.7rem;
            color: rgba(255,255,255,0.6);
            /* Positioning logic will be complex and done in JS or require more divs */
        }
        .chart-planet { /* Style for planets */
            position: absolute;
            font-size: 1rem;
            color: #ffd700;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            padding: 2px;
        }


        .numerology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .numerology-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .biorhythm-chart {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.2); /* Darker background for contrast */
            border-radius: 10px;
            position: relative;
            margin: 20px 0;
            padding: 10px;
        }
        .biorhythm-chart canvas {
            display: block; /* Remove extra space below canvas */
        }


        .crystal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .crystal-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .crystal-card:hover {
            border-color: #ffd700;
            transform: translateY(-5px);
        }

        .planet-tracker {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .planet-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .chakra-wheel {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 20px auto;
            position: relative;
            background: conic-gradient(from 0deg, 
                #FF0000 0% 14.28%,  /* Root */
                #FF7F00 14.28% 28.56%, /* Sacral */
                #FFFF00 28.56% 42.84%, /* Solar Plexus */
                #00FF00 42.84% 57.12%, /* Heart */
                #0000FF 57.12% 71.4%,  /* Throat */
                #4B0082 71.4% 85.68%, /* Third Eye */
                #9400D3 85.68% 100%   /* Crown */
            );
            border: 3px solid white;
        }


        .meditation-timer {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            color: #ffd700;
        }

        .journal-entry {
            background: rgba(255, 255, 255, 0.05); /* Slightly less prominent */
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 3px solid rgba(255,215,0,0.5);
        }
        #savedEntries .journal-entry p:first-child {
            font-weight: bold;
            color: #ffd700;
        }


        .dream-symbols {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* Smaller cards */
            gap: 10px;
            margin: 20px 0;
        }

        .symbol-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .symbol-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .energy-meter {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .energy-bar {
            height: 100%;
            /* background will be set by JS */
            transition: width 0.5s ease, background 0.5s ease;
        }

        .ritual-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffd700;
        }
        .ritual-card h4 { color: #ffaa00; }


        .mantra-player {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .affirmation-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 170, 0, 0.2));
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        #dailyAffirmation {
            font-size: 1.1rem;
            min-height: 40px; /* Ensure space even before generation */
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-tabs {
                overflow-x: auto; 
                flex-wrap: nowrap;
                justify-content: flex-start;
                padding-bottom: 10px; 
            }
            
            .tab-button {
                flex-shrink: 0; 
                white-space: nowrap;
            }
            
            .zodiac-selector {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); 
            }
            
            .sign-combination {
                grid-template-columns: 1fr;
            }

            .birth-chart {
                width: 250px;
                height: 250px;
            }
            .chart-planet { font-size: 0.8rem; }


            .tarot-card {
                width: 80px;
                height: 120px;
                font-size: 1.5rem;
            }
             .numerology-grid {
                grid-template-columns: 1fr; 
            }
            .crystal-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            .planet-tracker {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
             .timer-display {
                font-size: 2.5rem;
            }

        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üåü COSMIC ORACLE üåü</div>
            <p>The Ultimate Horoscope Experience - Every Sign, Every Combination, Every Detail</p>
            <div id="currentDateTime"></div>
        </div>

        <div class="nav-tabs">
            <button class="tab-button active" onclick="showTab('daily', event)">Daily Horoscope</button>
            <button class="tab-button" onclick="showTab('calendar', event)">Cosmic Calendar</button>
            <button class="tab-button" onclick="showTab('combinations', event)">Sign Combinations</button>
            <button class="tab-button" onclick="showTab('compatibility', event)">Compatibility</button>
            <button class="tab-button" onclick="showTab('knowledge', event)">Zodiac Knowledge</button>
            <button class="tab-button" onclick="showTab('moon-sun', event)">Moon & Sun Analysis</button>
            <button class="tab-button" onclick="showTab('tarot', event)">Tarot Reading</button>
            <button class="tab-button" onclick="showTab('birth-chart', event)">Birth Chart</button>
            <button class="tab-button" onclick="showTab('numerology', event)">Numerology</button>
            <button class="tab-button" onclick="showTab('crystals', event)">Crystal Guide</button>
            <button class="tab-button" onclick="showTab('planets', event)">Planet Tracker</button>
            <button class="tab-button" onclick="showTab('chakras', event)">Chakra Analysis</button>
            <button class="tab-button" onclick="showTab('meditation', event)">Meditation</button>
            <button class="tab-button" onclick="showTab('journal', event)">Cosmic Journal</button>
            <button class="tab-button" onclick="showTab('dreams', event)">Dream Analysis</button>
            <button class="tab-button" onclick="showTab('rituals', event)">Sacred Rituals</button>
            <button class="tab-button" onclick="showTab('biorhythms', event)">Biorhythms</button>
        </div>

        <!-- Daily Horoscope Tab -->
        <div id="daily" class="tab-content active">
            <h2>Daily Horoscope</h2>
            <div class="zodiac-selector" id="zodiacSelector">
                <!-- Zodiac signs will be populated by JavaScript -->
            </div>
            <div class="daily-insight" id="dailyInsight">
                <h3>Select your zodiac sign to see today's cosmic forecast</h3>
            </div>
            <div class="daily-insight">
                <h3>Today's Cosmic Weather</h3>
                <div id="cosmicWeather">Loading cosmic weather...</div>
            </div>
    
            <!-- Add tab for Life Path Compatibility -->
            <button class="tab-button" data-tab="lifePathCompatibility">
                Life Path Compatibility
            </button>
    
            <!-- Life Path Compatibility Section -->
            <div id="lifePathCompatibility" class="tab-content">
                <div class="cosmic-card">
                    <h2>Life Path Number Compatibility Calculator</h2>
                    <div class="compatibility-form">
                        <div class="date-input-group">
                            <label for="birthDate1">First Birth Date:</label>
                            <input type="date" id="birthDate1" required>
                        </div>
                        <div class="date-input-group">
                            <label for="birthDate2">Second Birth Date:</label>
                            <input type="date" id="birthDate2" required>
                        </div>
                        <button id="calculateCompatibility" class="cosmic-button">Calculate Compatibility</button>
                    </div>
                    <div id="compatibilityResult" class="compatibility-result" style="display: none;">
                        <div class="life-path-numbers">
                            <div class="life-path-box">
                                <h3>Life Path 1</h3>
                                <span class="number"></span>
                            </div>
                            <div class="compatibility-score">
                                <div class="score-circle">
                                    <span class="score-number"></span>
                                </div>
                            </div>
                            <div class="life-path-box">
                                <h3>Life Path 2</h3>
                                <span class="number"></span>
                            </div>
                        </div>
                        <div class="compatibility-details">
                            <h3>Interaction Type</h3>
                            <p class="interaction-type"></p>
                            
                            <h3>Summary</h3>
                            <p class="compatibility-summary"></p>
                            
                            <h3>Key Strengths</h3>
                            <ul class="key-strengths"></ul>
                            
                            <h3>Potential Challenges</h3>
                            <ul class="potential-challenges"></ul>
                            
                            <h3>Advice</h3>
                            <p class="compatibility-advice"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content">
            <h2>Cosmic Calendar</h2>
            <div class="calendar-header">
                <button class="calendar-nav" onclick="changeMonth(-1)">‚Üê Previous</button>
                <h3 id="currentMonth"></h3>
                <button class="calendar-nav" onclick="changeMonth(1)">Next ‚Üí</button>
            </div>
            <div class="calendar" id="calendarGrid"> 
                <!-- Calendar will be populated by JavaScript -->
            </div>
            <div class="moon-phase">
                <div class="moon-visual" id="moonPhaseVisual"></div> 
                <div>
                    <h4>Current Moon Phase</h4>
                    <p id="moonPhaseText"></p>
                    <p id="moonInfluence"></p>
                </div>
            </div>
            <div class="horoscope-content">
                <h3>Cosmic Events This Month (Simulated)</h3>
                <div id="cosmicEvents">Loading cosmic events...</div>
            </div>
             <div class="interpretation" id="selectedDateInfo" style="margin-top: 20px;">
                Select a date to see specific influences.
            </div>
        </div>

        <!-- Sign Combinations Tab -->
        <div id="combinations" class="tab-content">
            <h2>Complete Sign Combination Analysis</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="sunSign">Sun Sign:</label>
                    <select id="sunSign" onchange="updateCombination()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
                <div class="sign-selector">
                    <label for="moonSign">Moon Sign:</label>
                    <select id="moonSign" onchange="updateCombination()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
                <div class="sign-selector">
                    <label for="risingSign">Rising Sign:</label>
                    <select id="risingSign" onchange="updateCombination()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
            </div>
            <div class="interpretation" id="combinationResult">
                <p>Select your sun, moon, and rising signs to see your complete astrological profile.</p>
            </div>
        </div>

        <!-- Compatibility Tab -->
        <div id="compatibility" class="tab-content">
            <h2>Zodiac Compatibility Matrix</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="compatSign1">Your Sign:</label>
                    <select id="compatSign1" onchange="updateCompatibility()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
                <div class="sign-selector">
                    <label for="compatSign2">Partner's Sign:</label>
                    <select id="compatSign2" onchange="updateCompatibility()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
            </div>
            <div class="compatibility-grid" id="compatibilityResults">
                <!-- Compatibility results will be shown here -->
            </div>
        </div>

        <!-- Knowledge Tab -->
        <div id="knowledge" class="tab-content">
            <h2>Complete Zodiac Knowledge Base</h2>
            <input type="text" class="search-bar" placeholder="Search zodiac knowledge..." id="searchBar" oninput="searchKnowledge()">
            <div id="knowledgeContent">
                <!-- Knowledge content will be populated by JavaScript -->
            </div>
        </div>

        <!-- Moon & Sun Analysis Tab -->
        <div id="moon-sun" class="tab-content">
            <h2>Moon & Sun Sign Analysis</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="sunAnalysis">Sun Sign:</label>
                    <select id="sunAnalysis" onchange="updateMoonSunAnalysis()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
                <div class="sign-selector">
                    <label for="moonAnalysis">Moon Sign:</label>
                    <select id="moonAnalysis" onchange="updateMoonSunAnalysis()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
            </div>
            <div class="interpretation" id="moonSunResult">
                <p>Select your sun and moon signs to understand how they interact and influence your personality.</p>
            </div>
        </div>

        <!-- Tarot Reading Tab -->
        <div id="tarot" class="tab-content">
            <h2>Divine Tarot Reading</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="tarotSpread">Reading Type:</label>
                    <select id="tarotSpread" onchange="setupTarotReading()">
                        <option value="single">Single Card</option>
                        <option value="three">Past-Present-Future</option>
                        <option value="celtic">Celtic Cross (10 cards)</option>
                        <option value="love">Love Reading (5 cards)</option>
                        <option value="career">Career Reading (4 cards)</option>
                    </select>
                </div>
            </div>
            <div class="tarot-spread" id="tarotCards">
                <!-- Tarot cards will appear here -->
            </div>
            <div class="interpretation" id="tarotInterpretation">
                <p>Select a reading type and click on the cards to reveal your divine guidance.</p>
            </div>
        </div>

        <!-- Birth Chart Tab -->
        <div id="birth-chart" class="tab-content">
            <h2>Natal Birth Chart Analysis</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="birthDateInput">Birth Date:</label> 
                    <input type="date" id="birthDateInput" onchange="generateBirthChart()">
                </div>
                <div class="sign-selector">
                    <label for="birthTimeInput">Birth Time:</label> 
                    <input type="time" id="birthTimeInput" onchange="generateBirthChart()">
                </div>
                <div class="sign-selector">
                    <label for="birthLocationInput">Birth Location:</label> 
                    <input type="text" id="birthLocationInput" placeholder="City, Country" onchange="generateBirthChart()">
                </div>
            </div>
            <div class="birth-chart" id="birthChartWheel">
                <!-- Birth chart wheel will be generated here -->
            </div>
            <div class="interpretation" id="birthChartAnalysis">
                <p>Enter your birth details to generate your (simulated) natal chart and cosmic blueprint.</p>
            </div>
        </div>

        <!-- Numerology Tab -->
        <div id="numerology" class="tab-content">
            <h2>Sacred Numerology Analysis</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="fullName">Full Name:</label>
                    <input type="text" id="fullName" placeholder="Your full birth name" onchange="calculateNumerology()">
                </div>
                <div class="sign-selector">
                    <label for="numerologyBirthDate">Birth Date:</label>
                    <input type="date" id="numerologyBirthDate" onchange="calculateNumerology()">
                </div>
            </div>
            <div class="numerology-grid" id="numerologyResults">
                <!-- Numerology results will appear here -->
            </div>
            <div class="interpretation" id="numerologyInterpretation">
                <p>Enter your name and birth date to discover your sacred numbers and their meanings.</p>
            </div>
        </div>

        <!-- Crystals Tab -->
        <div id="crystals" class="tab-content">
            <h2>Crystal Healing & Guidance</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="crystalSign">Your Zodiac Sign:</label>
                    <select id="crystalSign" onchange="updateCrystalGuidance()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
                <div class="sign-selector">
                    <label for="crystalNeed">Current Need:</label>
                    <select id="crystalNeed" onchange="updateCrystalGuidance()">
                        <option value="protection">Protection</option>
                        <option value="love">Love & Relationships</option>
                        <option value="abundance">Abundance & Prosperity</option>
                        <option value="healing">Physical Healing</option>
                        <option value="intuition">Intuition & Psychic Abilities</option>
                        <option value="clarity">Mental Clarity</option>
                        <option value="grounding">Grounding & Stability</option>
                        <option value="confidence">Confidence & Courage</option>
                    </select>
                </div>
            </div>
            <div class="crystal-grid" id="crystalRecommendations">
                <!-- Crystal recommendations will appear here -->
            </div>
        </div>

        <!-- Planet Tracker Tab -->
        <div id="planets" class="tab-content">
            <h2>Planetary Movements & Influences (Simulated Daily)</h2>
            <div class="planet-tracker" id="planetPositions">
                <!-- Planet positions will be shown here -->
            </div>
            <div class="interpretation" id="planetaryInfluences">
                <h3>Current Planetary Influences</h3>
                <!-- Content added by JS -->
            </div>
            <div id="retrogradeAlert" style="margin-top: 20px;">
                <!-- Retrograde alerts will be shown here -->
            </div>
        </div>

        <!-- Chakras Tab -->
        <div id="chakras" class="tab-content">
            <h2>Chakra Analysis & Healing</h2>
            <div class="chakra-wheel" id="chakraWheelDisplay"></div> 
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="chakraSelect">Focus Chakra:</label>
                    <select id="chakraSelect" onchange="updateChakraInfo()">
                        <option value="root">Root Chakra (Muladhara)</option>
                        <option value="sacral">Sacral Chakra (Svadhisthana)</option>
                        <option value="solar">Solar Plexus Chakra (Manipura)</option>
                        <option value="heart">Heart Chakra (Anahata)</option>
                        <option value="throat">Throat Chakra (Vishuddha)</option>
                        <option value="third-eye">Third Eye Chakra (Ajna)</option>
                        <option value="crown">Crown Chakra (Sahasrara)</option>
                    </select>
                </div>
            </div>
            <div class="interpretation" id="chakraInfo">
                <p>Select a chakra to learn about its properties, healing methods, and current state.</p>
            </div>
        </div>

        <!-- Meditation Tab -->
        <div id="meditation" class="tab-content">
            <h2>Guided Cosmic Meditation</h2>
            <div class="meditation-timer">
                <h3>Meditation Timer</h3>
                <div class="timer-display" id="timerDisplay">00:00</div>
                <div class="sign-combination">
                    <div class="sign-selector">
                        <label for="meditationDuration">Duration:</label>
                        <select id="meditationDuration">
                            <option value="1">1 minute</option>
                            <option value="5">5 minutes</option>
                            <option value="10">10 minutes</option>
                            <option value="15">15 minutes</option>
                            <option value="20">20 minutes</option>
                            <option value="30">30 minutes</option>
                        </select>
                    </div>
                    <div class="sign-selector">
                        <label for="meditationType">Type:</label>
                        <select id="meditationType" onchange="updateMeditation()">
                            <option value="mindfulness">Mindfulness</option>
                            <option value="chakra">Chakra Balancing</option>
                            <option value="manifestation">Manifestation</option>
                            <option value="healing">Energy Healing</option>
                            <option value="zodiac">Zodiac Meditation</option>
                        </select>
                    </div>
                </div>
                <button onclick="startMeditation()" style="background: #ffd700; color: #1e3c72; border: none; padding: 15px 30px; border-radius: 25px; font-weight: bold; cursor: pointer; margin: 10px;">Start Meditation</button>
            </div>
            <div class="interpretation" id="meditationGuidance" style="margin-top: 20px;">
                 <!-- Meditation guidance will appear here -->
            </div>
            <div class="mantra-player">
                <h3>Sacred Mantras</h3>
                <div id="mantraList">
                    <!-- Mantras will be populated here -->
                </div>
            </div>
        </div>

        <!-- Journal Tab -->
        <div id="journal" class="tab-content">
            <h2>Cosmic Journal & Reflections</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="journalType">Journal Type:</label>
                    <select id="journalType" onchange="updateJournalPrompts()">
                        <option value="daily">Daily Reflection</option>
                        <option value="gratitude">Gratitude Journal</option>
                        <option value="manifestation">Manifestation Journal</option>
                        <option value="moon">Moon Cycle Journal</option>
                        <option value="shadow">Shadow Work</option>
                        <option value="dreams">Dream Journal</option>
                    </select>
                </div>
            </div>
            <div id="journalPrompts" class="interpretation">
                <!-- Journal prompts will appear here -->
            </div>
            <div class="journal-entry" style="background: rgba(255,255,255,0.15); border-left-width: 4px;"> 
                <textarea id="journalText" placeholder="Write your cosmic reflections here..." style="width: 100%; height: 200px; background: rgba(255,255,255,0.1); border: none; border-radius: 10px; padding: 15px; color: white; resize: vertical; font-family: 'Arial', sans-serif; font-size: 1rem;"></textarea>
                <button onclick="saveJournalEntry()" style="background: #ffd700; color: #1e3c72; border: none; padding: 10px 20px; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 10px;">Save Entry</button>
            </div>
            <div id="savedEntries" style="margin-top:20px;">
                <!-- Saved journal entries will appear here -->
            </div>
        </div>

        <!-- Dreams Tab -->
        <div id="dreams" class="tab-content">
            <h2>Dream Analysis & Symbolism</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="dreamDate">Dream Date:</label>
                    <input type="date" id="dreamDate">
                </div>
                <div class="sign-selector">
                    <label for="dreamMood">Dream Mood:</label>
                    <select id="dreamMood">
                        <option value="positive">Positive</option>
                        <option value="neutral">Neutral</option>
                        <option value="negative">Negative</option>
                        <option value="confusing">Confusing</option>
                        <option value="prophetic">Prophetic</option>
                    </select>
                </div>
            </div>
            <div class="journal-entry" style="background: rgba(255,255,255,0.15); border-left-width: 4px;">
                <textarea id="dreamDescription" placeholder="Describe your dream in detail..." style="width: 100%; height: 150px; background: rgba(255,255,255,0.1); border: none; border-radius: 10px; padding: 15px; color: white; resize: vertical; font-family: 'Arial', sans-serif; font-size: 1rem;"></textarea>
                <button onclick="analyzeDream()" style="background: #ffd700; color: #1e3c72; border: none; padding: 10px 20px; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 10px;">Analyze Dream</button>
            </div>
            <div class="dream-symbols" id="dreamSymbols">
                <!-- Dream symbols will appear here -->
            </div>
            <div class="interpretation" id="dreamAnalysis">
                <p>Enter your dream details to receive a comprehensive symbolic analysis.</p>
            </div>
        </div>

        <!-- Rituals Tab -->
        <div id="rituals" class="tab-content">
            <h2>Sacred Rituals & Ceremonies</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="ritualPurpose">Ritual Purpose:</label>
                    <select id="ritualPurpose" onchange="updateRituals()">
                        <option value="new-moon">New Moon Manifestation</option>
                        <option value="full-moon">Full Moon Release</option>
                        <option value="protection">Protection & Cleansing</option>
                        <option value="abundance">Abundance & Prosperity</option>
                        <option value="love">Love & Relationships</option>
                        <option value="healing">Healing & Recovery</option>
                        <option value="wisdom">Wisdom & Clarity</option>
                        <option value="seasonal">Seasonal Celebration (General)</option>
                    </select>
                </div>
                <div class="sign-selector">
                    <label for="ritualSign">Your Zodiac Sign:</label>
                    <select id="ritualSign" onchange="updateRituals()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
            </div>
            <div id="ritualInstructions" class="interpretation">
                <!-- Ritual instructions will appear here -->
            </div>
            <div class="affirmation-card">
                <h3>Daily Affirmation</h3>
                <p id="dailyAffirmation">Click to generate your cosmic affirmation for today</p>
                <button onclick="generateAffirmation()" style="background: transparent; color: #ffd700; border: 2px solid #ffd700; padding: 10px 20px; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 10px;">New Affirmation</button>
            </div>
        </div>

        <!-- Biorhythms Tab -->
        <div id="biorhythms" class="tab-content">
            <h2>Personal Biorhythm Analysis</h2>
            <div class="sign-combination">
                <div class="sign-selector">
                    <label for="biorhythmBirthDate">Birth Date:</label>
                    <input type="date" id="biorhythmBirthDate" onchange="calculateBiorhythms()">
                </div>
                <div class="sign-selector">
                    <label for="biorhythmAnalysisDate">Analysis Date:</label>
                    <input type="date" id="biorhythmAnalysisDate" onchange="calculateBiorhythms()">
                </div>
            </div>
            <div class="biorhythm-chart" id="biorhythmChartDisplay"> 
                 <p style="text-align:center; padding-top: 80px;">Enter birth date to view chart.</p>
            </div>
            <div class="element-info">
                <div class="element-card">
                    <h4>Physical Cycle (23 days)</h4>
                    <div class="energy-meter">
                        <div class="energy-bar" id="physicalBar" style="width: 50%;"></div>
                    </div>
                    <p id="physicalStatus">Awaiting calculation...</p>
                </div>
                <div class="element-card">
                    <h4>Emotional Cycle (28 days)</h4>
                    <div class="energy-meter">
                        <div class="energy-bar" id="emotionalBar" style="width: 50%;"></div>
                    </div>
                    <p id="emotionalStatus">Awaiting calculation...</p>
                </div>
                <div class="element-card">
                    <h4>Intellectual Cycle (33 days)</h4>
                    <div class="energy-meter">
                        <div class="energy-bar" id="intellectualBar" style="width: 50%;"></div>
                    </div>
                    <p id="intellectualStatus">Awaiting calculation...</p>
                </div>
            </div>
        </div>
    </div>

<script src="js/numerologyCompatibility.js"></script>
<script>
    // Complete Zodiac Data with all signs, elements, qualities, and detailed information
    const zodiacSigns = {
        'aries': {
            name: 'Aries',
            symbol: '‚ôà',
            element: 'Fire',
            quality: 'Cardinal',
            ruler: 'Mars',
            dates: 'March 21 - April 19',
            keywords: ['Leadership', 'Initiative', 'Courage', 'Independence', 'Action'],
            strengths: ['Confident', 'Enthusiastic', 'Optimistic', 'Honest', 'Passionate', 'Brave'],
            weaknesses: ['Impatient', 'Moody', 'Short-tempered', 'Impulsive', 'Aggressive'],
            description: 'Aries is the first sign of the zodiac, representing new beginnings, raw energy, and pioneering spirit. Ruled by Mars, Aries individuals are natural leaders, often impulsive and always ready for a challenge. They are driven by a desire to be first and to make their mark on the world.',
            dailyHoroscope: 'Today brings exciting opportunities for leadership. Your natural courage will guide you to success. Embrace new challenges with your signature enthusiasm, but try to temper impatience for best results.',
            crystals: ['Red Jasper', 'Carnelian', 'Bloodstone', 'Diamond', 'Pyrite'],
            mantra: 'I am confident and courageous in all my endeavors, leading with passion and purpose.'
        },
        'taurus': {
            name: 'Taurus',
            symbol: '‚ôâ',
            element: 'Earth',
            quality: 'Fixed',
            ruler: 'Venus',
            dates: 'April 20 - May 20',
            keywords: ['Stability', 'Persistence', 'Reliability', 'Sensuality', 'Patience'],
            strengths: ['Reliable', 'Patient', 'Practical', 'Devoted', 'Responsible', 'Stable'],
            weaknesses: ['Stubborn', 'Possessive', 'Uncompromising', 'Materialistic', 'Slow-moving'],
            description: 'Taurus, ruled by Venus, represents stability, determination, and appreciation for beauty, comfort, and the material world. Taureans are known for their practicality, loyalty, and love of earthly pleasures. They are steadfast and seek security in all aspects of life.',
            dailyHoroscope: 'Focus on building solid foundations today. Your patience and persistence will pay off. Indulge your senses in a healthy way, but be mindful of stubborn tendencies. Financial matters may benefit from careful attention.',
            crystals: ['Rose Quartz', 'Emerald', 'Malachite', 'Aventurine', 'Sapphire'],
            mantra: 'I am grounded, stable, and attract abundance and beauty naturally into my life.'
        },
        'gemini': {
            name: 'Gemini',
            symbol: '‚ôä',
            element: 'Air',
            quality: 'Mutable',
            ruler: 'Mercury',
            dates: 'May 21 - June 20',
            keywords: ['Communication', 'Versatility', 'Curiosity', 'Adaptability', 'Intellect'],
            strengths: ['Gentle', 'Affectionate', 'Curious', 'Adaptable', 'Quick-witted', 'Sociable'],
            weaknesses: ['Nervous', 'Inconsistent', 'Indecisive', 'Superficial', 'Restless'],
            description: 'Gemini, ruled by Mercury, embodies duality, communication, and intellectual curiosity. Geminis are versatile, quick-witted, and sociable, always eager to learn and share information. They thrive on variety and mental stimulation.',
            dailyHoroscope: 'Your communication skills shine today. Multiple opportunities for learning and connecting present themselves. Embrace your adaptability, but try to focus on one or two key tasks to avoid scattering your energy.',
            crystals: ['Citrine', 'Agate', 'Tiger\'s Eye', 'Clear Quartz', 'Aquamarine'],
            mantra: 'I communicate clearly, adapt to all situations with ease, and embrace intellectual growth.'
        },
        'cancer': {
            name: 'Cancer',
            symbol: '‚ôã',
            element: 'Water',
            quality: 'Cardinal',
            ruler: 'Moon',
            dates: 'June 21 - July 22',
            keywords: ['Emotion', 'Intuition', 'Protection', 'Family', 'Nurturing'],
            strengths: ['Tenacious', 'Highly imaginative', 'Loyal', 'Emotional', 'Sympathetic', 'Persuasive'],
            weaknesses: ['Moody', 'Pessimistic', 'Suspicious', 'Manipulative', 'Insecure', 'Clingy'],
            description: 'Cancer, ruled by the Moon, represents emotional depth, nurturing instincts, and strong intuition. Cancers are deeply connected to home and family, valuing security and comfort. They are known for their empathy and protective nature.',
            dailyHoroscope: 'Trust your intuition today, it\'s particularly strong. Family and emotional connections bring fulfillment. Nurture yourself and others, but be mindful of becoming overly sensitive or withdrawn.',
            crystals: ['Moonstone', 'Pearl', 'Selenite', 'Labradorite', 'Rose Quartz'],
            mantra: 'I trust my intuition, nurture myself and others with love, and create a safe emotional space.'
        },
        'leo': {
            name: 'Leo',
            symbol: '‚ôå',
            element: 'Fire',
            quality: 'Fixed',
            ruler: 'Sun',
            dates: 'July 23 - August 22',
            keywords: ['Creativity', 'Generosity', 'Warmth', 'Leadership', 'Drama'],
            strengths: ['Creative', 'Passionate', 'Generous', 'Warm-hearted', 'Cheerful', 'Humorous'],
            weaknesses: ['Arrogant', 'Stubborn', 'Self-centered', 'Lazy', 'Inflexible', 'Dominating'],
            description: 'Leo, ruled by the Sun, radiates confidence, creativity, and natural leadership abilities. Leos are known for their dramatic flair, generosity, and warm-heartedness. They love to be admired and enjoy taking center stage.',
            dailyHoroscope: 'Your charisma attracts positive attention. Creative projects flourish under your guidance. Shine brightly, but remember to share the spotlight and listen to others. A playful approach will serve you well.',
            crystals: ['Sunstone', 'Citrine', 'Pyrite', 'Amber', 'Garnet'],
            mantra: 'I shine my light brightly, inspire others with my creativity, and lead with a generous heart.'
        },
        'virgo': {
            name: 'Virgo',
            symbol: '‚ôç',
            element: 'Earth',
            quality: 'Mutable',
            ruler: 'Mercury',
            dates: 'August 23 - September 22',
            keywords: ['Analysis', 'Practicality', 'Service', 'Perfection', 'Health'],
            strengths: ['Loyal', 'Analytical', 'Kind', 'Hardworking', 'Practical', 'Detail-oriented'],
            weaknesses: ['Shyness', 'Worry', 'Overly critical of self and others', 'All work and no play', 'Fussy'],
            description: 'Virgo, ruled by Mercury, embodies precision, service to others, and analytical thinking. Virgos are meticulous, practical, and hardworking, often focused on details and improvement. They have a strong sense of duty and a desire to be helpful.',
            dailyHoroscope: 'Attention to detail brings recognition. Your analytical skills solve complex problems. Focus on tasks that require precision, but avoid getting lost in perfectionism. Remember to care for your well-being.',
            crystals: ['Amazonite', 'Moss Agate', 'Peridot', 'Sapphire', 'Jasper'],
            mantra: 'I serve others with precision, find perfection in imperfection, and honor my well-being.'
        },
        'libra': {
            name: 'Libra',
            symbol: '‚ôé',
            element: 'Air',
            quality: 'Cardinal',
            ruler: 'Venus',
            dates: 'September 23 - October 22',
            keywords: ['Balance', 'Justice', 'Beauty', 'Partnership', 'Harmony'],
            strengths: ['Cooperative', 'Diplomatic', 'Gracious', 'Fair-minded', 'Social', 'Charming'],
            weaknesses: ['Indecisive', 'Avoids confrontations', 'Self-pity', 'Grudges', 'Superficial'],
            description: 'Libra, ruled by Venus, seeks harmony, balance, and beautiful partnerships in all aspects of life. Librans are known for their diplomacy, charm, and love of beauty and justice. They thrive in harmonious environments and value relationships.',
            dailyHoroscope: 'Harmony and balance guide your decisions today. Partnerships bring mutual benefits. Use your diplomatic skills to navigate any social complexities. Strive for fairness, but don\'t be afraid to make a decision.',
            crystals: ['Rose Quartz', 'Lapis Lazuli', 'Opal', 'Jade', 'Aventurine'],
            mantra: 'I create harmony and balance in all my relationships and seek beauty and justice in the world.'
        },
        'scorpio': {
            name: 'Scorpio',
            symbol: '‚ôè',
            element: 'Water',
            quality: 'Fixed',
            ruler: 'Pluto (traditional: Mars)',
            dates: 'October 23 - November 21',
            keywords: ['Intensity', 'Transformation', 'Mystery', 'Power', 'Passion'],
            strengths: ['Resourceful', 'Brave', 'Passionate', 'Stubborn (as in determined)', 'A true friend', 'Intuitive'],
            weaknesses: ['Distrusting', 'Jealous', 'Secretive', 'Violent (if provoked)', 'Calculating', 'Intense'],
            description: 'Scorpio, co-ruled by Pluto and Mars, represents deep transformation, intense emotions, and hidden wisdom. Scorpios are known for their passion, determination, and penetrating insight. They are resourceful and not afraid to delve into the depths.',
            dailyHoroscope: 'Deep insights emerge from within. Transformation leads to personal power. Embrace your intensity constructively. A good day for research or uncovering hidden truths. Trust your powerful intuition.',
            crystals: ['Obsidian', 'Garnet', 'Hematite', 'Malachite', 'Topaz'],
            mantra: 'I embrace transformation, use my power for healing, and perceive truth with clarity.'
        },
        'sagittarius': {
            name: 'Sagittarius',
            symbol: '‚ôê',
            element: 'Fire',
            quality: 'Mutable',
            ruler: 'Jupiter',
            dates: 'November 22 - December 21',
            keywords: ['Adventure', 'Philosophy', 'Freedom', 'Truth', 'Optimism'],
            strengths: ['Generous', 'Idealistic', 'Great sense of humor', 'Optimistic', 'Freedom-loving', 'Honest'],
            weaknesses: ['Promises more than can deliver', 'Impatient', 'Undiplomatic', 'Restless', 'Blunt'],
            description: 'Sagittarius, ruled by Jupiter, embodies adventure, philosophical thinking, and the quest for truth and meaning. Sagittarians are optimistic, freedom-loving, and humorous, always eager to explore and expand their horizons.',
            dailyHoroscope: 'New horizons beckon. Your optimism opens doors to exciting adventures. A great day for learning or planning travel. Speak your truth, but with a touch of diplomacy to avoid misunderstandings.',
            crystals: ['Turquoise', 'Sodalite', 'Topaz', 'Amethyst', 'Lapis Lazuli'],
            mantra: 'I explore life with optimism, seek truth in all experiences, and expand my horizons fearlessly.'
        },
        'capricorn': {
            name: 'Capricorn',
            symbol: '‚ôë',
            element: 'Earth',
            quality: 'Cardinal',
            ruler: 'Saturn',
            dates: 'December 22 - January 19',
            keywords: ['Ambition', 'Discipline', 'Responsibility', 'Achievement', 'Structure'],
            strengths: ['Responsible', 'Disciplined', 'Self-control', 'Good managers', 'Patient', 'Practical'],
            weaknesses: ['Know-it-all', 'Unforgiving', 'Condescending', 'Expecting the worst', 'Pessimistic', 'Rigid'],
            description: 'Capricorn, ruled by Saturn, represents ambition, discipline, and the steady climb to success. Capricorns are known for their practicality, responsibility, and determination. They are masters of self-control and value structure and tradition.',
            dailyHoroscope: 'Steady progress toward your goals is key today. Discipline and patience create lasting success. Focus on practical tasks and long-term plans. Remember to acknowledge your achievements along the way.',
            crystals: ['Garnet', 'Black Tourmaline', 'Fluorite', 'Onyx', 'Smoky Quartz'],
            mantra: 'I achieve my goals through discipline, persistent effort, and responsible leadership.'
        },
        'aquarius': {
            name: 'Aquarius',
            symbol: '‚ôí',
            element: 'Air',
            quality: 'Fixed',
            ruler: 'Uranus (traditional: Saturn)',
            dates: 'January 20 - February 18',
            keywords: ['Innovation', 'Independence', 'Humanitarianism', 'Originality', 'Intellect'],
            strengths: ['Progressive', 'Original', 'Independent', 'Humanitarian', 'Intelligent', 'Inventive'],
            weaknesses: ['Runs from emotional expression', 'Temperamental', 'Uncompromising', 'Aloof', 'Eccentric'],
            description: 'Aquarius, co-ruled by Uranus and Saturn, embodies innovation, humanitarian ideals, and unique perspectives. Aquarians are independent, original thinkers, often focused on progress and social causes. They value freedom and intellectual stimulation.',
            dailyHoroscope: 'Original ideas flow freely. Your unique perspective inspires positive change. Connect with like-minded individuals or groups. Embrace innovation, but ensure your ideas have a practical grounding.',
            crystals: ['Amethyst', 'Aquamarine', 'Labradorite', 'Clear Quartz', 'Moonstone'],
            mantra: 'I embrace my uniqueness, contribute to humanitarian progress, and innovate for a better future.'
        },
        'pisces': {
            name: 'Pisces',
            symbol: '‚ôì',
            element: 'Water',
            quality: 'Mutable',
            ruler: 'Neptune (traditional: Jupiter)',
            dates: 'February 19 - March 20',
            keywords: ['Intuition', 'Compassion', 'Imagination', 'Spirituality', 'Empathy'],
            strengths: ['Compassionate', 'Artistic', 'Intuitive', 'Gentle', 'Wise', 'Musical'],
            weaknesses: ['Fearful', 'Overly trusting', 'Sad', 'Desire to escape reality', 'Victim mentality', 'Impressionable'],
            description: 'Pisces, co-ruled by Neptune and Jupiter, represents deep intuition, artistic expression, and spiritual connection. Pisceans are compassionate, imaginative, and empathetic, often attuned to the subtle realms. They are selfless and seek to merge with something larger than themselves.',
            dailyHoroscope: 'Your intuition guides important decisions today. Artistic and spiritual pursuits bring fulfillment. Allow your compassionate nature to shine, but remember to maintain healthy boundaries. Creative inspiration is high.',
            crystals: ['Amethyst', 'Aquamarine', 'Moonstone', 'Fluorite', 'Lepidolite'],
            mantra: 'I trust my intuition, express my compassion through creativity, and connect with universal love.'
        }
    };

    const compatibilityMatrix = {
        'aries': {
            'aries': 85, 'taurus': 60, 'gemini': 75, 'cancer': 55, 'leo': 95, 'virgo': 50,
            'libra': 80, 'scorpio': 70, 'sagittarius': 90, 'capricorn': 45, 'aquarius': 85, 'pisces': 65
        },
        'taurus': {
            'aries': 60, 'taurus': 80, 'gemini': 45, 'cancer': 90, 'leo': 65, 'virgo': 95,
            'libra': 75, 'scorpio': 85, 'sagittarius': 40, 'capricorn': 90, 'aquarius': 50, 'pisces': 80
        },
        'gemini': {
            'aries': 75, 'taurus': 45, 'gemini': 70, 'cancer': 55, 'leo': 80, 'virgo': 60,
            'libra': 95, 'scorpio': 50, 'sagittarius': 85, 'capricorn': 40, 'aquarius': 90, 'pisces': 65
        },
        'cancer': {
            'aries': 55, 'taurus': 90, 'gemini': 55, 'cancer': 85, 'leo': 70, 'virgo': 80,
            'libra': 65, 'scorpio': 95, 'sagittarius': 45, 'capricorn': 75, 'aquarius': 50, 'pisces': 90
        },
        'leo': {
            'aries': 95, 'taurus': 65, 'gemini': 80, 'cancer': 70, 'leo': 75, 'virgo': 55,
            'libra': 85, 'scorpio': 60, 'sagittarius': 95, 'capricorn': 50, 'aquarius': 80, 'pisces': 70
        },
        'virgo': {
            'aries': 50, 'taurus': 95, 'gemini': 60, 'cancer': 80, 'leo': 55, 'virgo': 70,
            'libra': 65, 'scorpio': 85, 'sagittarius': 45, 'capricorn': 95, 'aquarius': 55, 'pisces': 75
        },
        'libra': {
            'aries': 80, 'taurus': 75, 'gemini': 95, 'cancer': 65, 'leo': 85, 'virgo': 65,
            'libra': 80, 'scorpio': 70, 'sagittarius': 80, 'capricorn': 60, 'aquarius': 90, 'pisces': 75
        },
        'scorpio': {
            'aries': 70, 'taurus': 85, 'gemini': 50, 'cancer': 95, 'leo': 60, 'virgo': 85,
            'libra': 70, 'scorpio': 90, 'sagittarius': 55, 'capricorn': 80, 'aquarius': 65, 'pisces': 95
        },
        'sagittarius': {
            'aries': 90, 'taurus': 40, 'gemini': 85, 'cancer': 45, 'leo': 95, 'virgo': 45,
            'libra': 80, 'scorpio': 55, 'sagittarius': 85, 'capricorn': 50, 'aquarius': 90, 'pisces': 60
        },
        'capricorn': {
            'aries': 45, 'taurus': 90, 'gemini': 40, 'cancer': 75, 'leo': 50, 'virgo': 95,
            'libra': 60, 'scorpio': 80, 'sagittarius': 50, 'capricorn': 85, 'aquarius': 55, 'pisces': 70
        },
        'aquarius': {
            'aries': 85, 'taurus': 50, 'gemini': 90, 'cancer': 50, 'leo': 80, 'virgo': 55,
            'libra': 90, 'scorpio': 65, 'sagittarius': 90, 'capricorn': 55, 'aquarius': 80, 'pisces': 70
        },
        'pisces': {
            'aries': 65, 'taurus': 80, 'gemini': 65, 'cancer': 90, 'leo': 70, 'virgo': 75,
            'libra': 75, 'scorpio': 95, 'sagittarius': 60, 'capricorn': 70, 'aquarius': 70, 'pisces': 85
        }
    };

    const tarotDeck = {
        major: [
            { name: 'The Fool', symbol: 'üÉè', meaning: 'New beginnings, innocence, spontaneity, faith, originality', reversed: 'Recklessness, taken advantage of, inconsideration, naivety, folly' },
            { name: 'The Magician', symbol: 'ü™Ñ', meaning: 'Manifestation, resourcefulness, power, skill, willpower', reversed: 'Manipulation, poor planning, latent talents, deceit, trickery' },
            { name: 'The High Priestess', symbol: 'üåô', meaning: 'Intuition, unconscious, inner voice, mystery, spirituality', reversed: 'Lack of center, lost inner voice, repressed feelings, secrets, superficiality' },
            { name: 'The Empress', symbol: 'üëë', meaning: 'Motherhood, fertility, nature, nurturing, abundance, beauty', reversed: 'Dependence, smothering, emptiness, creative block, neglect' },
            { name: 'The Emperor', symbol: 'üèõÔ∏è', meaning: 'Authority, structure, control, fatherhood, leadership, stability', reversed: 'Tyranny, rigidity, coldness, domination, lack of discipline' },
            { name: 'The Hierophant', symbol: 'üîë', meaning: 'Spiritual wisdom, religious beliefs, conformity, tradition, institutions', reversed: 'Personal beliefs, freedom, challenging the status quo, rebellion, non-conformity' },
            { name: 'The Lovers', symbol: 'üíï', meaning: 'Love, harmony, relationships, values alignment, choices', reversed: 'Disharmony, imbalance, misalignment of values, conflict, indecision' },
            { name: 'The Chariot', symbol: '‚öîÔ∏è', meaning: 'Control, willpower, victory, assertion, determination, success', reversed: 'Self-discipline issues, opposition, lack of direction, aggression, forcefulness' },
            { name: 'Strength', symbol: 'ü¶Å', meaning: 'Strength, courage, persuasion, influence, compassion, self-control', reversed: 'Self-doubt, low energy, raw emotion, weakness, lack of discipline' },
            { name: 'The Hermit', symbol: 'üí°', meaning: 'Soul-searching, introspection, guidance, wisdom, solitude', reversed: 'Isolation, loneliness, withdrawal, paranoia, reclusiveness' },
            { name: 'Wheel of Fortune', symbol: 'üîÑ', meaning: 'Good luck, karma, life cycles, destiny, turning point', reversed: 'Bad luck, lack of control, clinging to control, negative cycles, resistance to change' },
            { name: 'Justice', symbol: '‚öñÔ∏è', meaning: 'Justice, fairness, truth, cause and effect, law, clarity', reversed: 'Unfairness, lack of accountability, dishonesty, prejudice, legal disputes' },
            { name: 'The Hanged Man', symbol: 'üïäÔ∏è', meaning: 'Suspension, restriction, letting go, sacrifice, new perspective', reversed: 'Martyrdom, indecision, delay, stalling, resistance to letting go' },
            { name: 'Death', symbol: 'üíÄ', meaning: 'Endings, beginnings, change, transformation, transition', reversed: 'Resistance to change, personal transformation, inner purging, fear of endings' },
            { name: 'Temperance', symbol: '‚öñÔ∏è', meaning: 'Balance, moderation, patience, purpose, alchemy, healing', reversed: 'Imbalance, excess, self-healing, re-alignment, discord' },
            { name: 'The Devil', symbol: 'üîó', meaning: 'Bondage, addiction, sexuality, materialism, temptation, shadow self', reversed: 'Releasing limiting beliefs, exploring dark thoughts, detachment, breaking free' },
            { name: 'The Tower', symbol: 'üí•', meaning: 'Sudden change, upheaval, chaos, revelation, awakening', reversed: 'Personal transformation, fear of change, averting disaster, resisting destruction' },
            { name: 'The Star', symbol: '‚≠ê', meaning: 'Hope, faith, purpose, renewal, spirituality, inspiration', reversed: 'Lack of faith, despair, self-trust, discouragement, negativity' },
            { name: 'The Moon', symbol: 'üåë', meaning: 'Illusion, fear, anxiety, subconscious, intuition, dreams', reversed: 'Release of fear, repressed emotion, inner confusion, clarity, truth revealed' },
            { name: 'The Sun', symbol: '‚òÄÔ∏è', meaning: 'Positivity, fun, warmth, success, vitality, joy, clarity', reversed: 'Inner child issues, feeling down, overly optimistic, lack of success, depression' },
            { name: 'Judgement', symbol: 'üé∫', meaning: 'Judgement, rebirth, inner calling, absolution, awakening', reversed: 'Self-doubt, inner critic, ignoring the call, fear of judgement, indecision' },
            { name: 'The World', symbol: 'üåç', meaning: 'Completion, accomplishment, travel, integration, fulfillment', reversed: 'Seeking personal closure, short-cuts, stagnation, lack of completion, delays' }
        ]
    };

    const crystalDatabase = {
        protection: [
            { name: 'Black Tourmaline', properties: 'Ultimate protection stone, repels negative energy, grounding', chakra: 'Root' },
            { name: 'Obsidian', properties: 'Psychic protection, grounding, truth-telling, cuts cords', chakra: 'Root' },
            { name: 'Hematite', properties: 'Grounding, dissolving negativity, calming, focus', chakra: 'Root' },
            { name: 'Smoky Quartz', properties: 'Transmutes negative energy, emotional protection, detoxifying', chakra: 'Root, Solar Plexus' }
        ],
        love: [
            { name: 'Rose Quartz', properties: 'Unconditional love, self-love, emotional healing, compassion', chakra: 'Heart' },
            { name: 'Green Aventurine', properties: 'Heart healing, compassion, emotional calm, luck', chakra: 'Heart' },
            { name: 'Rhodonite', properties: 'Emotional healing, forgiveness, self-love, relationship harmony', chakra: 'Heart, Root' },
            { name: 'Morganite', properties: 'Divine love, emotional intelligence, peace, attracts soulmates', chakra: 'Heart' }
        ],
        abundance: [
            { name: 'Citrine', properties: 'Abundance, prosperity, personal power, manifestation', chakra: 'Solar Plexus, Sacral' },
            { name: 'Pyrite', properties: 'Wealth, confidence, protection, manifestation, willpower', chakra: 'Solar Plexus' },
            { name: 'Green Jade', properties: 'Good fortune, prosperity, harmony, wisdom, longevity', chakra: 'Heart' },
            { name: 'Tiger\'s Eye', properties: 'Courage, prosperity, mental clarity, grounding, protection', chakra: 'Solar Plexus, Sacral, Root' }
        ],
        healing: [
            { name: 'Clear Quartz', properties: 'Master healer, amplifies energy, clarity, programmable', chakra: 'All, Crown' },
            { name: 'Amethyst', properties: 'Spiritual healing, intuition, calming, sobriety, protection', chakra: 'Third Eye, Crown' },
            { name: 'Fluorite', properties: 'Mental clarity, focus, learning, cleansing, protection', chakra: 'Third Eye, Throat, Heart (depending on color)' },
            { name: 'Lepidolite', properties: 'Stress relief, emotional balance, peace, calming, sleep aid', chakra: 'Third Eye, Crown, Heart' }
        ],
        intuition: [
            { name: 'Labradorite', properties: 'Psychic abilities, transformation, protection, magic', chakra: 'Third Eye, Throat' },
            { name: 'Moonstone', properties: 'Intuition, feminine energy, new beginnings, emotional balance', chakra: 'Third Eye, Crown, Sacral' },
            { name: 'Selenite', properties: 'Spiritual activation, communication with higher self, cleansing', chakra: 'Crown, Third Eye' },
            { name: 'Azurite', properties: 'Third eye activation, psychic development, insight, spiritual guidance', chakra: 'Third Eye, Throat' }
        ],
        clarity: [
            { name: 'Clear Quartz', properties: 'Mental clarity, focus, amplification, spiritual awareness', chakra: 'Crown' },
            { name: 'Fluorite', properties: 'Concentration, learning, mental enhancement, organization', chakra: 'Third Eye' },
            { name: 'Sodalite', properties: 'Logic, rationality, emotional balance, truth, communication', chakra: 'Throat, Third Eye' },
            { name: 'Lapis Lazuli', properties: 'Wisdom, truth, inner vision, communication, spiritual insight', chakra: 'Third Eye, Throat' }
        ],
        grounding: [
            { name: 'Red Jasper', properties: 'Grounding, stability, strength, endurance, nurturing', chakra: 'Root' },
            { name: 'Garnet', properties: 'Grounding, passion, regeneration, vitality, courage', chakra: 'Root, Sacral, Heart' },
            { name: 'Bloodstone', properties: 'Courage, grounding, vitality, purification, strength', chakra: 'Root, Heart' },
            { name: 'Black Onyx', properties: 'Protection, grounding, strength, discipline, focus', chakra: 'Root' }
        ],
        confidence: [
            { name: 'Carnelian', properties: 'Confidence, courage, creativity, motivation, vitality', chakra: 'Sacral, Solar Plexus, Root' },
            { name: 'Sunstone', properties: 'Joy, confidence, self-empowerment, leadership, optimism', chakra: 'Solar Plexus, Sacral' },
            { name: 'Citrine', properties: 'Personal power, confidence, success, joy, manifestation', chakra: 'Solar Plexus' },
            { name: 'Tiger\'s Eye', properties: 'Courage, confidence, grounding, willpower, protection', chakra: 'Solar Plexus, Sacral, Root' }
        ]
    };

    const chakraInfo = {
        root: {
            name: 'Root Chakra (Muladhara)',
            color: '#FF0000',
            location: 'Base of spine',
            element: 'Earth',
            mantra: 'LAM',
            properties: 'Survival, grounding, stability, security, physical health, belonging',
            imbalanced: 'Fear, anxiety, restlessness, financial insecurity, ungrounded, lower back pain, constipation',
            balanced: 'Grounded, stable, secure, present, physically healthy, energetic, trusting',
            crystals: ['Red Jasper', 'Hematite', 'Garnet', 'Black Tourmaline', 'Smoky Quartz'],
            affirmation: 'I am safe, grounded, and supported by the Earth. All my needs are met.'
        },
        sacral: {
            name: 'Sacral Chakra (Svadhisthana)',
            color: '#FF7F00',
            location: 'Lower abdomen, below navel',
            element: 'Water',
            mantra: 'VAM',
            properties: 'Creativity, sexuality, emotion, pleasure, relationships, flow',
            imbalanced: 'Guilt, shame, sexual dysfunction, creative blocks, emotional instability, addiction',
            balanced: 'Creative, passionate, joyful, emotionally intelligent, healthy relationships, adaptable',
            crystals: ['Carnelian', 'Orange Calcite', 'Moonstone', 'Sunstone', 'Amber'],
            affirmation: 'I embrace my creativity, emotions, and sexuality with joy and passion. I flow with life.'
        },
        solar: {
            name: 'Solar Plexus Chakra (Manipura)',
            color: '#FFFF00',
            location: 'Upper abdomen, stomach area',
            element: 'Fire',
            mantra: 'RAM',
            properties: 'Personal power, confidence, self-esteem, willpower, digestion, intellect',
            imbalanced: 'Low self-esteem, control issues, digestive problems, anger, victim mentality, indecisiveness',
            balanced: 'Confident, purposeful, self-disciplined, responsible, assertive, strong sense of self',
            crystals: ['Citrine', 'Tiger\'s Eye', 'Yellow Jasper', 'Pyrite', 'Golden Topaz'],
            affirmation: 'I am confident and empowered. I honor my personal power and use it wisely.'
        },
        heart: {
            name: 'Heart Chakra (Anahata)',
            color: '#00FF00',
            location: 'Center of chest',
            element: 'Air',
            mantra: 'YAM',
            properties: 'Love, compassion, relationships, connection, forgiveness, empathy, balance',
            imbalanced: 'Loneliness, bitterness, fear of intimacy, jealousy, grief, critical, codependency',
            balanced: 'Loving, compassionate, empathetic, forgiving, peaceful, harmonious relationships',
            crystals: ['Rose Quartz', 'Green Aventurine', 'Jade', 'Malachite', 'Emerald', 'Rhodonite'],
            affirmation: 'I give and receive love freely and unconditionally. My heart is open and balanced.'
        },
        throat: {
            name: 'Throat Chakra (Vishuddha)',
            color: '#0000FF', 
            location: 'Throat',
            element: 'Ether/Sound',
            mantra: 'HAM',
            properties: 'Communication, truth, self-expression, creativity, listening, authenticity',
            imbalanced: 'Inability to express oneself, fear of speaking, lying, gossiping, shyness, thyroid issues',
            balanced: 'Expressive, truthful, good listener, creative communication, authentic, clear voice',
            crystals: ['Lapis Lazuli', 'Aquamarine', 'Blue Lace Agate', 'Sodalite', 'Turquoise', 'Kyanite'],
            affirmation: 'I express my truth clearly, lovingly, and with confidence. I listen with understanding.'
        },
        'third-eye': {
            name: 'Third Eye Chakra (Ajna)',
            color: '#4B0082', 
            location: 'Between eyebrows',
            element: 'Light/Intuition',
            mantra: 'OM (or AUM)',
            properties: 'Intuition, wisdom, spiritual connection, insight, imagination, clairvoyance, perception',
            imbalanced: 'Confusion, lack of clarity, poor intuition, nightmares, headaches, narrow-mindedness',
            balanced: 'Intuitive, wise, imaginative, perceptive, clear vision, connected to inner guidance',
            crystals: ['Amethyst', 'Labradorite', 'Fluorite', 'Lepidolite', 'Sodalite', 'Lapis Lazuli'],
            affirmation: 'I trust my intuition and see clearly with inner wisdom. I am connected to divine insight.'
        },
        crown: {
            name: 'Crown Chakra (Sahasrara)',
            color: '#9400D3', 
            location: 'Top of head',
            element: 'Thought/Cosmic Energy',
            mantra: 'SILENCE (or OM)',
            properties: 'Spirituality, enlightenment, connection to divine, universal consciousness, wisdom, unity',
            imbalanced: 'Spiritual cynicism, learning difficulties, rigid thoughts, depression, apathy, disconnected',
            balanced: 'Spiritually connected, enlightened, open-minded, peaceful, aware, understanding',
            crystals: ['Clear Quartz', 'Amethyst', 'Selenite', 'Diamond', 'Lepidolite', 'Sugilite'],
            affirmation: 'I am connected to the divine wisdom of the universe. I am one with all that is.'
        }
    };

    const planetaryData = {
        sun: { name: 'Sun', symbol: '‚òâ', influence: 'Ego, vitality, core identity, leadership, creativity, self-expression' },
        moon: { name: 'Moon', symbol: '‚òΩ', influence: 'Emotions, intuition, subconscious, nurturing, habits, inner self, security' },
        mercury: { name: 'Mercury', symbol: '‚òø', influence: 'Communication, intellect, learning, travel, technology, thought processes' },
        venus: { name: 'Venus', symbol: '‚ôÄ', influence: 'Love, beauty, harmony, relationships, money, values, pleasure, art' },
        mars: { name: 'Mars', symbol: '‚ôÇ', influence: 'Action, energy, passion, conflict, courage, drive, assertiveness, desire' },
        jupiter: { name: 'Jupiter', symbol: '‚ôÉ', influence: 'Expansion, wisdom, luck, philosophy, growth, abundance, optimism, faith' },
        saturn: { name: 'Saturn', symbol: '‚ôÑ', influence: 'Discipline, responsibility, limitations, lessons, structure, karma, time, maturity' },
        uranus: { name: 'Uranus', symbol: '‚ôÖ', influence: 'Innovation, rebellion, sudden change, freedom, originality, awakening, technology' },
        neptune: { name: 'Neptune', symbol: '‚ôÜ', influence: 'Spirituality, illusion, dreams, compassion, intuition, fog, imagination, art' },
        pluto: { name: 'Pluto', symbol: '‚ôá', influence: 'Transformation, power, regeneration, hidden truths, subconscious forces, death & rebirth' }
    };

    const dreamSymbols = {
        water: 'Emotions, subconscious, purification, life force, intuition, the unknown.',
        flying: 'Freedom, escape, spiritual ascension, overcoming obstacles, new perspectives, ambition.',
        animals: 'Instincts, natural wisdom, untamed aspects of self, specific animal symbolism varies.',
        death: 'Transformation, endings, new beginnings, letting go of old patterns, not usually literal death.',
        house: 'The self; different rooms represent different aspects of psyche (attic: higher mind, basement: subconscious).',
        fire: 'Passion, purification, destruction and creation, transformation, anger, energy, illumination.',
        snake: 'Wisdom, healing, transformation, hidden knowledge, temptation, kundalini energy, fear.',
        car: 'Life direction, control, personal drive and ambition, how you navigate life.',
        money: 'Self-worth, values, power, security, material concerns, abundance or lack thereof.',
        baby: 'New beginnings, innocence, potential, new aspects of self, vulnerability, a new project or idea.',
        falling: 'Loss of control, anxiety, feeling overwhelmed, insecurity, lack of support.',
        teeth: 'Confidence, communication, fear of aging or loss, power, appearance, vulnerability. (Losing teeth: anxiety, change)',
        chase: 'Avoiding something, running from fears or responsibilities, feeling pursued or threatened.',
        wedding: 'Union, commitment, new phase of life, integration of different aspects of self, partnership.',
        storm: 'Emotional turmoil, conflict, cleansing, powerful change, release of tension.',
        naked: 'Vulnerability, exposure, honesty, shame, freedom from pretense.',
        school: 'Learning, tests, anxiety about performance, past experiences, lessons to be learned.',
        journey: 'Life path, progress, exploration, seeking something, transition.',
        keys: 'Solutions, opportunities, access, knowledge, power, unlocking potential.',
        light: 'Clarity, understanding, hope, spiritual insight, truth, consciousness.'
    };

    const affirmations = [
        'I am aligned with the cosmic energy that flows through all things.',
        'My intuition guides me towards my highest good and greatest joy.',
        'I attract abundance, prosperity, and love into my life effortlessly.',
        'I am protected by divine light and surrounded by infinite love.',
        'My chakras are balanced, and my energy flows freely, harmoniously, and powerfully.',
        'I trust the universe to provide exactly what I need at the perfect time.',
        'I am connected to the wisdom of the stars, the planets, and my higher self.',
        'My dreams are manifestations of my deepest wisdom and pathways to understanding.',
        'I embrace change as an opportunity for profound growth and transformation.',
        'I am worthy of love, happiness, success, and complete spiritual fulfillment.',
        'The moon\'s cycles reflect my own natural rhythms of creation and release.',
        'I channel celestial energy to heal myself, others, and the planet.',
        'My aura is bright, my spirit is unshakeable, and my heart is open.',
        'I am in perfect harmony with the universe, and the universe is in harmony with me.',
        'Every day brings new cosmic insights, blessings, and opportunities for joy.'
    ];

    const signCombinations = {
        generateCombination: function(sun, moon, rising) {
            const sunSign = zodiacSigns[sun];
            const moonSign = zodiacSigns[moon];
            const risingSign = zodiacSigns[rising];
            
            return {
                title: `${sunSign.name} Sun, ${moonSign.name} Moon, ${risingSign.name} Rising`,
                description: `This powerful astrological trinity blends ${sunSign.name}'s core ${sunSign.element} energy and drive for ${sunSign.keywords[0].toLowerCase()}, with ${moonSign.name}'s emotional ${moonSign.element} nature seeking ${moonSign.keywords[0].toLowerCase()}, and ${risingSign.name}'s ${risingSign.element} approach to the world, presenting as ${risingSign.keywords[0].toLowerCase()}.`,
                personality: this.generatePersonalityProfile(sun, moon, rising),
                strengths: this.combineStrengths(sun, moon, rising),
                challenges: this.combineChallenges(sun, moon, rising),
                relationships: this.generateRelationshipStyle(sun, moon, rising),
                career: this.generateCareerGuidance(sun, moon, rising),
                spirituality: this.generateSpiritualPath(sun, moon, rising),
                crystals: this.recommendCrystals(sun, moon, rising),
                mantra: this.generateMantra(sun, moon, rising)
            };
        },
        
        generatePersonalityProfile: function(sun, moon, rising) {
            const sunData = zodiacSigns[sun];
            const moonData = zodiacSigns[moon];
            const risingData = zodiacSigns[rising];

            let profile = `Your core identity (Sun in ${sunData.name}) is driven by ${sunData.element} energy, seeking to express ${sunData.keywords[0].toLowerCase()} and ${sunData.keywords[1].toLowerCase()}. This is filtered through your emotional landscape (Moon in ${moonData.name}), which needs ${moonData.keywords[0].toLowerCase()} and processes the world with ${moonData.element} sensitivity. Your outward persona (Rising in ${risingData.name}) is how you meet the world, often appearing ${risingData.keywords[0].toLowerCase()} and utilizing ${risingData.element} qualities in your initial interactions.
            This combination creates a unique individual who might be ${sunData.strengths[0].toLowerCase()} at their core, feel ${moonData.strengths[0].toLowerCase()} emotionally, and present as ${risingData.strengths[0].toLowerCase()} to others. 
            The interplay between these energies is key: your ${sunData.element} Sun might be ${getElementInteraction(sunData.element, moonData.element)} your ${moonData.element} Moon, leading to ${this.getSunMoonBlend(sunData.element, moonData.element)}. Your ${risingData.element} Rising then ${getElementInteraction(risingData.element, sunData.element)} your Sun's expression outwardly.`; // Changed to this.getSunMoonBlend
            return profile;
        },
        getSunMoonBlend: function(sunElement, moonElement) {
            if (sunElement === moonElement) return "a harmonious and intensified expression of that element's qualities";
            if ((sunElement === 'Fire' && moonElement === 'Air') || (sunElement === 'Air' && moonElement === 'Fire')) return "an intellectually stimulated and expressive emotional nature";
            if ((sunElement === 'Earth' && moonElement === 'Water') || (sunElement === 'Water' && moonElement === 'Earth')) return "a deeply nurturing and practically grounded emotional core";
            if ((sunElement === 'Fire' && moonElement === 'Earth') || (sunElement === 'Earth' && moonElement === 'Fire')) return "a dynamic tension between impulsive action and practical needs, potentially leading to powerful manifestation if balanced";
            if ((sunElement === 'Air' && moonElement === 'Water') || (sunElement === 'Water' && moonElement === 'Air')) return "a blend of intellectual processing and emotional depth, requiring integration between head and heart";
            if ((sunElement === 'Fire' && moonElement === 'Water')) return "a passionate nature tempered by emotional depth, which can lead to creative power or internal steam if not balanced";
            if ((sunElement === 'Earth' && moonElement === 'Air')) return "a practical mind that seeks tangible results for its ideas, sometimes creating tension between the conceptual and the concrete";
            return "a complex and unique inner dynamic requiring conscious integration";
        },
        
        combineStrengths: function(sun, moon, rising) {
            const allStrengths = [
                ...zodiacSigns[sun].strengths,
                ...zodiacSigns[moon].strengths,
                ...zodiacSigns[rising].strengths
            ];
            let uniqueStrengths = [...new Set(allStrengths)];
            if (uniqueStrengths.length < 8 && allStrengths.length > uniqueStrengths.length) {
                 const counts = {};
                 allStrengths.forEach(s => counts[s] = (counts[s] || 0) + 1);
                 const sortedByFrequency = Object.entries(counts).sort((a,b) => b[1] - a[1]).map(e => e[0]);
                 uniqueStrengths = [...new Set([...uniqueStrengths, ...sortedByFrequency])];
            }
            return uniqueStrengths.slice(0, 8);
        },
        
        combineChallenges: function(sun, moon, rising) {
            const allWeaknesses = [
                ...zodiacSigns[sun].weaknesses,
                ...zodiacSigns[moon].weaknesses,
                ...zodiacSigns[rising].weaknesses
            ];
            let uniqueWeaknesses = [...new Set(allWeaknesses)];
             if (uniqueWeaknesses.length < 6 && allWeaknesses.length > uniqueWeaknesses.length) {
                 const counts = {};
                 allWeaknesses.forEach(s => counts[s] = (counts[s] || 0) + 1);
                 const sortedByFrequency = Object.entries(counts).sort((a,b) => b[1] - a[1]).map(e => e[0]);
                 uniqueWeaknesses = [...new Set([...uniqueWeaknesses, ...sortedByFrequency])];
            }
            return uniqueWeaknesses.slice(0, 6);
        },
        
        generateRelationshipStyle: function(sun, moon, rising) {
             const sunData = zodiacSigns[sun];
             const moonData = zodiacSigns[moon];
             const risingData = zodiacSigns[rising];
             return `In relationships, your ${sunData.name} Sun seeks ${sunData.keywords[3].toLowerCase()} and expression of ${sunData.element} energy. Your ${moonData.name} Moon dictates your emotional needs, requiring ${moonData.keywords[1].toLowerCase()} and a sense of security aligned with ${moonData.element} qualities. How you initially attract and interact with partners is shaped by your ${risingData.name} Rising, which presents an image of ${risingData.keywords[0].toLowerCase()}. Balancing these can lead to fulfilling connections where your core needs are met while authentically expressing your outer self. For instance, you might need ${moonData.element === 'Water' ? 'deep emotional bonding' : moonData.element === 'Fire' ? 'passionate exchange' : moonData.element === 'Earth' ? 'stable commitment' : 'intellectual connection'} to feel secure (Moon), while outwardly appearing ${risingData.strengths[0].toLowerCase()} (Rising).`;
        },
        
        generateCareerGuidance: function(sun, moon, rising) {
            const sunData = zodiacSigns[sun];
            const moonData = zodiacSigns[moon];
            const risingData = zodiacSigns[rising];
            let careerPaths = `Your ${sunData.name} Sun suggests a core drive towards careers involving ${sunData.keywords[0].toLowerCase()} or utilizing ${sunData.element} qualities (e.g., ${sunData.element === 'Fire' ? 'leadership, pioneering' : sunData.element === 'Earth' ? 'building, managing resources' : sunData.element === 'Air' ? 'communication, teaching' : 'healing, artistic pursuits'}). Your ${moonData.name} Moon indicates you'll find emotional fulfillment in work that offers ${moonData.keywords[2].toLowerCase()} or aligns with ${moonData.element} needs (e.g., ${moonData.element === 'Water' ? 'nurturing roles' : moonData.element === 'Fire' ? 'dynamic environments' : moonData.element === 'Earth' ? 'stable, productive settings' : 'intellectually stimulating work'}). Your ${risingData.name} Rising influences how you are perceived professionally and may open doors in fields that value ${risingData.keywords[1].toLowerCase()} or ${risingData.element} presentation. Ideal careers blend these: for example, a path that allows ${sunData.keywords[0].toLowerCase()} (Sun) in a ${moonData.element.toLowerCase()}-supportive environment (Moon) presented with ${risingData.keywords[0].toLowerCase()} (Rising). Consider fields that integrate these diverse energies for maximum satisfaction and success.`;
            return careerPaths;
        },
        
        generateSpiritualPath: function(sun, moon, rising) {
            const paths = {
                'Fire': 'Action-oriented spirituality, leadership in spiritual groups, dynamic meditation, sun worship, candle magic, sacred dance.',
                'Earth': 'Nature-based practices, grounding rituals, crystal work, herbalism, practical service, ancestor veneration, sacred gardening.',
                'Air': 'Intellectual exploration of spiritual texts, breathwork (pranayama), sound healing, astrology, group discussions, mantra chanting, sacred geometry.',
                'Water': 'Emotional healing practices, intuitive development, dream work, moon ceremonies, scrying, devotional practices, art as spiritual expression.'
            };
            
            const sunElement = zodiacSigns[sun].element;
            const moonElement = zodiacSigns[moon].element;
            const risingElement = zodiacSigns[rising].element;
            
            return `Your spiritual path may involve expressing your ${sunElement} Sun's purpose through ${paths[sunElement]}. Your ${moonElement} Moon seeks emotional resonance in spiritual practices like ${paths[moonElement]}. Your ${risingElement} Rising might draw you to engage with spirituality in ways that align with ${paths[risingElement]}. Integrating these elements, such as using ${sunElement.toLowerCase()} methods to explore ${moonElement.toLowerCase()} themes, and expressing this through your ${risingElement.toLowerCase()} approach, can lead to a deeply fulfilling spiritual journey.`;
        },
        
        recommendCrystals: function(sun, moon, rising) {
            const crystals = [
                ...(zodiacSigns[sun].crystals || []),
                ...(zodiacSigns[moon].crystals || []),
                ...(zodiacSigns[rising].crystals || [])
            ];
            let uniqueCrystals = [...new Set(crystals)];
            if (uniqueCrystals.length > 6) {
                const sunCrystals = zodiacSigns[sun].crystals || [];
                const moonCrystals = zodiacSigns[moon].crystals || [];
                const risingCrystals = zodiacSigns[rising].crystals || [];
                let preferred = [...new Set([...sunCrystals.slice(0,2), ...moonCrystals.slice(0,2), ...risingCrystals.slice(0,2)])];
                if (preferred.length < 6) {
                    preferred = [...new Set([...preferred, ...uniqueCrystals])];
                }
                return preferred.slice(0,6);
            }
            return uniqueCrystals.slice(0, 6); 
        },
        
        generateMantra: function(sun, moon, rising) {
             return `I honor my ${zodiacSigns[sun].name} core essence (${zodiacSigns[sun].keywords[0]}), nurture my ${zodiacSigns[moon].name} heart's wisdom (${zodiacSigns[moon].keywords[1]}), and express my ${zodiacSigns[rising].name} truth (${zodiacSigns[rising].keywords[0]}) with cosmic grace, power, and authenticity.`;
        }
    };    const moonPhases = {
        async calculatePhase(date = new Date()) {
            try {
                const response = await fetch(`${API_BASE_URL}/astrology/moon_phase?date=${date.toISOString()}`);
                if (!response.ok) {
                    throw new Error(`Failed to fetch moon phase: ${response.status}`);
                }
                const data = await response.json();
                return {
                    name: data.phase_name,
                    illumination: data.illumination_percent,
                    influence: data.influence_text,
                    moonSign: data.moon_sign
                };
            } catch (error) {
                console.error('Error fetching moon phase:', error);
                throw error;
            }
        },
        getInfluence: function(phaseName) {
            // Fetches influence from backend via calculatePhase, but provide fallback influences if needed
            const influences = {
                'New Moon': 'Time for new beginnings, setting potent intentions, planting seeds of manifestation. Energy is introspective, potent for initiation, and aligned with your deepest desires.',
                'Waxing Crescent': 'Growing energy, take initial courageous actions on plans, build momentum, nurture intentions. Overcome initial hurdles with faith and focus.',
                'First Quarter': 'Decision point and action. Overcome challenges, make commitments, push through obstacles. Action, adjustment, and willpower are key.',
                'Waxing Gibbous': 'Refine and adjust your approach, fine-tune your goals as they take shape. Energy is building towards culmination. Persevere with dedication.',
                'Full Moon': 'Peak energy and illumination. Harvest results of intentions, release what no longer serves, heightened intuition and emotions. Powerful time for completion and celebration.',
                'Waning Gibbous': 'Gratitude, reflection, and sharing wisdom. Teach others, give back from your bounty. Begin to integrate lessons learned during the cycle.',
                'Last Quarter': 'Release, forgive, and let go. Break bad habits, clear space (physical, mental, emotional) for the new. Re-evaluate and release internal blocks with honesty.',
                'Waning Crescent': 'Rest, reflect, and prepare for renewal. Inner contemplation, surrender, and find peace before the new cycle begins. A time for deep spiritual connection.'
            };
            return influences[phaseName] || 'Cosmic energy flows around you in mysterious ways, tune in to its subtle messages.';
        }
    };

    let currentDateForCalendar = new Date(); 
    let selectedCalendarDate = new Date();  
    let meditationInterval;
    let meditationRemainingTime;

    function init() {
        populateZodiacSelector();
        populateSignSelectors();
        generateCalendar();
        updateMoonPhaseDisplay(); 
        updateDateTime();
        generateCosmicWeather();
        generateCosmicEvents();
        setupTarotReading();
        updateChakraInfo(); 
        populateMantraList();
        updateJournalPrompts(); 
        loadSavedJournalEntries();
        populateDreamSymbolGrid();
        updateRituals(); 
        generateAffirmation();
        const todayISO = new Date().toISOString().split('T')[0];
        if (document.getElementById('biorhythmAnalysisDate')) {
            document.getElementById('biorhythmAnalysisDate').value = todayISO;
        }
        if (document.getElementById('dreamDate')) {
             document.getElementById('dreamDate').value = todayISO;
        }
        setInterval(updateDateTime, 1000);
        if (document.getElementById('biorhythmBirthDate') && document.getElementById('biorhythmBirthDate').value) {
            calculateBiorhythms();
        }
        if (document.getElementById('meditationType')) {
            updateMeditation();
        }
         // Populate knowledge base on init, so search works immediately if user goes to that tab
        if (document.getElementById('knowledgeContent') && !document.getElementById('knowledgeContent').hasChildNodes()) {
            populateKnowledge();
        }
    }

    function updateDateTime() {
        const now = new Date();
        if(document.getElementById('currentDateTime')) {
          document.getElementById('currentDateTime').textContent = now.toLocaleString([], {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit'});
        }
    }

    function generateCosmicWeather() {
        const today = new Date();
        const dayOfWeek = today.getDay(); 
        const dayOfMonth = today.getDate();
        let weatherMessage = "Cosmic energies are active. ";
        const messages = [
            "Planetary alignments suggest a day for introspection and strategic planning for future endeavors.",
            "A dynamic surge of solar and martial energy favors bold actions and initiating new beginnings with courage.",
            "Communication channels are particularly open and clear; an excellent time for meaningful conversations and sharing ideas.",
            "Focus on cultivating relationships and harmony; Venusian energies enhance connection, beauty, and diplomacy.",
            "Mars lends its potent power to your endeavors; tackle challenging tasks with determination and drive.",
            "Jupiter's expansive influence brings optimism and abundant opportunities for growth, learning, and adventure.",
            "Saturn encourages discipline, responsibility, and building solid structures in your personal and professional pursuits.",
            "Lunar tides enhance intuition and emotional sensitivity; trust your inner guidance and pay attention to dreams.",
            "Uranian vibes may bring unexpected insights, sudden changes, or breakthroughs. Embrace flexibility.",
            "Neptunian mists encourage creativity, spiritual connection, and compassionate understanding. Ideal for artistic pursuits.",
            "Plutonic undercurrents urge transformation, deep healing, and confronting hidden truths for empowerment."
        ];
        weatherMessage += messages[(dayOfWeek + dayOfMonth + today.getMonth()) % messages.length]; 
        if (dayOfMonth % 5 === 0 && dayOfMonth !== 0) weatherMessage += " Pay close attention to synchronicities and intuitive nudges today.";
        if (dayOfWeek === 2 || dayOfWeek === 5) weatherMessage += " Creative and relational energies are particularly heightened. Express yourself!"; 
        document.getElementById('cosmicWeather').textContent = weatherMessage;
    }

    function generateCosmicEvents() {
        const today = new Date();
        const month = today.getMonth();
        const year = today.getFullYear();
        const monthlyEvents = [
            [`${year} begins with Capricorn's structured energy. Focus on long-term goals and foundations.`, `Mercury often transits Aquarius mid-month, sparking innovative ideas and futuristic thinking.`, `Full Moon in Cancer around mid-Jan emphasizes home, family, and emotional security.`],
            [`Pisces season mid-month brings intuitive, compassionate, and dreamy vibes. Excellent for creative and spiritual pursuits.`, `Full Moon in Virgo (late Feb/early Mar) highlights health, organization, and attention to detail.`, `Venus may enter Pisces, enhancing romance and idealism.`],
            [`Aries season ignites new beginnings with the Spring Equinox (around Mar 20-21). Energy for action!`, `New Moon in Pisces early March fosters compassionate intentions.`, `Mars might enter a dynamic sign like Gemini, boosting communication and activity.`],
            [`Taurus season (mid-April onwards) encourages grounding, enjoying earthly pleasures, and focusing on material stability.`, `A New Moon in Aries early April fuels initiative.`, `Lyrid meteor shower peaks around April 22-23.`],
            [`Gemini season (mid-May onwards) stimulates communication, learning, and social connections.`, `A Full Moon in Scorpio (late Apr/early May) brings intensity and transformation.`, `Mercury may station retrograde this month: review, reflect, and revise communications and plans.`],
            [`Cancer season begins with the Summer Solstice (around June 20-21), focusing on home, emotions, and nurturing.`, `Jupiter aspects can promote significant growth and expansion opportunities.`, `New Moon in Gemini: fresh ideas and connections.`],
            [`Leo season (mid-July onwards) encourages creativity, joyful expression, and leadership. Shine your light!`, `Full Moon in Capricorn highlights career and responsibilities.`, `Delta Aquariids meteor shower is active throughout late July.`] ,
            [`Virgo season (mid-Aug onwards) emphasizes organization, service, health, and practical matters.`, `New Moon in Leo inspires bold creative intentions.`, `Perseids meteor shower peaks around Aug 12-13: a celestial highlight!`],
            [`Libra season begins with the Autumn Equinox (around Sep 22-23), promoting balance, harmony, and relationships.`, `Full Moon in Pisces (Harvest Moon) illuminates spiritual insights and compassion.`, `Mercury might be retrograde again, urging review of partnerships.`] ,
            [`Scorpio season (mid-Oct onwards) intensifies emotions, transformation, and delving into mysteries.`, `New Moon in Libra focuses on new relationship dynamics and justice.`, `Orionids meteor shower, from Halley's Comet debris, peaks around Oct 21-22.`],
            [`Sagittarius season (mid-Nov onwards) inspires adventure, philosophical exploration, and optimism.`, `Full Moon in Taurus (Beaver Moon) grounds us in sensual reality and abundance.`, `Leonids meteor shower can be active mid-month, sometimes producing fireballs.`],
            [`Capricorn season begins with the Winter Solstice (around Dec 21-22), bringing reflection, planning for the new year, and honoring traditions.`, `New Moon in Sagittarius fuels expansive visions.`, `Geminids meteor shower around Dec 13-14: often the year's most spectacular!`]
        ];
        let eventsHTML = '<ul>';
        const currentMonthEvents = monthlyEvents[month];
        currentMonthEvents.forEach(event => {
            eventsHTML += `<li>${event}</li>`;
        });
        eventsHTML += `<li>The Moon transits through various signs daily, influencing our moods and energies. Check the Cosmic Calendar for specific daily lunar transits and phases!</li>`;
        eventsHTML += '</ul>';
        document.getElementById('cosmicEvents').innerHTML = eventsHTML;
    }

    function populateZodiacSelector() {
        const selector = document.getElementById('zodiacSelector');
        selector.innerHTML = '';
        Object.keys(zodiacSigns).forEach(signKey => {
            const sign = zodiacSigns[signKey];
            const card = document.createElement('div');
            card.className = 'zodiac-card';
            card.onclick = (event) => selectZodiacSign(signKey, event.currentTarget); 
            card.innerHTML = `
                <div class="zodiac-symbol">${sign.symbol}</div>
                <div>${sign.name}</div>
                <div style="font-size: 0.8rem; color: #ccc;">${sign.dates}</div>
            `;
            selector.appendChild(card);
        });
    }

    function populateSignSelectors() {
        const selectors = ['sunSign', 'moonSign', 'risingSign', 'compatSign1', 'compatSign2', 'sunAnalysis', 'moonAnalysis', 'crystalSign', 'ritualSign'];
        selectors.forEach(selectorId => {
            const selector = document.getElementById(selectorId);
            if (selector) {
                selector.innerHTML = '<option value="">Select Sign</option>';
                Object.keys(zodiacSigns).forEach(signKey => {
                    const sign = zodiacSigns[signKey];
                    const option = document.createElement('option');
                    option.value = signKey;
                    option.textContent = `${sign.symbol} ${sign.name}`;
                    selector.appendChild(option);
                });
            }
        });
    }

    function selectZodiacSign(signKey, cardElement) {
        document.querySelectorAll('#zodiacSelector .zodiac-card').forEach(card => {
            card.classList.remove('selected');
        });
        if (cardElement) {
             cardElement.classList.add('selected');
        }
        const signData = zodiacSigns[signKey];
        document.getElementById('dailyInsight').innerHTML = `
            <h3>${signData.symbol} ${signData.name} - Daily Horoscope</h3>
            <p><strong>Today's Cosmic Forecast:</strong> ${signData.dailyHoroscope}</p>
            <div style="margin-top: 15px;">
                <p><strong>Element:</strong> ${signData.element} | <strong>Quality:</strong> ${signData.quality} | <strong>Ruler:</strong> ${signData.ruler}</p>
                <p><strong>Key Strengths Today:</strong> ${signData.strengths.slice(0,3).join(', ')}</p>
                <p><strong>Growth Opportunities:</strong> ${signData.weaknesses.slice(0, 2).join(', ')}</p>
                <p><strong>Lucky Crystals for ${signData.name} today:</strong> ${signData.crystals.slice(0,3).join(', ')}</p>
                <p><strong>Daily Mantra for ${signData.name}:</strong> "${signData.mantra}"</p>
            </div>
        `;
    }

    function generateCalendar() {
        const calendarGrid = document.getElementById('calendarGrid'); 
        const monthHeader = document.getElementById('currentMonth');
        const year = currentDateForCalendar.getFullYear();
        const month = currentDateForCalendar.getMonth();
        monthHeader.textContent = new Date(year, month).toLocaleDateString('en-US', { 
            month: 'long', 
            year: 'numeric' 
        });
        calendarGrid.innerHTML = ''; 
        const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        dayHeaders.forEach(day => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'day-of-week';
            dayHeader.textContent = day;
            calendarGrid.appendChild(dayHeader);
        });
        const firstDayOfMonth = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const today = new Date();
        for (let i = 0; i < firstDayOfMonth; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day';
            calendarGrid.appendChild(emptyDay);
        }
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;
            const currentDayDate = new Date(year, month, day);
            if (year === today.getFullYear() && 
                month === today.getMonth() && 
                day === today.getDate()) {
                dayElement.classList.add('today');
            }
            if (year === selectedCalendarDate.getFullYear() &&
                month === selectedCalendarDate.getMonth() &&
                day === selectedCalendarDate.getDate()) {
                dayElement.classList.add('selected-date');
            }
            if (hasCosmicEventOnDate(currentDayDate)) {
                dayElement.classList.add('has-event');
                dayElement.title = getCosmicEventForDate(currentDayDate).title;
            }
            dayElement.onclick = () => selectCalendarDate(year, month, day, dayElement);
            calendarGrid.appendChild(dayElement);
        }
         updateSelectedDateInfo(); 
    }
    
    function hasCosmicEventOnDate(date) {
        const day = date.getDate();
        const phaseInfo = moonPhases.calculatePhase(date);
        if (phaseInfo.name === 'New Moon' || phaseInfo.name === 'Full Moon' || phaseInfo.name === 'First Quarter' || phaseInfo.name === 'Last Quarter') return true;
        if (day === 1 || day === 10 || day === 20) return true; 
        return false;
    }

    function getCosmicEventForDate(date) {
        const phaseInfo = moonPhases.calculatePhase(date);
         if (phaseInfo.name === 'New Moon' || phaseInfo.name === 'Full Moon' || phaseInfo.name === 'First Quarter' || phaseInfo.name === 'Last Quarter') {
            return { title: phaseInfo.name, description: moonPhases.getInfluence(phaseInfo.name) };
        }
        const day = date.getDate();
        if (day === 1 || day === 10 || day === 20) { 
             const planetKeys = Object.keys(planetaryData);
             const randomPlanet = planetaryData[planetKeys[(date.getMonth() + day) % planetKeys.length]];
             const signKeys = Object.keys(zodiacSigns);
             const randomSign = zodiacSigns[signKeys[(date.getMonth() + day + 3) % signKeys.length]];
             return { title: `${randomPlanet.name} enters ${randomSign.name}`, description: `A shift in collective energy as ${randomPlanet.name} transits into ${randomSign.name}, influencing themes of ${randomPlanet.influence.split(',')[0]} with ${randomSign.keywords[0].toLowerCase()} qualities. Consider how this may impact your personal sphere.`};
        }
        if (day % 7 === 0 && day !==0) { 
             const aspectTypes = ["trine (harmonious)", "sextile (opportunity)", "square (challenge/growth)", "opposition (awareness/balance)", "conjunction (intensification)"];
             const planetKeys = Object.keys(planetaryData);
             let p1 = planetaryData[planetKeys[(date.getDate() + date.getMonth() + 1) % planetKeys.length]];
             let p2 = planetaryData[planetKeys[(date.getDate() + date.getMonth() + 4) % planetKeys.length]];
             if (p1.name === p2.name) p2 = planetaryData[planetKeys[(date.getDate() + date.getMonth() + 5) % planetKeys.length]];
             const aspect = aspectTypes[date.getDate() % aspectTypes.length];
             return { title: `${p1.name} ${aspect} ${p2.name}`, description: `A significant ${aspect} aspect forms between ${p1.name} and ${p2.name}. This suggests a day to be mindful of the interplay between ${p1.influence.split(',')[0]} and ${p2.influence.split(',')[0]}. Use this cosmic weather to your advantage.`};
        }
        return { title: "General Cosmic Flow", description: "A day for mindful awareness of subtle energies. Observe how the current planetary transits (see Planet Tracker tab) might be influencing your day." };
    }

    function selectCalendarDate(year, month, day, element) {
        selectedCalendarDate = new Date(year, month, day);
        document.querySelectorAll('#calendarGrid .calendar-day').forEach(d => d.classList.remove('selected-date'));
        if (element) element.classList.add('selected-date');
        updateSelectedDateInfo();
    }    async function updateSelectedDateInfo() {
        const infoContainer = document.getElementById('selectedDateInfo');
        try {
            const phaseForSelectedDate = await moonPhases.calculatePhase(selectedCalendarDate);
            const eventOnDate = getCosmicEventForDate(selectedCalendarDate);
            const dayOfWeek = selectedCalendarDate.getDay(); 
            const rulingPlanetsOfWeek = ["Sun (Self, Vitality)", "Moon (Emotions, Intuition)", "Mars (Action, Drive)", "Mercury (Communication, Intellect)", "Jupiter (Expansion, Luck)", "Venus (Love, Harmony)", "Saturn (Discipline, Structure)"];
            
            infoContainer.innerHTML = `
                <h4>Influences for ${selectedCalendarDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}:</h4>
                <p><strong>Day Ruled By:</strong> ${rulingPlanetsOfWeek[dayOfWeek]}</p>
                <p><strong>Moon Phase:</strong> ${phaseForSelectedDate.name} (${Math.round(phaseForSelectedDate.illumination)}% illuminated)${phaseForSelectedDate.moonSign?.name ? ` ‚Ä¢ Moon in ${phaseForSelectedDate.moonSign.name}` : ''}</p>
                <p><em>${phaseForSelectedDate.influence}</em></p>
                <p><strong>Main Cosmic Event:</strong> ${eventOnDate.title}</p>
                <p><em>${eventOnDate.description}</em></p>
                <p><strong>Personal Focus:</strong> A good day for ${ selectedCalendarDate.getDay() % 2 === 0 ? 'reflection, planning, and creative endeavors' : 'action, connection, and initiating projects'}. Consider how these energies align with your personal goals and current zodiac sign's daily horoscope.</p>
            `;
        } catch (error) {
            console.error('Error updating selected date info:', error);
            infoContainer.innerHTML = `
                <h4>Influences for ${selectedCalendarDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}:</h4>
                <p>Unable to load moon phase and cosmic event data. Please try again later.</p>
            `;
        }
    }

    function changeMonth(direction) {
        currentDateForCalendar.setMonth(currentDateForCalendar.getMonth() + direction);
        selectedCalendarDate = new Date(currentDateForCalendar.getFullYear(), currentDateForCalendar.getMonth(), 1);
        generateCalendar();
    }    async function updateMoonPhaseDisplay() { 
        try {
            const moonPhaseElement = document.getElementById('moonPhaseText');
            const moonInfluenceElement = document.getElementById('moonInfluence');
            const moonVisual = document.getElementById('moonPhaseVisual');

            if (!moonPhaseElement || !moonInfluenceElement || !moonVisual) {
                throw new Error('Required moon phase display elements not found in the document');
            }

            const phaseResult = await moonPhases.calculatePhase(); 
            const phaseName = phaseResult.name;
            const illumination = phaseResult.illumination;
            const influence = phaseResult.influence;
            const moonSign = phaseResult.moonSign?.name || '';

            moonPhaseElement.textContent = `${phaseName} (${Math.round(illumination)}% illuminated)${moonSign ? ` ‚Ä¢ Moon in ${moonSign}` : ''}`;
            moonInfluenceElement.textContent = influence;

            if (phaseName === "New Moon") {
                moonVisual.style.background = '#333333'; 
                moonVisual.style.boxShadow = 'inset -5px 0px 10px rgba(0,0,0,0.2)';
            } else if (phaseName === "Full Moon") {
                moonVisual.style.background = '#f0f0f0'; 
                moonVisual.style.boxShadow = 'inset 0px 0px 10px rgba(0,0,0,0.1)';
            } else if (phaseName.includes("Waxing")) { 
                moonVisual.style.background = `linear-gradient(to left, #f0f0f0 ${illumination}%, #333333 ${illumination}%)`;
                moonVisual.style.boxShadow = `inset ${-5 + (illumination/20)}px 0px 10px rgba(0,0,0,0.3)`;
            } else { 
                moonVisual.style.background = `linear-gradient(to right, #f0f0f0 ${illumination}%, #333333 ${illumination}%)`;
                moonVisual.style.boxShadow = `inset ${5 - (illumination/20)}px 0px 10px rgba(0,0,0,0.3)`;            }
        } catch (error) {
            console.error('Error updating moon phase display:', error);
            // Try to show error in UI elements if they exist
            const moonPhaseElement = document.getElementById('moonPhaseText');
            const moonInfluenceElement = document.getElementById('moonInfluence');
            if (moonPhaseElement) moonPhaseElement.textContent = 'Unable to load moon phase';
            if (moonInfluenceElement) moonInfluenceElement.textContent = 'Please try again later';
        }
    }

    function updateCombination() {
        const sun = document.getElementById('sunSign').value;
        const moon = document.getElementById('moonSign').value;
        const rising = document.getElementById('risingSign').value;
        const resultContainer = document.getElementById('combinationResult');
        if (sun && moon && rising) {
            const combination = signCombinations.generateCombination(sun, moon, rising);
            resultContainer.innerHTML = `
                <h3>${combination.title}</h3>
                <p><strong>Cosmic Personality Blueprint:</strong> ${combination.description}</p>
                <p style="margin-top:10px;"><strong>Detailed Profile:</strong> ${combination.personality}</p>
                <div style="margin-top: 15px;"><h4>Core Strengths:</h4><p>${combination.strengths.join(', ')}.</p></div>
                <div style="margin-top: 15px;"><h4>Growth Opportunities (Areas for Awareness):</h4><p>${combination.challenges.join(', ')}.</p></div>
                <div style="margin-top: 15px;"><h4>Relationship Dynamics:</h4><p>${combination.relationships}</p></div>
                <div style="margin-top: 15px;"><h4>Career & Life Purpose Guidance:</h4><p>${combination.career}</p></div>
                <div style="margin-top: 15px;"><h4>Spiritual Evolution Path:</h4><p>${combination.spirituality}</p></div>
                <div style="margin-top: 15px;"><h4>Recommended Crystals for Your Combination:</h4><p>${combination.crystals.length > 0 ? combination.crystals.join(', ') : 'Select signs to see recommendations.'}</p></div>
                <div style="margin-top: 15px;"><h4>Personal Mantra for Integration:</h4><p>"${combination.mantra}"</p></div>
            `;
        } else {
            resultContainer.innerHTML = '<p>Select your sun, moon, and rising signs to see your complete astrological profile.</p>';
        }
    }

    function updateCompatibility() {
        const sign1 = document.getElementById('compatSign1').value;
        const sign2 = document.getElementById('compatSign2').value;
        const resultsContainer = document.getElementById('compatibilityResults');
        if (sign1 && sign2) {
            const score = compatibilityMatrix[sign1][sign2];
            const compatibility = getCompatibilityAnalysis(sign1, sign2, score);
            resultsContainer.innerHTML = `
                <div class="compatibility-item" style="grid-column: 1 / -1; background: rgba(255,255,255,0.15);">
                    <div class="compatibility-score" style="color: ${getScoreColor(score)}; font-size: 2rem;">${score}%</div>
                    <div>Overall Compatibility: ${zodiacSigns[sign1].name} & ${zodiacSigns[sign2].name}</div>
                </div>
                <div class="compatibility-item"><div class="compatibility-score" style="color: ${getScoreColor(compatibility.love)};">${compatibility.love}%</div><div>Romantic Love</div></div>
                <div class="compatibility-item"><div class="compatibility-score" style="color: ${getScoreColor(compatibility.friendship)};">${compatibility.friendship}%</div><div>Friendship</div></div>
                <div class="compatibility-item"><div class="compatibility-score" style="color: ${getScoreColor(compatibility.business)};">${compatibility.business}%</div><div>Business Partnership</div></div>
                <div class="compatibility-item"><div class="compatibility-score" style="color: ${getScoreColor(compatibility.communication)};">${compatibility.communication}%</div><div>Communication Style</div></div>
                <div class="compatibility-item"><div class="compatibility-score" style="color: ${getScoreColor(compatibility.intimacy)};">${compatibility.intimacy}%</div><div>Emotional Intimacy</div></div>
                <div class="compatibility-item"><div class="compatibility-score" style="color: ${getScoreColor(compatibility.trust)};">${compatibility.trust}%</div><div>Trust Factor</div></div>
                <div class="interpretation" style="grid-column: 1 / -1; margin-top: 20px;">
                    <h4>Detailed Cosmic Analysis:</h4><p>${compatibility.analysis}</p>
                    <h4 style="margin-top: 15px;">Relationship Strengths:</h4><p>${compatibility.strengths}</p>
                    <h4 style="margin-top: 15px;">Potential Challenges:</h4><p>${compatibility.challenges}</p>
                    <h4 style="margin-top: 15px;">Relationship Guidance:</h4><p>${compatibility.advice}</p>
                    <h4 style="margin-top: 15px;">Recommended Activities for Harmony:</h4><p>${compatibility.activities}</p>
                </div>
            `;
        } else {
             resultsContainer.innerHTML = '<p>Select two signs to see their compatibility analysis.</p>';
        }
    }

    function getCompatibilityAnalysis(sign1, sign2, score) {
        const sign1Data = zodiacSigns[sign1];
        const sign2Data = zodiacSigns[sign2];
        const baseVariation = 15; 
        const love = Math.min(100, Math.max(0, Math.round(score + (Math.random() * baseVariation * 2) - baseVariation)));
        const friendship = Math.min(100, Math.max(0, Math.round(score + (Math.random() * baseVariation * 1.5) - baseVariation * 0.75)));
        const business = Math.min(100, Math.max(0, Math.round(score + (Math.random() * baseVariation * 1.2) - baseVariation * 0.6)));
        const communication = Math.min(100, Math.max(0, Math.round(getElementalCompatibility(sign1Data.element, sign2Data.element, 'communication') * 20 + score * 0.8 + (Math.random() * 10) - 5)));
        const intimacy = Math.min(100, Math.max(0, Math.round(getElementalCompatibility(sign1Data.element, sign2Data.element, 'intimacy') * 25 + score * 0.75 + (Math.random() * 10) - 5)));
        const trust = Math.min(100, Math.max(0, Math.round(getQualityCompatibility(sign1Data.quality, sign2Data.quality, 'trust') * 20 + score * 0.8 + (Math.random() * 10) - 5)));
        const analysis = `${sign1Data.name} (a ${sign1Data.element} ${sign1Data.quality} sign) and ${sign2Data.name} (a ${sign2Data.element} ${sign2Data.quality} sign) create a connection rated at ${score}%. Their respective ${sign1Data.element} and ${sign2Data.element} elements interact by ${getElementInteraction(sign1Data.element, sign2Data.element)}. The way their ${sign1Data.quality} and ${sign2Data.quality} qualities combine suggests a dynamic that is ${getQualityInteraction(sign1Data.quality, sign2Data.quality)}. This interplay forms the foundation of their interactions.`;
        const strengths = getCompatibilityStrengths(sign1Data, sign2Data, score);
        const challenges = getCompatibilityChallenges(sign1Data, sign2Data, score);
        const advice = score > 75 ? 
            `This is a naturally harmonious pairing with strong potential for deep understanding and mutual support. Nurture your shared vision and celebrate your complementary energies. Focus on open, heart-centered communication about individual needs and dreams to maintain this beautiful flow and continue growing together.` :
            score > 50 ?
            `This connection holds good potential with conscious effort and mutual understanding. Appreciate your differences as avenues for growth and learning. Focus on active listening, mutual respect, and finding common goals to build a strong and resilient foundation. Celebrate the unique qualities each brings.` :
            `This pairing presents significant learning opportunities, requiring patience, empathy, and a willingness to adapt from both sides. Clear communication, respecting individual differences, and celebrating small victories in understanding are crucial. View challenges as invitations to expand your consciousness together.`;
        const activities = getCompatibilityActivities(sign1Data.element, sign2Data.element);
        return { love, friendship, business, communication, intimacy, trust, analysis, advice, activities, strengths, challenges };
    }

    function getElementalCompatibility(el1, el2, type) {
        if (el1 === el2) return 5; 
        if ((el1 === 'Fire' && el2 === 'Air') || (el1 === 'Air' && el2 === 'Fire')) return type === 'communication' ? 5 : 4; 
        if ((el1 === 'Earth' && el2 === 'Water') || (el1 === 'Water' && el2 === 'Earth')) return type === 'intimacy' ? 5 : 4; 
        if ((el1 === 'Fire' && el2 === 'Earth') || (el1 === 'Earth' && el2 === 'Fire')) return 2; 
        if ((el1 === 'Fire' && el2 === 'Water') || (el1 === 'Water' && el2 === 'Fire')) return 2;
        if ((el1 === 'Earth' && el2 === 'Air') || (el1 === 'Air' && el2 === 'Earth')) return 2;
        if ((el1 === 'Air' && el2 === 'Water') || (el1 === 'Water' && el2 === 'Air')) return 2;
        return 3; 
    }

    function getQualityCompatibility(q1, q2, type) { 
        if (q1 === q2) { 
            if (q1 === 'Cardinal') return type === 'trust' ? 3 : 3; 
            if (q1 === 'Fixed') return type === 'trust' ? 5 : 4; 
            if (q1 === 'Mutable') return type === 'trust' ? 4 : 4; 
        }
        if ((q1 === 'Cardinal' && q2 === 'Fixed') || (q1 === 'Fixed' && q2 === 'Cardinal')) return 4; 
        if ((q1 === 'Cardinal' && q2 === 'Mutable') || (q1 === 'Mutable' && q2 === 'Cardinal')) return 5; 
        if ((q1 === 'Fixed' && q2 === 'Mutable') || (q1 === 'Mutable' && q2 === 'Fixed')) return 4; 
        return 3;
    }

    function getCompatibilityStrengths(s1, s2, score) {
        let strengths = [];
        if (s1.element === s2.element) strengths.push("Shared elemental understanding, similar energy levels, and approach to life.");
        else if (((s1.element === 'Fire' && s2.element === 'Air') || (s1.element === 'Air' && s2.element === 'Fire'))) strengths.push("Stimulating intellectual and energetic connection, mutual inspiration.");
        else if (((s1.element === 'Earth' && s2.element === 'Water') || (s1.element === 'Water' && s2.element === 'Earth'))) strengths.push("Supportive, nurturing, and emotionally resonant bond, practical care meets intuitive understanding.");
        if (s1.quality === s2.quality && score > 60) strengths.push(`Similar approach to action (${s1.quality}) can lead to synchronized efforts.`);
        else if (s1.quality !== s2.quality && score > 65) strengths.push("Different qualities can be complementary, e.g., one initiates (Cardinal), other sustains (Fixed) or adapts (Mutable).");
        if (score > 80) strengths.push("High degree of natural resonance, mutual attraction, and ease of understanding.");
        else if (score > 65) strengths.push("Good potential for balanced give-and-take and mutual growth.");
        if (strengths.length === 0) strengths.push("Unique blend of energies that, with understanding, can be highly complementary and offer diverse perspectives to the relationship.");
        return strengths.join(' ');
    }

    function getCompatibilityChallenges(s1, s2, score) {
        let challenges = [];
         const nonHarmoniousElements = !(((s1.element === 'Fire' && s2.element === 'Air') || (s1.element === 'Air' && s2.element === 'Fire')) || ((s1.element === 'Earth' && s2.element === 'Water') || (s1.element === 'Water' && s2.element === 'Earth')) || (s1.element === s2.element));
        if (nonHarmoniousElements) {
             challenges.push(`Differing elemental approaches (e.g., ${s1.element}'s ${s1.keywords[0].toLowerCase()} vs. ${s2.element}'s ${s2.keywords[0].toLowerCase()}) may lead to misunderstandings if not actively communicated and respected.`);
        }
        if (s1.quality === 'Fixed' && s2.quality === 'Fixed') challenges.push("Potential for stubbornness or power struggles if both dig in their heels; compromise is key.");
        if (s1.quality === 'Cardinal' && s2.quality === 'Cardinal') challenges.push("May compete for leadership or initiative if roles and collaboration aren't clearly defined and respected.");
        if (s1.quality === 'Mutable' && s2.quality === 'Mutable') challenges.push("Could lack direction or follow-through at times if both are too adaptable; grounding shared goals is important.");
        if (score < 40) challenges.push("Significant differences in core values, energy levels, or life approach may require substantial, ongoing effort and mutual commitment to bridge effectively.");
        else if (score < 60 && challenges.length === 0) challenges.push("Requires conscious effort to understand each other's differing perspectives, communication styles, and emotional needs. Patience is vital.");
        if (challenges.length === 0) challenges.push("Like all relationships, ongoing open communication, mutual respect, and a willingness to grow together are essential to navigate any potential differences and thrive.");
        return challenges.join(' ');
    }

    function getCompatibilityActivities(element1, element2) {
        const activities = {
            'Fire-Fire': 'Adventure sports, spontaneous travel, co-creating passionate projects, lively social events, dancing, competitive but fun games, exploring new hobbies with zeal.',
            'Fire-Earth': 'Outdoor hiking or camping, gardening together, building or renovating something tangible, cooking elaborate and satisfying meals, nature photography, creating a cozy and inspiring home space.',
            'Fire-Air': 'Engaging in stimulating intellectual debates, traveling to new cultures or cities, learning new skills or languages together, attending vibrant social events, brainstorming innovative ideas, joining a book club or discussion group.',
            'Fire-Water': 'Relaxing spa retreats or hot springs, collaborative artistic pursuits (painting, music, writing), emotional healing workshops or couples therapy (if needed), water sports, couples meditation for balancing energies, volunteering for a cause you both feel passionately about.',
            'Earth-Earth': 'Gardening or landscaping, home improvement projects, detailed financial planning for shared long-term goals, serene nature walks, practical crafts (pottery, woodworking), cooking traditional comfort food, collecting antiques or valuable items.',
            'Earth-Air': 'Visiting museums or historical sites, attending educational classes or lectures together, organizing community projects or events, playing strategic board games, reading and discussing insightful books, meticulously planning future trips or ventures.',
            'Earth-Water': 'Cooking gourmet meals or baking together, co-creating healing practices (e.g., massage, reiki), spending quiet, quality time in nature (beach, forest), creating beautiful and comfortable home environments, nurturing plants, pets, or even a small business.',
            'Air-Air': 'Engaging in lively intellectual discussions and debates, attending diverse social gatherings and networking events, traveling to stimulating and culturally rich places, collaborative writing, tech projects, or research, continuously learning new things together, playing word games or puzzles.',
            'Air-Water': 'Co-writing poetry, songs, or stories, listening to evocative music together and discussing its meaning, engaging in deep therapeutic conversations, exploring shared spiritual practices or philosophies, artistic collaborations (e.g., photography with storytelling), visiting art galleries or attending performances that stir the soul.',
            'Water-Water': 'Engaging in deep emotional healing work or spiritual retreats, shared spiritual practices (meditation, prayer), quiet, intimate evenings with meaningful connection, co-creating art, music, or poetry from the heart, dream sharing and interpretation, volunteering for compassionate causes or animal shelters.'
        };
        const key = `${element1}-${element2}`;
        const reverseKey = `${element2}-${element1}`;
        return activities[key] || activities[reverseKey] || 'Exploring new shared experiences that honor both of your unique natures, such as taking a creative class, visiting a place neither has been, or starting a meaningful shared project that combines your talents.';
    }

    function getElementInteraction(element1, element2) {
        const interactions = {
            'Fire-Fire': 'ignites and amplifies passion, action, and enthusiasm, but can also lead to burn-out if not managed.',
            'Fire-Earth': 'can either energize and ground fire\'s ideas into practical form, or create frustration with differing paces and approaches (Fire\'s impulsiveness vs. Earth\'s deliberation).',
            'Fire-Air': 'feeds and inspires intellectual excitement, dynamic expression, and expansive ideas. Air fans Fire\'s flames.',
            'Fire-Water': 'creates steam and passionate transformation, potentially leading to intense emotional experiences or, if unbalanced, emotional overwhelm or extinguishment.',
            'Earth-Earth': 'grounds, stabilizes, and builds solid, lasting foundations together with shared practicality and patience.',
            'Earth-Air': 'provides a practical foundation for Air\'s ideas, but may sometimes feel restrictive to Air\'s need for freedom or too flighty/unrealistic for Earth\'s pragmatic nature.',
            'Earth-Water': 'nourishes, supports, and creates a fertile ground for emotional growth, stability, and deep, tangible care. Water softens and enriches Earth.',
            'Air-Air': 'stimulates intellectual synergy, enhances communication flow, and thrives on shared ideas and social connections.',
            'Air-Water': 'can create gentle movement and inspiration through shared imagination, or feel like trying to grasp mist if communication styles and emotional processing differ greatly. Requires empathy.',
            'Water-Water': 'flows together in deep harmony, creating profound emotional, intuitive, and empathetic understanding, but can also lead to over-sensitivity if not grounded.'
        };
         const key = `${element1}-${element2}`;
         const reverseKey = `${element2}-${element1}`;
        return interactions[key] || interactions[reverseKey] || 'interacts in unique and complex cosmic ways, offering opportunities for growth and understanding.';
    }

    function getQualityInteraction(q1, q2) {
        if (q1 === q2) {
            if (q1 === 'Cardinal') return "both highly initiative, potentially leading to dynamic collaboration when aligned or competition for leadership if not.";
            if (q1 === 'Fixed') return "both very determined, loyal, and stable, possibly leading to immense strength and endurance or stubborn deadlocks if perspectives differ.";
            if (q1 === 'Mutable') return "both highly adaptable, flexible, and resourceful, enjoying variety and change but perhaps lacking sustained follow-through without external structure or conscious effort.";
        }
        if ((q1 === 'Cardinal' && q2 === 'Fixed') || (q1 === 'Fixed' && q2 === 'Cardinal')) return "a powerful blend of initiation and stabilization; Cardinal starts projects, Fixed sustains and completes them, creating effective teamwork.";
        if ((q1 === 'Cardinal' && q2 === 'Mutable') || (q1 === 'Mutable' && q2 === 'Cardinal')) return "a dynamic of starting new things and then adapting or diversifying them; Cardinal initiates, Mutable refines and explores various angles, fostering innovation.";
        if ((q1 === 'Fixed' && q2 === 'Mutable') || (q1 === 'Mutable' && q2 === 'Fixed')) return "a mix of stability and flexibility; Fixed provides a solid foundation and endurance, while Mutable brings adaptability, resourcefulness, and ease with change.";
        return "a unique interaction of energies, offering distinct approaches to life that can be either complementary or challenging depending on awareness and communication."
    }

    function getScoreColor(score) {
        if (score >= 80) return '#4CAF50'; 
        if (score >= 65) return '#8BC34A'; 
        if (score >= 50) return '#FFC107'; 
        if (score >= 35) return '#FF9800'; 
        return '#F44336'; 
    }

    function updateMoonSunAnalysis() {
        const sun = document.getElementById('sunAnalysis').value;
        const moon = document.getElementById('moonAnalysis').value;
        const resultContainer = document.getElementById('moonSunResult');
        if (sun && moon) {
            const analysis = generateMoonSunAnalysis(sun, moon);
            resultContainer.innerHTML = analysis;
        } else {
            resultContainer.innerHTML = '<p>Select your sun and moon signs to understand how they interact and influence your personality.</p>';
        }
    }

    function generateMoonSunAnalysis(sun, moon) {
        const sunData = zodiacSigns[sun];
        const moonData = zodiacSigns[moon];
        const emotionalNature = moonData.element === 'Water' ? `deeply emotional, intuitive, and psychically sensitive, finding security in emotional connection, empathy, and nurturing environments` :
                         moonData.element === 'Fire' ? `passionate, reactive, and emotionally expressive, needing freedom for emotional outbursts, enthusiasm, and directness in feelings` :
                         moonData.element === 'Earth' ? `stable, practical, and emotionally grounded, seeking security through tangible means, consistent affection, and reliable routines` :
                         `intellectual, communicative, and sometimes emotionally detached, needing mental stimulation, rational understanding of feelings, and freedom of thought in emotional matters`;
        const consciousExpression = sunData.element === 'Fire' ? `dynamic, action-oriented, and leadership-focused, expressing vitality, courage, and a pioneering spirit` :
                         sunData.element === 'Earth' ? `practical, goal-focused, and achievement-oriented, building tangible results, seeking stability, and valuing sensory experiences` :
                         sunData.element === 'Air' ? `intellectual, communicative, and socially aware, expressing ideas, connecting with others, and valuing logic and objectivity` :
                         `intuitive, flowing, and spiritually connected, expressing compassion, imagination, and empathy`;
        return `
            <h3>${sunData.symbol} ${sunData.name} Sun with ${moonData.symbol} ${moonData.name} Moon</h3>
            <div style="margin-top: 15px;"><h4>Conscious Self Expression (Sun in ${sunData.name}):</h4><p>Your core identity, vitality, and life purpose are ${consciousExpression}. You are driven by ${sunData.keywords.slice(0,2).join(' and ').toLowerCase()}. Your solar mission involves ${getSolarMission(sunData)}.</p></div>
            <div style="margin-top: 15px;"><h4>Emotional Inner World & Needs (Moon in ${moonData.name}):</h4><p>Your emotional nature, subconscious patterns, and what makes you feel secure are ${emotionalNature}. You process feelings through ${moonData.keywords.slice(0,2).join(' and ').toLowerCase()}. Your lunar needs include ${getLunarNeeds(moonData)}.</p></div>
            <div style="margin-top: 15px;"><h4>Integration and Cosmic Balance: Your Sun-Moon Blend</h4><p>${getIntegrationAnalysis(sunData, moonData)} This means your conscious drive (${sunData.name} Sun) and emotional needs (${moonData.name} Moon) ${sunData.element === moonData.element ? 'are naturally aligned, creating inner harmony and direct expression' : ((sunData.element === 'Fire' && moonData.element === 'Air') || (sunData.element === 'Air' && moonData.element === 'Fire') || (sunData.element === 'Earth' && moonData.element === 'Water') || (sunData.element === 'Water' && moonData.element === 'Earth') ? 'are complementary and supportive, offering a balanced approach to life' : 'may require conscious effort to harmonize, presenting a dynamic tension that offers great potential for growth and self-mastery')}.</p></div>
            <div style="margin-top: 15px;"><h4>Soul Purpose and Life Mission Potential:</h4><p>${getLifePurpose(sunData, moonData)}</p></div>
            <div style="margin-top: 15px;"><h4>Path to Harmony and Growth:</h4><p>${getHealingPath(sunData, moonData)} The key is to consciously honor both your ${sunData.name} Sun's drive for outward expression and purpose, and your ${moonData.name} Moon's need for inner emotional security and fulfillment.</p></div>
        `;
    }

    function getSolarMission(sunData) {
        const missions = {
            'Aries': 'pioneering new paths, initiating action, and inspiring others to take courageous steps towards their goals and authentic self-expression.',
            'Taurus': 'creating beauty, stability, and abundance in the material world, valuing sensory experiences, and building lasting, reliable structures.',
            'Gemini': 'sharing knowledge, facilitating communication, connecting diverse ideas and people, and exploring intellectual curiosity with versatility.',
            'Cancer': 'nurturing others, preserving emotional wisdom, creating safe, loving environments, and connecting deeply with family and heritage.',
            'Leo': 'expressing creativity, leading with a generous heart, inspiring joy and confidence in others, and shining their unique light authentically.',
            'Virgo': 'serving others through practical skills, healing, meticulous attention to detail, improving systems, and promoting well-being.',
            'Libra': 'creating harmony, promoting justice and fairness, beautifying the world through art and balanced relationships, and fostering cooperation.',
            'Scorpio': 'facilitating transformation, healing deep wounds, revealing hidden truths with intensity and passion, and empowering self and others.',
            'Sagittarius': 'expanding consciousness, teaching wisdom, exploring new horizons with optimism and adventure, and seeking ultimate truth and meaning.',
            'Capricorn': 'building lasting structures of integrity, achieving mastery through discipline, leading with responsibility, and contributing to societal order.',
            'Aquarius': 'revolutionizing society, promoting equality and humanitarian ideals, advancing human consciousness through innovation, and fostering community.',
            'Pisces': 'channeling divine inspiration, healing through compassion and empathy, serving the collective good, and expressing universal love through art and spirituality.'
        };
        return missions[sunData.name];
    }

    function getLunarNeeds(moonData) {
        const needs = {
            'Aries': 'emotional independence, excitement, direct expression of feelings, and the freedom to act on emotional impulses without constraint.',
            'Taurus': 'deep emotional security through stability, physical comfort, sensual pleasures, reliable routines, and tangible expressions of affection.',
            'Gemini': 'variety in emotional experiences, intellectual stimulation regarding feelings, constant open communication, and mental freedom in relationships.',
            'Cancer': 'profound emotional security, strong family and home connections, a nurturing and safe environment, and empathetic, understanding responses from others.',
            'Leo': 'emotional appreciation and validation, creative self-expression to be seen and admired, to feel special, loved, and central in their emotional world.',
            'Virgo': 'emotional order and predictability, feeling useful and needed by others, and the ability to analyze, improve, and perfect emotional situations and well-being.',
            'Libra': 'emotional harmony and balance, beauty in surroundings and relationships, partnership, and peaceful, fair, and just interactions.',
            'Scorpio': 'intense emotional connection and depth, privacy for processing feelings, transformative emotional experiences, and unwavering loyalty and trust.',
            'Sagittarius': 'emotional freedom and space, adventurous expression of feelings, philosophical understanding and meaning in emotions, and unwavering optimism.',
            'Capricorn': 'emotional control, respect, and recognition, achieving emotional stability through structure, clear boundaries, and gradual progress in commitments.',
            'Aquarius': 'emotional independence and detachment, intellectual freedom regarding feelings, connection to broader humanitarian or group emotional causes, and unconventional expression.',
            'Pisces': 'deep spiritual connection in emotions, artistic and imaginative expression of feelings, compassionate service to others, and unconditional acceptance and empathy.'
        };
        return needs[moonData.name];
    }

    function getIntegrationAnalysis(sunData, moonData) {
        if (sunData.element === moonData.element) {
            return `With both your Sun and Moon in ${sunData.element} signs (e.g., ${sunData.name} Sun, ${moonData.name} Moon), you possess a unified and powerful cosmic signature. Your conscious goals and emotional needs flow together harmoniously, creating inner coherence and clear, direct expression of your ${sunData.element} nature. This alignment gives you focused energy and natural authenticity. A potential growth area is to consciously cultivate awareness and appreciation for other elemental energies to broaden your perspective and responses.`;
        }
        const complementary = ((sunData.element === 'Fire' && moonData.element === 'Air') || (sunData.element === 'Air' && moonData.element === 'Fire')) ||
                             ((sunData.element === 'Earth' && moonData.element === 'Water') || (sunData.element === 'Water' && moonData.element === 'Earth'));
        if (complementary) {
            return `Your ${sunData.element} Sun and ${moonData.element} Moon (e.g., ${sunData.name} Sun, ${moonData.name} Moon) create a beautifully complementary cosmic dance. You naturally integrate the qualities of these harmonious elements ‚Äì for instance, ${sunData.element.toLowerCase()} ${sunData.element === 'Fire' ? 'action/inspiration' : sunData.element === 'Air' ? 'ideas/communication' : sunData.element === 'Earth' ? 'practicality/stability' : 'intuition/empathy'} with ${moonData.element.toLowerCase()} ${moonData.element === 'Fire' ? 'passion/enthusiasm' : moonData.element === 'Air' ? 'intellect/social connection' : moonData.element === 'Earth' ? 'groundedness/sensuality' : 'compassion/creativity'}. This synergy creates a well-rounded, resourceful approach to life.`;
        }
         if (((sunData.element === 'Fire' || sunData.element === 'Air') && (moonData.element === 'Earth' || moonData.element === 'Water')) ||
            ((sunData.element === 'Earth' || sunData.element === 'Water') && (moonData.element === 'Fire' || moonData.element === 'Air'))) {
            return `Your ${sunData.element} Sun and ${moonData.element} Moon (e.g., ${sunData.name} Sun, ${moonData.name} Moon) create a dynamic and complex inner landscape. This cosmic tension between your conscious purpose (related to ${sunData.element}) and emotional nature (rooted in ${moonData.element}) provides rich opportunities for profound growth. Mastering the art of balancing these seemingly disparate energies ‚Äì for instance, your ${sunData.element} drive for ${sunData.keywords[0].toLowerCase()} with your ${moonData.element} need for ${moonData.keywords[0].toLowerCase()} ‚Äì leads to a powerful, unique, and highly resourceful synthesis. This integration is a key part of your soul's journey.`;
        }
        return `The interaction between your ${sunData.element} Sun and ${moonData.element} Moon creates a unique inner dynamic. Your conscious expression (${sunData.name}) may sometimes be at odds with, or need to learn from, your emotional core (${moonData.name}). This offers specific pathways for personal development, self-understanding, and achieving inner balance.`;
    }

    function getLifePurpose(sunData, moonData) {
        return `Your life purpose likely involves skillfully expressing the core qualities of your ${sunData.name} Sun (such as its drive for ${sunData.keywords[0].toLowerCase()} and inherent ${sunData.strengths[0].toLowerCase()}) in a manner that deeply satisfies the emotional needs and intuitive wisdom of your ${moonData.name} Moon (like its yearning for ${moonData.keywords[1].toLowerCase()} and its capacity to feel ${moonData.strengths[1].toLowerCase()}). For example, you might be driven to ${sunData.element === 'Fire' ? 'pioneer and lead' : sunData.element === 'Earth' ? 'build and stabilize' : sunData.element === 'Air' ? 'communicate and innovate' : 'heal and connect'} (Sun) in a way that ensures ${moonData.element === 'Water' ? 'emotional depth and security' : moonData.element === 'Fire' ? 'passionate fulfillment' : moonData.element === 'Earth' ? 'tangible comfort and reliability' : 'intellectual resonance and freedom'} (Moon) for yourself and potentially for others. The specific house placements of your Sun and Moon in a full natal chart would further define the arenas of life where this purpose unfolds most powerfully.`;
    }

    function getHealingPath(sunData, moonData) {
        const sunEl = sunData.element;
        const moonEl = moonData.element;
        let path = `Your path to inner harmony and growth involves consciously integrating your ${sunEl} Sun's essential drive for ${sunData.keywords[0].toLowerCase()} and self-expression with your ${moonEl} Moon's fundamental need for ${moonData.keywords[0].toLowerCase()} and emotional well-being. `;
        if (sunEl === moonEl) {
            path += `Since your core identity and emotional nature share the same element (${sunEl}), your challenge is to ensure this powerful energy doesn't become one-sided. Balance comes from consciously cultivating the qualities of the opposing element (e.g., if Fire, cultivate Water's empathy; if Earth, Air's flexibility; if Air, Earth's grounding; if Water, Fire's action).`;
        } else if ((sunEl === 'Fire' && moonEl === 'Water') || (sunEl === 'Water' && moonEl === 'Fire')) {
            path += `This dynamic combination can create internal 'steam' or powerful creative tension. Healing and balance are found when passionate action (Fire) is deeply informed by intuition and emotional wisdom (Water), and when profound emotions (Water) are expressed dynamically and courageously (Fire) without suppression or destructive outbursts. Learning to flow between these potent energies is key.`;
        } else if ((sunEl === 'Earth' && moonEl === 'Air') || (sunEl === 'Air' && moonEl === 'Earth')) {
            path += `Your journey involves bridging the realms of thought and tangible reality. If Sun is Air and Moon Earth: ground your brilliant ideas in practical application and build stable foundations for your intellectual pursuits. If Sun is Earth and Moon Air: allow your practical, reliable nature to be enlivened by new perspectives, intellectual curiosity, and flexible communication of your needs.`;
        } else if ((sunEl === 'Fire' && moonEl === 'Air') || (sunEl === 'Air' && moonEl === 'Fire')) {
             path += `This is a naturally stimulating combination. Ensure your actions (Fire) are backed by clear thought (Air), and your ideas (Air) are fueled by passion and enthusiasm (Fire). Maintain open communication to keep the synergy flowing.`;
        } else if ((sunEl === 'Earth' && moonEl === 'Water') || (sunEl === 'Water' && moonEl === 'Earth')) {
             path += `This is a naturally supportive blend. Allow your practical efforts (Earth) to be guided by your intuition (Water), and your emotional depth (Water) to find secure expression in tangible ways (Earth). Nurture this powerful connection.`;
        }
        path += ` Find activities and practices that allow both your Sun's outward radiance and your Moon's inner sanctuary to be honored and expressed in a balanced, authentic way.`;
        return path;
    }

    function setupTarotReading() {
        const spreadType = document.getElementById('tarotSpread')?.value || 'single';
        updateTarotSpread(spreadType);
        document.getElementById('tarotInterpretation').innerHTML = '<p>Select a reading type and click on the cards to reveal your divine guidance.</p>'; 
    }

    function updateTarotSpread(spreadType) {
        const container = document.getElementById('tarotCards');
        container.innerHTML = '';
        const spreadConfig = {
            'single': { cards: 1, positions: ['Guidance for the Moment'] },
            'three': { cards: 3, positions: ['Past Influence', 'Present Situation', 'Future Potential'] },
            'celtic': { cards: 10, positions: ['1. You/Situation', '2. Challenge/Crossing', '3. Foundation/Past', '4. Recent Past/Passing', '5. Crown/Potential Outcome', '6. Near Future/Approaching', '7. Your Attitude/Self', '8. External Influences/Environment', '9. Hopes & Fears', '10. Final Outcome'] },
            'love': { cards: 5, positions: ['1. Your Energy in Love', '2. Partner\'s Energy (or Desired)', '3. Dynamics of Connection', '4. Challenge/Growth Area', '5. Potential Outcome'] },
            'career': { cards: 4, positions: ['1. Current Career Situation', '2. Obstacles/Challenges', '3. Action/Guidance', '4. Potential Outcome'] }
        };
        const config = spreadConfig[spreadType];
        for (let i = 0; i < config.cards; i++) {
            const cardWrapper = document.createElement('div');
            cardWrapper.style.textAlign = 'center'; 
            const card = document.createElement('div');
            card.className = 'tarot-card';
            card.innerHTML = tarotDeck.major[0].symbol; 
            card.dataset.revealed = "false";
            card.onclick = () => revealTarotCard(card, i, config.positions[i], config.cards > 1);
            const positionText = document.createElement('p');
            positionText.textContent = config.positions[i];
            positionText.style.fontSize = '0.8rem';
            positionText.style.marginTop = '5px';
            cardWrapper.appendChild(card);
            cardWrapper.appendChild(positionText);
            container.appendChild(cardWrapper);
        }
         document.getElementById('tarotInterpretation').innerHTML = `<p>You've chosen the <strong>${spreadType.replace('-', ' ')}</strong> spread. Click on each card position to reveal its meaning.</p>`;
    }

    function revealTarotCard(cardElement, positionIndex, positionName, isSpread) {
        if (cardElement.dataset.revealed === "true") return; 
        const randomCard = tarotDeck.major[Math.floor(Math.random() * tarotDeck.major.length)];
        const isReversed = Math.random() > 0.3; 
        cardElement.innerHTML = `
            <div style="font-size: 0.9rem; text-align: center; padding: 5px; display: flex; flex-direction: column; justify-content: space-around; height: 100%;">
                <div style="font-weight: bold; margin-bottom: 5px; font-size: 0.8em;">${randomCard.name}</div>
                <div style="font-size: 2.5em; margin: 5px 0;">${randomCard.symbol}</div>
                ${isReversed ? '<div style="font-size: 0.7em; color: #ff6b6b;">(Reversed)</div>' : ''}
            </div>
        `;
        cardElement.style.background = 'linear-gradient(135deg, #fffacd, #ffe4b5)'; 
        cardElement.style.color = '#4a148c'; 
        cardElement.dataset.revealed = "true";
        updateTarotInterpretation(randomCard, positionName, isReversed, isSpread, positionIndex);
    }

    function updateTarotInterpretation(card, position, isReversed, isSpread, positionIndex) {
        const interpretationContainer = document.getElementById('tarotInterpretation');
        if (!isSpread || positionIndex === 0) { 
             const spreadType = document.getElementById('tarotSpread')?.value || 'single';
             const introText = `<p>Interpreting the <strong>${spreadType.replace('-', ' ')}</strong> spread:</p>`;
             interpretationContainer.innerHTML = introText;
        }
        const meaning = isReversed ? card.reversed : card.meaning;
        interpretationContainer.innerHTML += `
            <div class="interpretation" style="margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                <h4>${position}: ${card.name} ${isReversed ? '(Reversed)' : ''} ${card.symbol}</h4>
                <p><strong>Meaning:</strong> ${meaning}</p>
            </div>
        `;
    }

    function generateBirthChart() {
        const birthDate = document.getElementById('birthDateInput')?.value; 
        const birthTime = document.getElementById('birthTimeInput')?.value; 
        const birthLocation = document.getElementById('birthLocationInput')?.value; 
        const analysisContainer = document.getElementById('birthChartAnalysis');
        if (birthDate && birthTime && birthLocation) {
            const analysis = generateBirthChartAnalysisContent(birthDate, birthTime, birthLocation); 
            analysisContainer.innerHTML = analysis;
            drawBirthChartWheel(birthDate, birthTime); 
        } else {
            analysisContainer.innerHTML = '<p>Please enter complete birth details (date, time, location) to generate the (simulated) natal chart.</p>';
            document.getElementById('birthChartWheel').innerHTML = ''; 
        }
    }

    function generateBirthChartAnalysisContent(date, time, location) { 
        const birthDateTime = new Date(`${date}T${time}`);
        const signs = Object.keys(zodiacSigns);
        const hour = birthDateTime.getHours();
        const minutes = birthDateTime.getMinutes();
        const dayOfYear = Math.floor((birthDateTime - new Date(birthDateTime.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
        const planets = {};
        const ascendantSignIndex = Math.floor((hour * 60 + minutes) / (24 * 60 / 12)) % 12;
        planets['rising'] = signs[ascendantSignIndex];
        Object.keys(planetaryData).forEach((planetKey, index) => {
            const signIndex = (dayOfYear + hour + index * (planetaryData[planetKey].name.length % 5 + 2) * 3 + Math.floor(birthDateTime.getMonth()/2) ) % signs.length; 
            planets[planetKey] = signs[signIndex];
        });
        const birthMonth = birthDateTime.getMonth(); 
        const sunSignApproxIndex = Math.floor(birthMonth / (12/signs.length) + (birthDateTime.getDate()/15) ) % signs.length; 
        planets['sun'] = signs[sunSignApproxIndex];
        let analysisHTML = `
            <h3>Simulated Natal Chart for ${location}</h3>
            <p><strong>Birth Details:</strong> ${birthDateTime.toLocaleDateString([], {year: 'numeric', month: 'long', day: 'numeric'})} at ${time} in ${location}</p>
            <p><strong>Rising Sign (Ascendant):</strong> ${zodiacSigns[planets.rising].name} ${zodiacSigns[planets.rising].symbol} - This is your outward personality, the lens through which you view the world, and how others first perceive you.</p>
            <h4>Key Planetary Positions (Simulated):</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 15px 0;">
                ${Object.entries(planets).filter(([p]) => p !== 'rising').map(([planet, sign]) => `
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; border-left: 3px solid ${zodiacSigns[sign].element === 'Fire' ? '#FF4500' : zodiacSigns[sign].element === 'Earth' ? '#228B22' : zodiacSigns[sign].element === 'Air' ? '#FFD700' : '#1E90FF'};">
                        <strong>${planetaryData[planet]?.symbol || ''} ${planetaryData[planet]?.name || planet}</strong><br>
                        in ${zodiacSigns[sign].name} ${zodiacSigns[sign].symbol}
                        <p style="font-size:0.8em; margin-top:5px;"><em>Influences: ${planetaryData[planet]?.influence.split(',').slice(0,2).join(', ')} via ${zodiacSigns[sign].element}/${zodiacSigns[sign].quality} energy.</em></p>
                    </div>
                `).join('')}
            </div>
            <h4>Core Interpretations (Simulated):</h4>
            <p>Your <strong>Sun in ${zodiacSigns[planets.sun].name}</strong> (${zodiacSigns[planets.sun].element}) illuminates your core identity, vitality, life purpose, and conscious ego. It's how you shine and express your fundamental self.</p>
            <p>Your <strong>Moon in ${zodiacSigns[planets.moon].name}</strong> (${zodiacSigns[planets.moon].element}) governs your emotional nature, subconscious patterns, habits, and what makes you feel secure and nurtured. It's your inner world.</p>
            <p><strong>Mercury in ${zodiacSigns[planets.mercury].name}</strong> influences your communication style, thought processes, learning abilities, and how you exchange information.</p>
            <p><strong>Venus in ${zodiacSigns[planets.venus].name}</strong> affects your approach to love, beauty, values, relationships, finances, and what brings you pleasure and harmony.</p>
            <p><strong>Mars in ${zodiacSigns[planets.mars].name}</strong> drives your ambition, energy, passion, desires, and how you assert yourself and pursue your goals.</p>
            <p>The outer planets ‚Äì <strong>Jupiter in ${zodiacSigns[planets.jupiter].name}</strong> (expansion, wisdom, luck), <strong>Saturn in ${zodiacSigns[planets.saturn].name}</strong> (lessons, structure, discipline), <strong>Uranus in ${zodiacSigns[planets.uranus].name}</strong> (innovation, sudden change, rebellion), <strong>Neptune in ${zodiacSigns[planets.neptune].name}</strong> (dreams, spirituality, illusion), and <strong>Pluto in ${zodiacSigns[planets.pluto].name}</strong> (transformation, power, regeneration) ‚Äì shape your generational influences and deeper evolutionary path.</p>
            <p><em>Note: This is a simplified simulation. A professional astrological reading using precise ephemeris data and house system calculations would provide an accurate and in-depth analysis of your unique cosmic blueprint.</em></p>
        `;
        return analysisHTML;
    }

    function drawBirthChartWheel(birthDateStr, birthTimeStr) {
        const wheel = document.getElementById('birthChartWheel');
        wheel.innerHTML = ''; 
        const size = Math.min(wheel.offsetWidth, wheel.offsetHeight, 300); 
        wheel.style.width = `${size}px`;
        wheel.style.height = `${size}px`;
        const radius = size / 2;
        const center = radius;
        const birthDateTime = new Date(`${birthDateStr}T${birthTimeStr}`);
        const hour = birthDateTime.getHours();
        const minutes = birthDateTime.getMinutes();
        const ascendantSignIndex = Math.floor((hour * 60 + minutes) / (24 * 60 / 12)) % 12; 
        const ascendantDegreeOffset = ((hour * 60 + minutes) % (2 * 60)) / (2 * 60) * 30; 
        const houseCuspAngles = [];
        for (let i = 0; i < 12; i++) {
            const baseAngleRad = Math.PI - (ascendantDegreeOffset * Math.PI / 180);
            const houseAngleRad = baseAngleRad - (i * 30 * Math.PI / 180); 
            houseCuspAngles.push(houseAngleRad);
            const houseLine = document.createElement('div');
            houseLine.className = 'chart-house'; 
            houseLine.style.height = `${radius}px`; 
            houseLine.style.left = `${center}px`;
            houseLine.style.top = `${center}px`; 
            houseLine.style.transformOrigin = '0 0'; 
            houseLine.style.transform = `rotate(${houseAngleRad * 180 / Math.PI - 90}deg)`; 
            wheel.appendChild(houseLine);
            const numberAngleRad = houseAngleRad - (15 * Math.PI / 180); 
            const numX = center + (radius * 0.8) * Math.cos(numberAngleRad); 
            const numY = center + (radius * 0.8) * Math.sin(numberAngleRad);
            const houseNumDiv = document.createElement('div');
            houseNumDiv.textContent = ((i + 1 - ascendantSignIndex + 12)%12) +1; // This logic needs review for accuracy with ASC as House 1
            // Corrected House Numbering (Ascendant starts House 1)
            houseNumDiv.textContent = i + 1; 
            houseNumDiv.style.position = 'absolute';
            houseNumDiv.style.left = `${numX - (houseNumDiv.textContent.length > 1 ? 6:3)}px`; 
            houseNumDiv.style.top = `${numY - 7}px`;
            houseNumDiv.style.fontSize = '0.6rem';
            houseNumDiv.style.color = 'rgba(255,255,255,0.5)';
            wheel.appendChild(houseNumDiv);
        }
        const signs = Object.values(zodiacSigns);
        for (let i = 0; i < 12; i++) {
            const signDisplayAngleRad = Math.PI - (ascendantDegreeOffset * Math.PI / 180) - (i * 30 * Math.PI/180) - (15 * Math.PI/180); 
            const signX = center + (radius * 0.92) * Math.cos(signDisplayAngleRad); 
            const signY = center + (radius * 0.92) * Math.sin(signDisplayAngleRad);
            const signElement = document.createElement('div');
            signElement.className = 'chart-planet'; 
            signElement.style.position = 'absolute';
            signElement.style.left = `${signX - 10}px`; 
            signElement.style.top = `${signY - 10}px`;
            const currentSign = signs[(ascendantSignIndex + i) % 12];
            signElement.innerHTML = currentSign.symbol;
            signElement.title = currentSign.name;
            signElement.style.color = currentSign.element === 'Fire' ? '#FF4500' : currentSign.element === 'Earth' ? '#228B22' : currentSign.element === 'Air' ? '#FFD700' : '#1E90FF';
            wheel.appendChild(signElement);
        }
        const ascLine = document.createElement('div');
        ascLine.style.position = 'absolute';
        ascLine.style.height = `${radius*1.1}px`;
        ascLine.style.borderLeft = '2px solid #ffd700';
        ascLine.style.left = `${center}px`;
        ascLine.style.top = `${center}px`; 
        ascLine.style.transformOrigin = '0 0'; 
        ascLine.style.transform = `rotate(${houseCuspAngles[0] * 180 / Math.PI - 90}deg)`; 
        ascLine.innerHTML = '<span style="position:absolute; top:-15px; left:3px; font-size:0.7em; color:#ffd700;">AS</span>'; // Adjusted AS label
        wheel.appendChild(ascLine);
        const dayOfYear = Math.floor((birthDateTime - new Date(birthDateTime.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
        const planetKeys = Object.keys(planetaryData);
        planetKeys.forEach((pKey, index) => {
            const basePlanetAngleDeg = (dayOfYear * (index + 1.5) + minutes * (index * 0.1) + hour * (planetaryData[pKey].name.length)) % 360;
            const planetChartAngleRad = houseCuspAngles[0] - (basePlanetAngleDeg * Math.PI / 180);
            const planetOrbitRadius = radius * (0.35 + (index * 0.05)); 
            const planetX = center + planetOrbitRadius * Math.cos(planetChartAngleRad);
            const planetY = center + planetOrbitRadius * Math.sin(planetChartAngleRad);
            const planetDiv = document.createElement('div');
            planetDiv.className = 'chart-planet';
            planetDiv.textContent = planetaryData[pKey].symbol;
            planetDiv.title = planetaryData[pKey].name;
            planetDiv.style.position = 'absolute';
            planetDiv.style.left = `${planetX - 8}px`;
            planetDiv.style.top = `${planetY - 8}px`;
            planetDiv.style.fontSize = '0.9rem';
            planetDiv.style.color = '#FFF'; 
            planetDiv.style.background = 'rgba(0,0,0,0.5)';
            wheel.appendChild(planetDiv);
        });
    }

    function calculateNumerology() {
        const fullName = document.getElementById('fullName')?.value;
        const birthDateStr = document.getElementById('numerologyBirthDate')?.value; 
        const resultsContainer = document.getElementById('numerologyResults');
        const interpretationContainer = document.getElementById('numerologyInterpretation');
        if (fullName && birthDateStr) {
            const numbers = calculateNumerologyNumbers(fullName, birthDateStr);
            displayNumerologyResults(numbers);
        } else {
            resultsContainer.innerHTML = '';
            interpretationContainer.innerHTML = '<p>Enter your full name and birth date to discover your sacred numbers.</p>';
        }
    }

    function reduceNumber(num) {
        while (num > 9 && num !== 11 && num !== 22 && num !== 33) {
            num = num.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
        }
        return num;
    }

    function calculateNumerologyNumbers(name, dateStr) {
        const letterValues = {
            A:1,J:1,S:1, B:2,K:2,T:2, C:3,L:3,U:3, D:4,M:4,V:4, E:5,N:5,W:5, F:6,O:6,X:6, G:7,P:7,Y:7, H:8,Q:8,Z:8, I:9,R:9
        }; 
        const birthNumbers = dateStr.replace(/-/g, '').split('').map(n => parseInt(n));
        let lifePathSum = birthNumbers.reduce((sum, num) => sum + num, 0);
        const lifePath = reduceNumber(lifePathSum);
        const nameNormalized = name.toUpperCase().replace(/[^A-Z]/g, '');
        let expressionSum = 0;
        for (let char of nameNormalized) { expressionSum += letterValues[char] || 0; }
        const expression = reduceNumber(expressionSum);
        const vowels = "AEIOU";
        let soulUrgeSum = 0;
        for (let char of nameNormalized) { if (vowels.includes(char)) { soulUrgeSum += letterValues[char] || 0; } }
        const soulUrge = reduceNumber(soulUrgeSum);
        let personalitySum = 0;
        for (let char of nameNormalized) { if (!vowels.includes(char) && letterValues[char]) { personalitySum += letterValues[char]; } }
        const personality = reduceNumber(personalitySum);
        const birthdayNumber = reduceNumber(parseInt(dateStr.split('-')[2]));
        return { lifePath, expression, soulUrge, personality, birthdayNumber };
    }
    
    const numerologyMeanings = {
        1: { keyword: "Leader", summary: "Independence, innovation, leadership, pioneering spirit, ambition, individuality." },
        2: { keyword: "Diplomat", summary: "Cooperation, diplomacy, sensitivity, partnership, harmony, intuition, peacemaking." },
        3: { keyword: "Communicator", summary: "Creativity, communication, optimism, self-expression, joy, inspiration, artistic talent." },
        4: { keyword: "Builder", summary: "Stability, practicality, hard work, organization, discipline, foundation, reliability." },
        5: { keyword: "Adventurer", summary: "Freedom, adventure, versatility, change, curiosity, resourcefulness, adaptability." },
        6: { keyword: "Nurturer", summary: "Nurturing, responsibility, healing, compassion, family, service, harmony, domesticity." },
        7: { keyword: "Seeker", summary: "Spirituality, analysis, introspection, wisdom, truth-seeking, research, solitude, intuition." },
        8: { keyword: "Powerhouse", summary: "Material success, authority, achievement, ambition, abundance, efficiency, business acumen." },
        9: { keyword: "Humanitarian", summary: "Humanitarianism, completion, wisdom, compassion, idealism, universal love, selflessness." },
        11: { keyword: "Visionary (Master)", summary: "Intuition, inspiration, enlightenment, idealism, spiritual insight, psychic abilities, charisma. (Often experienced as 2's sensitivity and cooperation but with a higher spiritual purpose)." },
        22: { keyword: "Master Builder (Master)", summary: "Practical idealist, large-scale achievement, spiritual manifestation, leadership, transforming dreams into reality. (Often experienced as 4's discipline and practicality but on a grander scale)." },
        33: { keyword: "Master Teacher (Master)", summary: "Universal love, compassionate healing, spiritual service, profound inspiration, uplifting humanity. (Often experienced as 6's nurturing and responsibility but with a global reach)." }
    };

    function displayNumerologyResults(numbers) {
        const container = document.getElementById('numerologyResults');
        const interpretationContainer = document.getElementById('numerologyInterpretation');
        container.innerHTML = `
            <div class="numerology-item"><h4>Life Path Number</h4><div style="font-size: 2rem; color: #ffd700;">${numbers.lifePath}</div><p><strong>${numerologyMeanings[numbers.lifePath].keyword}:</strong> ${numerologyMeanings[numbers.lifePath].summary}</p></div>
            <div class="numerology-item"><h4>Expression (Destiny) Number</h4><div style="font-size: 2rem; color: #ffd700;">${numbers.expression}</div><p><strong>${numerologyMeanings[numbers.expression].keyword}:</strong> ${numerologyMeanings[numbers.expression].summary}</p></div>
            <div class="numerology-item"><h4>Soul Urge (Heart's Desire) Number</h4><div style="font-size: 2rem; color: #ffd700;">${numbers.soulUrge}</div><p><strong>${numerologyMeanings[numbers.soulUrge].keyword}:</strong> ${numerologyMeanings[numbers.soulUrge].summary}</p></div>
            <div class="numerology-item"><h4>Personality Number</h4><div style="font-size: 2rem; color: #ffd700;">${numbers.personality}</div><p><strong>${numerologyMeanings[numbers.personality].keyword}:</strong> ${numerologyMeanings[numbers.personality].summary}</p></div>
            <div class="numerology-item"><h4>Birthday Number</h4><div style="font-size: 2rem; color: #ffd700;">${numbers.birthdayNumber}</div><p><strong>${numerologyMeanings[numbers.birthdayNumber].keyword}:</strong> ${numerologyMeanings[numbers.birthdayNumber].summary}</p></div>
        `;
        interpretationContainer.innerHTML = `
            <h3>Complete Numerological Profile Interpretation</h3>
            <p><strong>Life Path ${numbers.lifePath} (${numerologyMeanings[numbers.lifePath].keyword}):</strong> This is your most significant number, outlining your soul's journey, inherent talents, and the primary lessons you are here to learn and master in this lifetime. Your path is fundamentally about embodying and expressing the qualities of ${numerologyMeanings[numbers.lifePath].summary.toLowerCase()}</p>
            <p><strong>Expression (Destiny) ${numbers.expression} (${numerologyMeanings[numbers.expression].keyword}):</strong> This number describes your natural talents, inherent abilities, and the potential you are meant to develop and express to the world. It's how you are designed to achieve your destiny and make your mark. You are here to express and utilize the energies of ${numerologyMeanings[numbers.expression].summary.toLowerCase()}</p>
            <p><strong>Soul Urge (Heart's Desire) ${numbers.soulUrge} (${numerologyMeanings[numbers.soulUrge].keyword}):</strong> This reveals your inner motivations, your deepest desires, and what truly fulfills your soul and brings you profound happiness. It's the "why" behind your actions and aspirations. Your soul yearns for experiences aligned with ${numerologyMeanings[numbers.soulUrge].summary.toLowerCase()}</p>
            <p><strong>Personality ${numbers.personality} (${numerologyMeanings[numbers.personality].keyword}):</strong> This is the outer you, the facade you present to the world, and how others tend to perceive you upon first impression. It also indicates aspects of yourself you comfortably show to others. People likely see you as someone embodying the traits of ${numerologyMeanings[numbers.personality].summary.toLowerCase()}</p>
            <p><strong>Birthday ${numbers.birthdayNumber} (${numerologyMeanings[numbers.birthdayNumber].keyword}):</strong> This number adds specific talents, characteristics, and inclinations that influence your journey and how you approach your Life Path. It's a special gift that particularly informs your approach to daily life and challenges, often related to ${numerologyMeanings[numbers.birthdayNumber].summary.toLowerCase()}</p>
            <p><strong>Sacred Integration & Guidance:</strong> Your unique numerical signature creates a powerful, interconnected combination that guides your spiritual evolution and life experiences. Meditate on these numbers and observe how their energies manifest in your daily life, relationships, and choices. Understanding how these core numbers interact provides deeper insight into your soul's blueprint and how to live in greater alignment with your true self. For Master Numbers (11, 22, 33), there's often a dual experience of the base number (2, 4, or 6) along with the higher potential of the Master Number, which requires conscious effort and maturity to fully embody.</p>
        `;
    }

    function updateCrystalGuidance() {
        const sign = document.getElementById('crystalSign')?.value;
        const need = document.getElementById('crystalNeed')?.value;
        const container = document.getElementById('crystalRecommendations');
        if (sign && need) {
            const signCrystalsData = (zodiacSigns[sign]?.crystals || []).map(name => {
                for (const category in crystalDatabase) {
                    const found = crystalDatabase[category].find(c => c.name === name);
                    if (found) return found;
                }
                return { name, properties: `Enhances ${zodiacSigns[sign].name} energy and general well-being.`, chakra: 'Varies/All' };
            });
            const needCrystalsData = crystalDatabase[need] || [];
            const combinedCrystals = [...signCrystalsData, ...needCrystalsData];
            const uniqueCrystalMap = new Map();
            combinedCrystals.forEach(crystal => {
                if (!uniqueCrystalMap.has(crystal.name) || crystalDatabase[need].some(nc => nc.name === crystal.name)) {
                     uniqueCrystalMap.set(crystal.name, crystal);
                }
            });
            const recommendations = Array.from(uniqueCrystalMap.values());
            container.innerHTML = recommendations.map(crystal => `
                <div class="crystal-card">
                    <h4>${crystal.name}</h4>
                    <p style="font-size:0.9em;"><strong>Properties:</strong> ${crystal.properties}</p>
                    <p style="font-size:0.9em;"><strong>Associated Chakra(s):</strong> ${crystal.chakra}</p>
                    <p style="font-size:0.9em;"><strong>How to Use for ${need.replace('-', ' ')}:</strong> ${getCrystalUsage(crystal.name, need)}</p>
                </div>
            `).join('');
        } else {
            container.innerHTML = '<p>Select your sign and current need for crystal recommendations.</p>';
        }
    }

    function getCrystalUsage(crystalName, need) {
        const usages = {
            'protection': `Carry ${crystalName} with you, place it at your home entrance or on your desk, or grid your space for energetic protection. Meditate with it to reinforce your auric shield and transmute negativity.`,
            'love': `Place ${crystalName} over your heart chakra during meditation, wear it as jewelry near your heart, keep it in your bedroom to enhance love, self-love, and harmonious relationships, or use in a love-attracting grid.`,
            'abundance': `Keep ${crystalName} in your wallet, cash box, or on your desk in your workspace to attract prosperity, opportunities, and success. Visualize your financial goals while holding it, affirming your worthiness.`,
            'healing': `Hold ${crystalName} during meditation focusing on healing (physical, emotional, spiritual), place it on affected body areas (if appropriate and cleansed), or create a healing grid around you or your photo. Some crystals can be used for (indirect method) gem elixirs.`,
            'intuition': `Place ${crystalName} on your third eye during meditation, keep it by your bedside for insightful dreams and enhanced psychic awareness, or use it during divination practices (tarot, scrying) to strengthen your connection to inner wisdom.`,
            'clarity': `Keep ${crystalName} on your desk while working or studying to promote focus, hold it during important decision-making processes to clear mental fog, or meditate with it to gain mental sharpness and enhanced concentration.`,
            'grounding': `Hold ${crystalName} while standing barefoot on the earth (earthing), carry it in your pocket for stability and presence throughout the day, or meditate with it at your root chakra to connect with Earth's energy.`,
            'confidence': `Wear ${crystalName} as jewelry, hold it before important events, presentations, or challenging situations, or meditate with it at your solar plexus or sacral chakra to boost self-esteem, courage, and personal power.`
        };
        return usages[need] || `Meditate with ${crystalName} focusing on your specific intention. Cleanse it regularly under moonlight, with sage smoke, or by placing it on Selenite to maintain its vibrant energy.`;
    }

    function updatePlanetTracker() {
        const container = document.getElementById('planetPositions');
        const influencesContainerParent = document.getElementById('planetaryInfluences');
        let influencesList = influencesContainerParent.querySelector('ul');
        if (!influencesList) {
            influencesContainerParent.innerHTML = '<h3>Current Planetary Influences</h3>'; 
            influencesList = document.createElement('ul');
            influencesContainerParent.appendChild(influencesList);
        }
        influencesList.innerHTML = ''; 
        const retrogradeAlertContainer = document.getElementById('retrogradeAlert');
        const today = new Date();
        const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
        const signs = Object.keys(zodiacSigns);
        const currentPositions = {};
        Object.keys(planetaryData).forEach((planet, index) => {
            let speedFactor = 1;
            if (['jupiter', 'saturn'].includes(planet)) speedFactor = 0.2;
            if (['uranus', 'neptune', 'pluto'].includes(planet)) speedFactor = 0.05;
            const signIndex = Math.floor((dayOfYear * speedFactor + index * (planetaryData[planet].name.length % 5 + 1) * 3 + Math.floor(today.getMonth()/ (index % 3 + 1)) ) % signs.length);
            currentPositions[planet] = signs[signIndex];
            const planetInfo = planetaryData[planet];
            const signInfo = zodiacSigns[signs[signIndex]];
            const li = document.createElement('li');
            li.innerHTML = `<strong>${planetInfo.name} (${planetInfo.symbol}) in ${signInfo.name} (${signInfo.symbol}):</strong> ${planetInfo.influence}. This transit emphasizes themes of ${signInfo.keywords.slice(0,2).join(' and ').toLowerCase()} for aspects related to ${planetInfo.name}. Consider how this ${signInfo.element} energy impacts your ${planetInfo.name.toLowerCase()}-related activities today.`;
            influencesList.appendChild(li);
        });
        container.innerHTML = Object.entries(currentPositions).map(([planet, sign]) => {
            const planetInfo = planetaryData[planet];
            const signInfo = zodiacSigns[sign];
            return `
                <div class="planet-item">
                    <div style="font-size: 1.5rem;">${planetInfo.symbol}</div>
                    <strong>${planetInfo.name}</strong>
                    <div>in ${signInfo.symbol} ${signInfo.name}</div>
                    <p style="font-size: 0.8rem; margin-top: 5px;">Influence: ${planetInfo.influence.split(',')[0]}</p>
                </div>
            `;
        }).join('');
        let retroPlanetName = null;
        let retroSignKey = null;
        let retroStart = null;
        let retroEnd = null;
        const yearOffset = today.getFullYear() % 10; 
        const rxPeriods = [
            { startDayOfYear: 40 - yearOffset, planet: 'mercury', duration: 22 },   
            { startDayOfYear: 150 - yearOffset, planet: 'mercury', duration: 23 }, 
            { startDayOfYear: 260 - yearOffset, planet: 'mercury', duration: 21 }  
        ];
        if (today.getFullYear() % 2 === 0 && dayOfYear > 180 && dayOfYear < (180 + 42)) { 
             rxPeriods.push({ startDayOfYear: 180, planet: 'venus', duration: 42});
        }
        if (today.getFullYear() % 2 !== 0 && dayOfYear > 240 && dayOfYear < (240+70)) { 
             rxPeriods.push({ startDayOfYear: 240, planet: 'mars', duration: 70});
        }
        for (const period of rxPeriods) {
            const actualStartDay = (period.startDayOfYear % 365 + 365) % 365; 
            if (dayOfYear >= actualStartDay && dayOfYear < actualStartDay + period.duration) {
                retroPlanetName = planetaryData[period.planet].name;
                retroSignKey = currentPositions[period.planet]; 
                retroStart = new Date(today.getFullYear(), 0, actualStartDay + 1);
                retroEnd = new Date(today.getFullYear(), 0, actualStartDay + period.duration + 1);
                break; 
            }
        }
        if (retroPlanetName && retroSignKey) {
            retrogradeAlertContainer.innerHTML = `
                <div style="background: rgba(255, 107, 107, 0.2); padding: 15px; border-radius: 10px; border: 1px solid #ff6b6b;">
                    <h4>‚ö†Ô∏è ${retroPlanetName} Retrograde Alert in ${zodiacSigns[retroSignKey].name} ${zodiacSigns[retroSignKey].symbol}</h4>
                    <p>Currently, ${retroPlanetName} appears to be moving retrograde (backwards) in the sign of ${zodiacSigns[retroSignKey].name}. 
                       This period (approximately from ${retroStart.toLocaleDateString()} to ${retroEnd.toLocaleDateString()}) typically calls for <strong>REview, REflection, and RE-evaluation</strong>, especially in areas ruled by ${retroPlanetName} (${planetaryData[retroPlanetName.toLowerCase()].influence.split(',').slice(0,2).join(', ')}) and influences related to ${zodiacSigns[retroSignKey].name} (${zodiacSigns[retroSignKey].keywords.join(', ').toLowerCase()}).
                    </p>
                    <p><strong>Guidance for ${retroPlanetName} Retrograde:</strong> 
                       ${ retroPlanetName === 'Mercury' ? 'Double-check travel plans, contracts, and important communications. Be patient with delays, tech glitches, and misunderstandings. Avoid signing major new contracts if possible or review them meticulously. Use this time for inner work, research, reorganizing, revisiting past projects, and reconnecting with old friends. Backup your data!' : ''}
                       ${ retroPlanetName === 'Venus' ? 'Re-evaluate relationships, values, and financial matters. Old flames or financial issues may resurface. Avoid major aesthetic changes or large luxury purchases. Focus on self-love, artistic refinement, and clarifying what you truly value in partnerships and possessions.' : ''}
                       ${ retroPlanetName === 'Mars' ? 'Review your energy levels, motivations, and how you assert yourself. Frustration or delays in projects may occur. Avoid initiating new conflicts. Re-strategize your approach to goals. This is a time for inner work on anger, drive, and passions, rather than forceful external action.' : ''}
                    </p>
                </div>
            `;
        } else {
            retrogradeAlertContainer.innerHTML = `
                <div style="background: rgba(107, 255, 107, 0.2); padding: 15px; border-radius: 10px; border: 1px solid #6bff6b;">
                    <h4>üåü All Clear: Major Personal Planets Currently Direct (Simulated)</h4>
                    <p>At present, the personal planets (Mercury, Venus, Mars) appear to be moving direct in our simulation. This generally supports forward momentum in plans, new initiatives, and clear expression in their respective domains. (Outer planets like Saturn, Jupiter, Uranus, Neptune, Pluto are often retrograde for longer periods, representing deeper, more collective re-evaluations not highlighted here.)
                    </p>
                    <p><em>Note: This is a simulation for illustrative purposes. Always consult a professional astrologer for precise, real-time transit details.</em></p>
                </div>
            `;
        }
    }

    function updateChakraInfo() {
        const selectedChakraKey = document.getElementById('chakraSelect').value;
        const info = chakraInfo[selectedChakraKey];
        const container = document.getElementById('chakraInfo');
        if (info) {
            container.innerHTML = `
                <h3>${info.name}</h3>
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <div style="width: 50px; height: 50px; background-color: ${info.color}; border-radius: 50%; margin-right: 15px; border: 2px solid white; box-shadow: 0 0 10px ${info.color};"></div>
                    <div><p><strong>Location:</strong> ${info.location}</p><p><strong>Element:</strong> ${info.element}</p><p><strong>Bija Mantra (Seed Sound):</strong> ${info.mantra}</p></div>
                </div>
                <h4>Core Properties & Purpose:</h4><p>${info.properties}. This chakra governs our fundamental connection to these aspects of life.</p>
                <h4>Signs of Imbalance or Blockage:</h4><p>${info.imbalanced}. Recognizing these signs can help you address the chakra's needs.</p>
                <h4>Signs of Balance and Health:</h4><p>${info.balanced}. When this chakra is open and flowing, these qualities are prominent.</p>
                <h4>Healing Crystals & Gemstones:</h4><p>${info.crystals.join(', ')}. These can be used in meditation, worn as jewelry, or placed on the chakra point.</p>
                <h4>Healing Affirmation for Empowerment:</h4><p><em>"${info.affirmation}"</em> (Repeat this affirmation daily, especially during meditation or quiet reflection).</p>
                <h4>Healing Practices & Activities:</h4>
                <ul>
                    <li><strong>Meditation:</strong> Focus on the ${info.location.toLowerCase()}. Visualize a radiant, spinning sphere of ${info.color.toLowerCase()} light at this point. As you inhale, imagine this light growing brighter, more vibrant, and expanding, purifying and energizing the chakra. As you exhale, release any blockages, tension, or stagnant energy.</li>
                    <li><strong>Mantra Chanting:</strong> Chant the bija mantra "<strong>${info.mantra}</strong>" repeatedly (e.g., 108 times, or for several minutes). Feel the vibration resonating in the chakra area.</li>
                    <li><strong>Crystal Healing:</strong> Work with recommended crystals: ${info.crystals.join(', ')}. Hold them during meditation, place them on the chakra point while lying down, or create a crystal grid.</li>
                    <li><strong>Elemental Connection:</strong> Engage in activities related to its element: ${getChakraElementActivity(info.element)}.</li>
                    <li><strong>Yoga & Movement:</strong> Practice yoga poses (asanas) that stimulate this chakra. (e.g., Root: Mountain Pose, Warrior Poses; Sacral: Cobra Pose, Hip Openers; Solar Plexus: Boat Pose, Sun Salutations; Heart: Camel Pose, Fish Pose; Throat: Shoulder Stand, Plough Pose; Third Eye: Child's Pose, Forward Folds; Crown: Headstand (advanced), Savasana, Lotus Pose).</li>
                    <li><strong>Sound Healing:</strong> Listen to music tuned to frequencies associated with this chakra (e.g., specific Solfeggio frequencies or classical music in certain keys).</li>
                    <li><strong>Aromatherapy:</strong> Use essential oils associated with this chakra (e.g., Root: Patchouli, Vetiver; Sacral: Ylang Ylang, Sandalwood; Solar Plexus: Lemon, Ginger; Heart: Rose, Bergamot; Throat: Peppermint, Eucalyptus; Third Eye: Lavender, Frankincense; Crown: Frankincense, Lotus). Use in a diffuser or diluted topically.</li>
                    <li><strong>Color Therapy:</strong> Surround yourself with the chakra's color ${info.color.toLowerCase()} ‚Äì wear clothes of this color, visualize it, eat foods of this color (if applicable).</li>
                    <li><strong>Affirmations:</strong> Regularly repeat the affirmation: "<em>${info.affirmation}</em>", feeling its truth deeply.</li>
                </ul>
            `;
        }
    }

    function getChakraElementActivity(element) {
        switch(element.toLowerCase()) {
            case 'earth': return 'Connect with nature: walk barefoot (earthing), gardening, hiking. Eat grounding root vegetables. Practice stability and routine.';
            case 'water': return 'Engage with water: swim, take ritual baths with Epsom salts, be near oceans, lakes, or rivers. Creative dance or fluid movements. Honor and express your emotions healthily.';
            case 'fire': return 'Sunbathe (safely for short periods). Engage in dynamic exercises (cardio, martial arts). Eat warming, spicy foods. Pursue passions with vigor and courage. Sit by a campfire.';
            case 'air': return 'Practice deep conscious breathwork (pranayama). Spend time in fresh, open air. Engage in intellectual pursuits, stimulating conversations. Sing, play wind instruments, or listen to wind chimes.';
            case 'ether/sound': return 'Sing, chant mantras, listen to healing music (especially singing bowls, tuning forks, or Solfeggio frequencies). Express your authentic truth. Practice active, mindful listening.';
            case 'light/intuition': return 'Meditate in soft natural light or candlelight. Gentle sun/moon gazing (at appropriate, safe times). Visualize pure, healing light. Trust your intuitive hits and insights. Keep a dream journal. Practice scrying or other forms of divination.';
            case 'thought/cosmic energy': return 'Practice mindfulness and presence. Engage in spiritual study and contemplation. Connect with higher consciousness through prayer, deep meditation, or periods of silence. Practice being open-minded and receptive to universal wisdom.';
            default: return 'Engage in practices that resonate deeply with this chakra\'s essence for you, focusing on its core qualities.';
        }
    }

    function populateMantraList() {
        const container = document.getElementById('mantraList');
        const mantrasData = [ 
            { name: "Om (AUM)", description: "The primordial sound of the universe, representing creation, preservation, and dissolution. Calming, centering, and connects to universal consciousness." },
            { name: "Om Mani Padme Hum", description: "Tibetan Buddhist mantra invoking Avalokiteshvara, the Bodhisattva of Compassion. Cultivates compassion, wisdom, and purification of negative karma." },
            { name: "Gayatri Mantra", description: "A highly revered Vedic mantra for illumination of intellect, spiritual wisdom, and awakening. Invokes Savitr (the divine solar energy)." },
            { name: "So Hum / Ham Sa", description: "A natural breath mantra: \"I am That\" (So Hum on inhale, Ham Sa on exhale). Connects individual consciousness with universal consciousness, affirming divine identity." },
            { name: "Aham Prema", description: "Sanskrit for \"I am Divine Love.\" Powerfully cultivates self-love, loving-kindness towards others, and recognition of the love inherent in all creation." },
            { name: "Lokah Samastah Sukhino Bhavantu", description: "Sanskrit prayer: \"May all beings everywhere be happy and free, and may the thoughts, words, and actions of my own life contribute in some way to that happiness and to that freedom for all.\" Promotes universal compassion." },
            { name: "Ra Ma Da Sa Sa Say So Hung", description: "Siri Gaitri Mantra from Kundalini Yoga, a powerful mantra for healing energy. Balances the elements and connects to the infinite source of healing." },
            { name: "Om Namah Shivaya", description: "Hindu mantra dedicated to Lord Shiva, representing transformation, destruction of ego, and auspiciousness. Clears negativity and invokes inner strength." },
            { name: "Om Shanti Shanti Shanti", description: "Invocation for peace (Shanti). Chanted to bring peace to oneself, to others, and to the world. Calms the mind and environment."}
        ]; 
        container.innerHTML = mantrasData.map(mantra => `
            <div class="ritual-card">
                <h4>${mantra.name}</h4>
                <p>${mantra.description}</p>
                <button onclick="playMantra('${mantra.name}')" style="background: #ffd700; color: #1e3c72; border: none; padding: 8px 15px; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 10px;">Chant (Conceptual)</button>
            </div>
        `).join('');
    }
    
    function playMantra(mantraName) {
        alert(`Begin chanting: ${mantraName}.\n\nFind a quiet, comfortable space. Sit with an upright spine. Close your eyes gently. Repeat the mantra with focused intention and devotion, either aloud, as a whisper, or silently in your mind. Allow the vibrations of the sound to resonate within you, calming your mind and uplifting your spirit. You may use mala beads to count repetitions (traditionally 108) if you wish.`);
    }

    function startMeditation() {
        clearInterval(meditationInterval);
        const durationMinutes = parseInt(document.getElementById('meditationDuration').value);
        meditationRemainingTime = durationMinutes * 60;
        const timerDisplay = document.getElementById('timerDisplay');
        updateTimerDisplay(meditationRemainingTime, timerDisplay);
        updateMeditation(); 
        meditationInterval = setInterval(() => {
            meditationRemainingTime--;
            updateTimerDisplay(meditationRemainingTime, timerDisplay);
            if (meditationRemainingTime < 0) { 
                clearInterval(meditationInterval);
                timerDisplay.textContent = "Namaste";
                alert("Meditation complete. Carry this peace, clarity, and insight with you throughout your day. Om Shanti.");
            }
        }, 1000);
    }

    function updateTimerDisplay(seconds, displayElement) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        displayElement.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    function updateMeditation() {
        const type = document.getElementById('meditationType').value;
        const meditationGuidanceContainer = document.getElementById('meditationGuidance'); 
        let guidanceText = "";
        switch(type) {
            case 'mindfulness':
                guidanceText = `<h4>Mindfulness Meditation Guidance</h4><p>Find a comfortable, stable position, either seated or lying down. Gently close your eyes or maintain a soft, unfocused gaze. Bring your awareness to your breath, noticing the natural rhythm of your inhales and exhales without trying to change it. Feel the sensation of air entering your nostrils or mouth, filling your lungs, and the gentle release as you exhale. When thoughts, emotions, or sensations arise (and they will), acknowledge them without judgment, like observing clouds passing in the sky, and then gently guide your attention back to your breath as an anchor to the present moment. Be present with whatever is, with kindness, curiosity, and acceptance.</p><p><strong>Focus points:</strong> Breath awareness (rise and fall of chest/abdomen, sensation of air), observing thoughts non-judgmentally, body sensations (contact points, temperature, tingling), sounds in your environment. Allow everything to be as it is, without resistance or attachment.</p>`;
                break;
            case 'chakra':
                const chakraKeys = Object.keys(chakraInfo);
                const randomChakraForMeditation = chakraInfo[chakraKeys[Math.floor(Math.random() * chakraKeys.length)]]; 
                guidanceText = `<h4>Chakra Balancing Meditation (Focus: ${randomChakraForMeditation.name})</h4><p>Settle into a comfortable posture. Bring your awareness to the location of the ${randomChakraForMeditation.name.toLowerCase()} (${randomChakraForMeditation.location}). Visualize a radiant, spinning sphere or lotus of vibrant ${randomChakraForMeditation.color.toLowerCase()} light at this point. As you inhale, imagine this light growing brighter, more vibrant, and expanding, purifying and energizing the chakra. As you exhale, release any blockages, tension, or stagnant energy from this chakra, seeing it dissolve into the earth or transform into light. You may silently or softly chant its bija mantra: "<strong>${randomChakraForMeditation.mantra}</strong>" with each exhale. Feel the qualities of this chakra awakening within you (${randomChakraForMeditation.properties.split(',').slice(0,2).join(', ')}).</p><p><strong>Affirm:</strong> "<em>${randomChakraForMeditation.affirmation}</em>" Feel the truth of this statement resonating within the chakra and throughout your being.</p>`;
                break;
            case 'manifestation':
                guidanceText = `<h4>Manifestation Meditation Guidance</h4><p>Begin by calming your mind and body through deep, relaxed breathing. Clearly define what you wish to manifest ‚Äì be specific. Create a vivid mental image of your desire already fulfilled. Engage all your senses in this visualization: what do you see, hear, smell, taste, touch in this manifested reality? Most importantly, cultivate and deeply feel the emotions of having already achieved it ‚Äì profound joy, immense gratitude, unshakeable excitement, deep peace. Hold this vision and feeling with unwavering belief and positive expectation. Release any doubts, fears, or attachment to *how* it will manifest. Trust that the universe is co-creating with you and aligning circumstances for its arrival. End your meditation by expressing deep, heartfelt gratitude as if it has already happened and is a present reality.</p><p><strong>Key elements:</strong> Clear visualization, potent positive emotions (especially gratitude and joy), unwavering belief, releasing attachment to the outcome, trusting the process.</p>`;
                break;
            case 'healing':
                guidanceText = `<h4>Energy Healing Meditation Guidance</h4><p>Find a peaceful, receptive space. Visualize a brilliant, pure, golden-white (or any color that feels intensely healing to you, like emerald green or sapphire blue) light descending from the cosmos or a divine source, entering through the crown of your head. Imagine this healing light permeating every cell, tissue, and organ of your body, from head to toe. See it dissolving any pain, tension, negativity, illness, or energetic blockages. With focused intention, direct this light to any specific areas needing attention or healing. Breathe deeply and rhythmically, inhaling pure healing energy and vitality, exhaling all that no longer serves your highest well-being (toxins, stress, old patterns). Feel yourself being renewed, revitalized, and restored to perfect health, harmony, and wholeness on all levels ‚Äì physical, emotional, mental, and spiritual.</p><p><strong>Focus on:</strong> Vivid light visualization, intentional release of negativity, conscious invitation of healing energy, cellular regeneration, deep relaxation, and affirming your innate capacity for health and wholeness.</p>`;
                break;
            case 'zodiac':
                const randomZodiacKey = Object.keys(zodiacSigns)[Math.floor(Math.random() * 12)];
                const randomZodiac = zodiacSigns[randomZodiacKey];
                guidanceText = `<h4>Zodiac Meditation (Connecting with ${randomZodiac.name} ${randomZodiac.symbol})</h4><p>Connect with the archetypal energy and essence of ${randomZodiac.name}. Reflect on its core qualities: ${randomZodiac.keywords.join(', ')}. Feel its ruling element (${randomZodiac.element}) within you or around you ‚Äì is it the passionate spark of Fire, the stable ground of Earth, the communicative breeze of Air, or the flowing depths of Water? Contemplate its modality (${randomZodiac.quality}) ‚Äì Cardinal initiative, Fixed sustainment, or Mutable adaptability. If you are a ${randomZodiac.name}, embrace and amplify your innate strengths and virtues. If not, consider how inviting the positive attributes of ${randomZodiac.name} into your life (e.g., ${randomZodiac.strengths[0].toLowerCase()}, ${randomZodiac.strengths[1].toLowerCase()}) could bring balance, growth, or needed perspective. What wisdom, gifts, or lessons does the spirit of ${randomZodiac.name} offer you today?</p><p><strong>Mantra/Affirmation:</strong> "<em>${randomZodiac.mantra}</em>" Feel these words resonate with the energy of this sign.</p>`;
                break;
            default:
                guidanceText = "<p>Select a meditation type for detailed guidance. Find a comfortable position and prepare to journey inward.</p>";
        }
        meditationGuidanceContainer.innerHTML = guidanceText;
    }

    function updateJournalPrompts() {
            const type = document.getElementById('journalType').value;
            const promptsContainer = document.getElementById('journalPrompts');
            let promptsHTML = `<h4>Prompts for your ${type.replace('-', ' ')} Journal:</h4><ul>`;
            
            const commonPrompts = [
                "What significant insight, realization, or 'aha!' moment came to me today, and what does it mean for me?",
                "How did I honor my intuition or inner guidance today? If I didn't, what got in the way, and how can I listen more closely next time?",
                "Describe a small act of kindness or compassion I performed or witnessed. How did it make me/others feel?",
                "Is there anything I need to forgive myself or others for today? What would releasing this burden feel like?"
            ];
            
            switch(type) {
                case 'daily':
                    promptsHTML += `
                        <li>What was the most significant or memorable moment of my day and why did it stand out?</li>
                        <li>What challenges, internal or external, did I face today? How did I respond? What could I learn or do differently next time?</li>
                        <li>What am I genuinely grateful for today (list 3-5 specific things, people, or experiences)?</li>
                        <li>What did I learn about myself, others, or the world around me today?</li>
                        <li>How can I make tomorrow even more aligned with my highest self, values, and intentions?</li>
                        <li>${commonPrompts[0]}</li>
                        <li>What emotion was most prevalent for me today, and what message might it hold?</li>
                    `;
                    break;
                case 'gratitude':
                    promptsHTML += `
                        <li>List 5-10 things you are deeply grateful for right now and describe the specific feeling each brings (e.g., "My comfortable bed - feeling of safety and rest").</li>
                        <li>Describe a person you are profoundly grateful for and the specific positive impact they've had on your life. Consider writing them a thank you note or telling them.</li>
                        <li>What simple pleasure, unexpected joy, or moment of beauty did you experience today? Savor it in your writing.</li>
                        <li>Reflect on a past challenge or difficulty. What strengths did it help you uncover, or what positive outcomes eventually emerged, that you're grateful for now?</li>
                        <li>What aspect of nature (a tree, the sky, an animal, a flower) are you thankful for today and why? How does it connect you to something larger?</li>
                        <li>${commonPrompts[2]}</li>
                        <li>What skill or talent do you possess that you are grateful for? How can you use it more?</li>
                    `;
                    break;
                case 'manifestation':
                    promptsHTML += `
                        <li>Clearly and vividly describe what you are calling into your life. Write in the present tense as if it's already your joyful reality. Engage all senses.</li>
                        <li>Why do you desire this manifestation? What core feelings (joy, peace, freedom, security, love) will it bring you? Connect deeply with these feelings.</li>
                        <li>What inspired actions, however small, can you take today or this week to align with this manifestation and signal your readiness to the Universe?</li>
                        <li>Identify any limiting beliefs, fears, or doubts that might be blocking this manifestation. How can you lovingly transform, release, or reframe them into empowering beliefs?</li>
                        <li>Write a letter of profound gratitude to the Universe (or your Higher Self) for this manifestation, as if it has already arrived and you are celebrating its presence in your life.</li>
                        <li>${commonPrompts[1]}</li>
                        <li>What evidence or synchronicities have you noticed recently that suggest your manifestation is drawing closer?</li>
                    `;
                    break;
                case 'moon':
                    const currentPhaseResult = moonPhases.calculatePhase();
                    const currentPhaseName = currentPhaseResult.name;
                    promptsHTML += `
                        <li>Today's Moon Phase: ${currentPhaseName} (${Math.round(currentPhaseResult.illumination)}% illuminated). How does this specific lunar energy resonate with your current feelings, energy levels, and experiences today?</li>
                        <li>Reflect on the traditional influence of the ${currentPhaseName}: (${moonPhases.getInfluence(currentPhaseName)}). How can you consciously work with this potent energy in your life right now?</li>
                        <li>If New Moon: What potent intentions are you planting for this new cycle? What seeds of desire are you sowing? If Full Moon: What are you illuminating within yourself? What are you ready to joyfully release or celebrate the culmination of?</li>
                        <li>How are your emotions, intuition, dreams, and energy levels fluctuating with this current moon cycle? Are you noticing any patterns?</li>
                        <li>What dreams or synchronicities have you experienced recently that might be linked to the lunar influence or messages from your subconscious?</li>
                        <li>${commonPrompts[3]}</li>
                        <li>What rituals or practices feel most aligned with this moon phase for you (e.g., intention setting, releasing, gratitude, divination)?</li>
                    `;
                    break;
                case 'shadow':
                    promptsHTML += `
                        <li>What situations, types of people, or specific behaviors trigger strong negative emotional reactions (anger, jealousy, judgment, fear) in you? What might this reveal about your own unacknowledged or "shadow" aspects?</li>
                        <li>What qualities do you strongly dislike or judge in others? Explore with compassion if you might possess these traits in a hidden, denied, or projected way.</li>
                        <li>What fears, insecurities, or vulnerabilities are you currently avoiding or suppressing? Gently bring them to light in your writing without judgment. What do they need from you?</li>
                        <li>Describe a past mistake, failure, or regret. What shame or guilt do you still carry? What lessons can be integrated for healing, self-forgiveness, and growth?</li>
                        <li>What parts of yourself do you keep hidden from the world, or even from yourself, for fear of judgment or rejection? Why? What would it take to lovingly embrace and integrate them?</li>
                        <li>When do you feel most inauthentic or like you're wearing a mask? What's underneath that mask? What are you protecting?</li>
                        <li>Explore a recurring negative pattern in your life. What underlying belief or fear might be fueling it?</li>
                    `;
                    break;
                case 'dreams':
                    promptsHTML += `
                        <li>Describe your most recent or vivid dream in as much detail as possible ‚Äì characters, setting, plot, colors, symbols, dialogues, and any unusual elements.</li>
                        <li>What were the predominant emotions you felt during the dream and immediately upon waking? How does this feeling relate to your current waking life?</li>
                        <li>Are there any characters, objects, or scenarios in the dream that have direct parallels or symbolic connections to your current waking life situations, relationships, thoughts, or challenges?</li>
                        <li>What might your subconscious be trying to communicate to you through this dream? What is the core message, lesson, or insight? Consider multiple interpretations.</li>
                        <li>If you could re-enter the dream and ask one dream character a question, or change one thing, what would it be and why?</li>
                        <li>${commonPrompts[0]}</li>
                        <li>Are there any recurring symbols, themes, or dream settings you've noticed lately? What might they signify collectively?</li>
                    `;
                    break;
            }
            promptsHTML += '</ul>';
            promptsContainer.innerHTML = promptsHTML;
        }

        function saveJournalEntry() {
            const text = document.getElementById('journalText').value;
            const type = document.getElementById('journalType').value;
            const date = new Date().toISOString();
            
            if (text.trim() === '') {
                alert('Please write something in your journal entry before saving.');
                return;
            }
            
            const entry = { id: Date.now(), date, type, text }; 
            let entries = JSON.parse(localStorage.getItem('cosmicJournalEntries')) || [];
            entries.unshift(entry); 
            localStorage.setItem('cosmicJournalEntries', JSON.stringify(entries));
            
            document.getElementById('journalText').value = ''; 
            alert('Journal entry saved successfully!');
            loadSavedJournalEntries();
        }

        function loadSavedJournalEntries() {
            const container = document.getElementById('savedEntries');
            container.innerHTML = '<h3>Saved Entries:</h3>';
            let entries = JSON.parse(localStorage.getItem('cosmicJournalEntries')) || [];
            
            if (entries.length === 0) {
                container.innerHTML += '<p>No saved journal entries yet. Start writing!</p>';
                return;
            }
            
            entries.forEach(entry => { 
                const entryDiv = document.createElement('div');
                entryDiv.className = 'journal-entry';
                entryDiv.innerHTML = `
                    <p><strong>${new Date(entry.date).toLocaleString([], {year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'})} - ${entry.type.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</strong></p>
                    <p>${entry.text.replace(/\n/g, '<br>')}</p>
                    <button onclick="deleteJournalEntry(${entry.id})" style="background: #c0392b; color: white; border: none; padding: 5px 10px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 5px; font-size: 0.8em;">Delete</button>
                `;
                container.appendChild(entryDiv);
            });
        }

        function deleteJournalEntry(entryId) { 
            if (confirm('Are you sure you want to permanently delete this journal entry? This action cannot be undone.')) {
                let entries = JSON.parse(localStorage.getItem('cosmicJournalEntries')) || [];
                entries = entries.filter(entry => entry.id !== entryId);
                localStorage.setItem('cosmicJournalEntries', JSON.stringify(entries));
                loadSavedJournalEntries();
            }
        }
        
        function analyzeDream() {
            const description = document.getElementById('dreamDescription').value;
            const mood = document.getElementById('dreamMood').value;
            const dreamDate = document.getElementById('dreamDate').value || new Date().toISOString().split('T')[0];
            const analysisContainer = document.getElementById('dreamAnalysis');
            
            if (description.trim() === '') {
                analysisContainer.innerHTML = '<p>Please describe your dream in detail for analysis.</p>';
                return;
            }
            
            let identifiedSymbols = [];
            let interpretationText = `<h4>Dream Analysis for ${new Date(dreamDate).toLocaleDateString()} (Mood: ${mood})</h4>`;
            interpretationText += `<p><strong>Your Dream Description:</strong><br> "<em>${description.replace(/\n/g, '<br>')}</em>"</p>`;

            Object.entries(dreamSymbols).forEach(([symbolKey, meaning]) => {
                const regex = new RegExp(`\\b${symbolKey}\\b`, 'gi');
                if (description.match(regex)) {
                    identifiedSymbols.push({symbol: symbolKey.charAt(0).toUpperCase() + symbolKey.slice(1), meaning});
                }
            });

            if (identifiedSymbols.length > 0) {
                interpretationText += '<p><strong>Potential Symbols Identified and Their General Meanings:</strong></p><ul>';
                identifiedSymbols.forEach(item => {
                    interpretationText += `<li><strong>${item.symbol}:</strong> ${item.meaning}</li>`;
                });
                interpretationText += '</ul>';
            } else {
                interpretationText += '<p>No specific common symbols detected from our database based on exact keyword matches. Consider the overall narrative, feelings, and your personal associations with elements, characters, and actions in your dream. Sometimes the most potent symbols are unique to you.</p>';
            }
            
            interpretationText += `<p><strong>General Interpretation Considering Mood (${mood}):</strong></p>`;
            switch(mood) {
                case 'positive':
                    interpretationText += '<p>A positive dream often indicates subconscious alignment, resolution of inner conflicts, affirmation of your current path, or incoming positive energy. The symbols, even if seemingly unusual, likely point towards growth opportunities, wish fulfillment, a sense of hope, encouragement from your inner self, or successful integration of experiences.</p>';
                    break;
                case 'neutral':
                    interpretationText += '<p>A neutral dream might be your subconscious mind processing daily events, exploring possibilities without strong emotional charge, or offering objective insights and observations. The symbols could be reflections of your current state of mind, simple mental sorting, or preparation for upcoming decisions. Pay attention to subtle clues.</p>';
                    break;
                case 'negative':
                    interpretationText += '<p>Negative dreams, while unsettling, can be highly valuable. They often highlight underlying anxieties, unresolved conflicts, suppressed fears, unacknowledged shadow aspects, or warnings from your intuition. The symbols could represent challenges to be faced, aspects of yourself needing attention, healing, and integration, or areas where you feel powerless. View these as important clues for growth and self-awareness rather than literal predictions of negative events.</p>';
                    break;
                case 'confusing':
                    interpretationText += '<p>Confusing dreams often signify a period of uncertainty, complex subconscious processing, conflicting desires or information overload. The symbols might seem contradictory, illogical, or rapidly shifting. Try to focus on the core feeling or any recurring theme, even if the narrative is jumbled. It may reflect a current state of indecision, transition, or a need for greater clarity in your waking life.</p>';
                    break;
                case 'prophetic':
                    interpretationText += '<p>If you feel your dream was prophetic or precognitive, pay very close attention to its details, your intuition about it, and any synchronicities or events that follow in your waking life. Such dreams can offer glimpses into potential future timelines, deep spiritual insights, or important warnings. Journaling about the dream and subsequent events can help clarify its meaning and significance for you. Approach with discernment and openness, but avoid becoming overly fixated or fearful.</p>';
                    break;
            }
            interpretationText += `<p><strong>Further Reflection Questions to Deepen Your Understanding:</strong></p>
            <ul>
                <li>How do the identified symbols (or the overall theme if no specific symbols were matched) and your dream mood relate to your current waking life situations, thoughts, and emotions? What is happening in your life right now?</li>
                <li>What was the most vivid or emotionally charged part of the dream? What image or feeling stands out most?</li>
                <li>Were there any recurring themes, characters, or patterns from previous dreams?</li>
                <li>If this dream were a message from your higher self, your subconscious, or a wise guide, what would it be trying to tell you? What action, if any, is it inviting you to take?</li>
                <li>How did you feel *in* the dream, versus how you felt *upon waking* from the dream? Any differences?</li>
            </ul>
            <p><em>Remember, dream interpretation is a deeply personal and intuitive process. These are general insights to stimulate your own reflection. Your own feelings and associations with the dream elements are the ultimate guide to its unique meaning for you.</em></p>`;
            
            analysisContainer.innerHTML = interpretationText;
        }

        function populateDreamSymbolGrid() {
            const container = document.getElementById('dreamSymbols');
            if (!container.querySelector('h4')) { 
                container.innerHTML = '<h4>Common Dream Symbols (click to add to description):</h4>';
            }
            const existingSymbols = container.querySelectorAll('.symbol-card');
            existingSymbols.forEach(s => s.remove());

            Object.keys(dreamSymbols).sort().forEach(symbolKey => { 
                const card = document.createElement('div');
                card.className = 'symbol-card';
                card.textContent = symbolKey.charAt(0).toUpperCase() + symbolKey.slice(1);
                card.title = dreamSymbols[symbolKey]; 
                card.onclick = () => {
                    const dreamDesc = document.getElementById('dreamDescription');
                    const currentText = dreamDesc.value;
                    const selectionStart = dreamDesc.selectionStart;
                    const selectionEnd = dreamDesc.selectionEnd;
                    const spaceBefore = (selectionStart > 0 && currentText[selectionStart-1] !== ' ') ? ' ' : '';
                    const textToInsert = spaceBefore + symbolKey + ' ';
                    
                    dreamDesc.value = currentText.substring(0, selectionStart) + textToInsert + currentText.substring(selectionEnd);
                    dreamDesc.focus();
                    dreamDesc.selectionStart = dreamDesc.selectionEnd = selectionStart + textToInsert.length;
                };
                container.appendChild(card);
            });
        }

        function updateRituals() {
            const purpose = document.getElementById('ritualPurpose').value;
            const signKey = document.getElementById('ritualSign').value;
            const container = document.getElementById('ritualInstructions');
            
            if (!signKey) {
                container.innerHTML = '<p>Please select your Zodiac sign to personalize the ritual guidance.</p>';
                return;
            }
            
            const signData = zodiacSigns[signKey];
            let ritualHTML = `<h3>${purpose.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())} Ritual for ${signData.name} (${signData.symbol})</h3>`;
            ritualHTML += `<p>This ritual framework is designed to align with your ${signData.name} energy and the intention of ${purpose.replace(/-/g, ' ')}. Feel free to adapt it intuitively to your personal preferences, spiritual beliefs, and available tools. The most important ingredient is your focused intention and heartfelt presence.</p>`;
            ritualHTML += `<h4>General Preparation for Any Sacred Ritual:</h4><ul>
                <li><strong>Clarify Your Intention:</strong> Be very clear, specific, and positive about what you wish to achieve or experience with this ritual. Writing it down can amplify its power (e.g., "My intention is to release all fear and embrace courage for my new project.").</li>
                <li><strong>Create Sacred Space:</strong> Choose a quiet, undisturbed place where you feel comfortable and safe. Cleanse it physically first, then energetically (e.g., with sage or palo santo smoke, sound from a bell or singing bowl, by visualizing pure white light filling the space, or by sprinkling blessed water/salt water).</li>
                <li><strong>Gather Symbolic Tools (suggestions, choose what resonates):</strong>
                    <ul>
                        <li>A candle (color suggestions: White for all-purpose/purity/New Moon; Silver/White for Full Moon; Green/Gold for abundance; Pink/Red for love; Blue for healing/peace; Purple for spirituality. For your sign, ${signData.element === 'Fire' ? 'Red, Orange, or Gold' : signData.element === 'Earth' ? 'Green, Brown, or Black' : signData.element === 'Air' ? 'Yellow, Light Blue, or White' : 'Blue, Silver, or Indigo'} can also align powerfully.)</li>
                        <li>Crystals: ${signData.crystals[0]} or ${signData.crystals[1]} (sign-specific), and/or crystals specific to the ritual's purpose (e.g., Rose Quartz for love, Citrine for abundance, Black Tourmaline for protection, Amethyst for wisdom).</li>
                        <li>Pen and paper (for writing intentions, releases, or affirmations).</li>
                        <li>A fire-safe bowl or cauldron (if burning paper is part of your ritual).</li>
                        <li>Optional: Incense (e.g., Frankincense for spirituality/cleansing, Sandalwood for grounding, Lavender for peace/healing, Rose for love), a representation of your sign's element (${signData.element} ‚Äì e.g., a feather for Air, a stone for Earth), a glass of water (for Water element or grounding).</li>
                    </ul>
                </li>
                <li><strong>Ground & Center Yourself:</strong> Before beginning, take several deep, conscious breaths. Feel your connection to the Earth beneath you and the Sky above. Release any tension or distracting thoughts. You might say a short prayer or invocation to your higher self, guides, or divine source for support and guidance.</li>
            </ul>`;
            ritualHTML += `<h4>The Ritual Steps (Adapt as Guided):</h4><ol>`;
            
            switch(purpose) {
                case 'new-moon':
                    ritualHTML += `<li><strong>Opening:</strong> Cast a sacred circle if this is part of your practice, calling in supportive energies, elements, or guides. Light your candle, focusing on the darkness of the New Moon as a fertile void, potent for new beginnings and planting seeds of desire.</li><li><strong>Meditation & Visualization:</strong> Hold your chosen crystal(s). Meditate for a few minutes on what you wish to manifest in the upcoming lunar cycle. Feel the possibility and excitement of this new potential. Clearly visualize your desired outcome as if it is already happening.</li><li><strong>Writing Intentions:</strong> On your paper, write down 2-3 clear, positive intentions in the present tense (e.g., "I am attracting abundant opportunities that align with my soul's purpose," "I am open to and joyfully receiving a loving, supportive new friendship," "I am courageously taking inspired action towards my creative project.").</li><li><strong>Charging Intentions:</strong> Read your intentions aloud with conviction, passion, and heartfelt feeling. Visualize them already manifest. Feel the joy, gratitude, and peace of their fulfillment. You can place your hands over your written intentions, infusing them with your energy.</li><li><strong>Offering Intentions:</strong> You can choose to:<ul><li>Fold the paper and place it on your altar or a special, sacred place with your crystal on top, to be revisited throughout the month.</li><li>Safely burn the paper in your fire-safe bowl, visualizing the smoke carrying your intentions to the universe for manifestation.</li><li>Plant the paper in a pot with a seed, symbolizing the growth of your intentions with the seed.</li></ul></li><li><strong>Gratitude & Closing:</strong> Spend a few moments in deep gratitude for the intentions set and the universal support you are receiving. Thank any guides or energies you invoked. If you cast a circle, formally close it. Safely extinguish the candle, knowing your work is done and your intentions are set in motion.</li>`;
                    break;
                case 'full-moon':
                    ritualHTML += `<li><strong>Opening:</strong> Cast a sacred circle if practiced. Light your candle, acknowledging the illuminating, potent, and peak energy of the Full Moon.</li><li><strong>Reflection & Identification:</strong> Hold your chosen crystal(s). Meditate on what you are ready to release and let go of: limiting beliefs, old patterns, unhealthy habits, stagnant emotional baggage, or anything that no longer serves your highest good and evolution.</li><li><strong>Writing for Release:</strong> On separate small slips of paper, write down each specific thing you wish to release. Be honest and thorough.</li><li><strong>Act of Releasing:</strong> One by one, hold each slip of paper. Read what's written aloud. Then say with conviction, "I now fully and completely release [what's written] with love and gratitude for the lessons it has taught me. I let it go from my life, my body, my mind, and my spirit, across all timelines and dimensions."</li><li><strong>Transformation:</strong> Safely burn each slip of paper in your fire-safe bowl (or tear it up forcefully and discard it if burning isn't safe/possible), visualizing the energy being transformed into pure light, neutral energy, or being returned to the Earth for composting. Feel the lightness as you release.</li><li><strong>Inviting Anew (Optional):</strong> After releasing, take a moment to feel the space created within you. You can then write down an affirmation of what positive quality or energy you are now inviting in to fill that space (e.g., "I invite peace, clarity, and self-love into my being.").</li><li><strong>Gratitude & Closing:</strong> Express profound gratitude for the release, the healing, and the wisdom gained. Thank the Full Moon, your guides, and any energies invoked. Close your circle. Safely extinguish the candle. Consider a cleansing salt bath or shower afterwards to complete the purification.</li>`;
                    break;
                 case 'protection':
                    ritualHTML += `<li><strong>Opening:</strong> Cast a circle. Light a white (for purity/all-purpose protection) or black (for absorbing/repelling negativity) candle.</li><li><strong>Crystal Empowerment:</strong> Hold a protective crystal (e.g., Black Tourmaline, Obsidian, Selenite, Labradorite). Charge it with your intention for unwavering protection.</li><li><strong>Shielding Visualization:</strong> Close your eyes. Visualize a brilliant, impenetrable shield of shimmering white, electric blue, or golden light completely surrounding you, extending above your head and below your feet, forming a complete sphere or egg shape. See this shield as strong, flexible, and impermeable to any and all negativity, psychic attack, or harmful influences, yet fully permeable to love, light, and positive energies.</li><li><strong>Powerful Affirmation:</strong> Affirm aloud with power and conviction: "I am divinely protected by a shield of impenetrable light. Only energies of the highest good, love, and light may enter my space. I am safe, secure, sovereign, and grounded in my power. So it is." Repeat 3 or more times, feeling the truth of these words.</li><li><strong>Anointing/Sealing (Optional):</strong> You can anoint doorways and windows of your home with protective essential oils (e.g., rosemary, sandalwood, frankincense, diluted) or visualize sealing them with protective symbols or light. You can also sprinkle blessed salt or black salt at thresholds.</li><li><strong>Gratitude & Closing:</strong> Thank your guides, guardians, ancestors, and the universe for their unwavering protection and support. Feel their presence. Close the circle. Extinguish the candle when you feel the ritual is complete, or allow it to burn down safely if appropriate.</li>`;
                    break;
                case 'abundance':
                    ritualHTML += `<li><strong>Opening:</strong> Cast a circle. Light a green (for growth/money) or gold (for prosperity/success) candle.</li><li><strong>Crystal Connection:</strong> Hold a crystal for abundance (e.g., Citrine, Pyrite, Green Aventurine, Jade). Connect with its energy, feeling its prosperous vibration.</li><li><strong>Visioning Abundance:</strong> On paper, write down your financial goals, or more broadly, describe your ideal state of holistic abundance ‚Äì including vibrant health, joyful relationships, fulfilling work, creative expression, spiritual connection, as well as financial prosperity. Focus on feelings of gratitude, worthiness, and joyful expectation, not on current lack.</li><li><strong>Embodying Abundance:</strong> Close your eyes and vividly visualize yourself already living in this state of complete abundance. How does it feel? What does your life look like? What are you doing, sharing, experiencing? Immerse yourself in this reality, engaging all your senses. Feel the gratitude, joy, and security of this manifested state.</li><li><strong>Affirming Abundance:</strong> Affirm aloud with joy and conviction: "I am a magnet for abundance and prosperity in all its forms. Wealth, opportunities, health, love, and blessings flow to me easily, joyfully, and effortlessly. I am worthy and deserving of all good things. I am grateful for all that I have and all that is now coming to me. And so it is."</li><li><strong>Anchor Point:</strong> Place your written intentions with your abundance crystal on an altar, in your wallet, near your workspace, or another significant place. You can keep the candle (safely) burning for a while if possible, or relight it daily while re-affirming your intentions.</li><li><strong>Gratitude & Closing:</strong> Thank the universe, your higher self, and any abundance guides for their support. Close the circle. Extinguish the candle when ready, feeling confident in your co-creative power.</li>`;
                    break;
                 case 'love':
                    ritualHTML += `<li><strong>Opening:</strong> Cast a circle. Light a pink (for gentle love, self-love, friendship) or red (for passionate love, romance) candle.</li><li><strong>Heart Connection:</strong> Hold a love-attracting crystal (e.g., Rose Quartz, Rhodonite, Emerald, Morganite) over your heart chakra. Breathe deeply, opening your heart.</li><li><strong>Intention Setting for Love:</strong> On paper, write down the qualities you wish to attract in a partner, or the ways you wish to enhance an existing relationship, or your intentions for greater self-love and compassion. Focus on feelings and qualities rather than specific people (unless working on an existing relationship).</li><li><strong>Visualization of Love:</strong> Close your eyes. If seeking a new partner, visualize the *feeling* of being in a loving, supportive, joyful relationship. If enhancing a current one, visualize ideal interactions. If for self-love, see yourself radiating love and acceptance towards yourself. Feel the warmth, joy, and connection.</li><li><strong>Affirmation for Love:</strong> Affirm aloud: "My heart is open to give and receive love. I attract loving, harmonious, and respectful relationships. I am worthy of deep, fulfilling love. I am love." (Adapt as needed for your specific intention).</li><li><strong>Symbolic Offering:</strong> You can place your written intention with your crystal near your bed, on an altar, or carry it with you. You might also anoint yourself with rose or jasmine essential oil (diluted).</li><li><strong>Gratitude & Closing:</strong> Thank the universe, Aphrodite/Venus, or any love deities/guides for blessing your love life. Close the circle. Extinguish the candle, trusting that love is flowing to and through you.</li>`;
                    break;
                case 'healing':
                    ritualHTML += `<li><strong>Opening:</strong> Cast a circle. Light a blue (for calm, peace) or green (for physical healing, growth) or white (for purification, all-purpose healing) candle.</li><li><strong>Crystal for Healing:</strong> Hold a healing crystal (e.g., Clear Quartz, Amethyst, Selenite, Fluorite, specific crystals for certain ailments).</li><li><strong>Identifying Area of Healing:</strong> Gently bring to mind the aspect of yourself (physical, emotional, mental, spiritual) that you wish to bring healing to. Approach this with compassion and non-judgment.</li><li><strong>Visualization of Healing Light:</strong> Close your eyes. Visualize a radiant, healing light (e.g., emerald green, sapphire blue, golden white) from a divine source or from deep within the Earth, flowing into the area needing healing. See this light cleansing, repairing, soothing, and restoring perfect balance and wholeness. Imagine any pain or imbalance dissolving and being replaced by vibrant health and peace.</li><li><strong>Affirmation for Wholeness:</strong> Affirm aloud: "I am open and receptive to profound healing on all levels of my being. My body, mind, and spirit are returning to perfect balance, harmony, and vibrant health. I release all that hinders my well-being. I am whole and complete."</li><li><strong>Directing Energy:</strong> You may gently place your hands on or over the area needing healing, visualizing healing energy flowing from your hands. If healing an emotional wound, you might place hands on your heart.</li><li><strong>Gratitude & Closing:</strong> Thank your body for its resilience, your spirit for its strength, and the universe/guides for the healing energies. Close the circle. Extinguish the candle, trusting in your innate healing capacity.</li>`;
                    break;
                case 'wisdom':
                    ritualHTML += `<li><strong>Opening:</strong> Cast a circle. Light a purple (for spiritual wisdom) or yellow (for mental clarity, learning) candle.</li><li><strong>Crystal for Insight:</strong> Hold a crystal associated with wisdom and clarity (e.g., Lapis Lazuli, Sodalite, Amethyst, Clear Quartz, Fluorite).</li><li><strong>Posing the Question/Seeking Clarity:</strong> Clearly formulate the question you seek wisdom on, or the area where you desire greater clarity and understanding. Write it down.</li><li><strong>Meditation for Insight:</strong> Close your eyes. Focus on your breath. Invite wisdom and clarity to flow to you. You might visualize yourself in a sacred library, or on a mountaintop, or meeting a wise guide. Be open and receptive to any insights, images, feelings, or intuitive nudges that arise. Don't force it; allow wisdom to unfold naturally.</li><li><strong>Affirmation for Wisdom:</strong> Affirm aloud: "I am open to divine wisdom and inner guidance. Clarity illuminates my path. I trust my intuition and make wise decisions. I am connected to universal knowledge."</li><li><strong>Journaling Insights:</strong> After your meditation, take time to journal any thoughts, feelings, or insights that came through, even if they seem small or unrelated at first.</li><li><strong>Gratitude & Closing:</strong> Thank your higher self, spirit guides, or any sources of wisdom you feel connected to. Close the circle. Extinguish the candle, knowing that clarity will continue to unfold.</li>`;
                    break;
                case 'seasonal':
                    const seasons = ["Spring Equinox (New Beginnings, Balance)", "Summer Solstice (Peak Energy, Abundance)", "Autumn Equinox (Harvest, Gratitude, Balance)", "Winter Solstice (Rest, Reflection, Rebirth)"];
                    const currentApproxSeason = seasons[Math.floor((new Date().getMonth() / 3)) % 4];
                    ritualHTML += `<li><strong>Opening:</strong> Cast a circle, acknowledging the current season (${currentApproxSeason}). Light a candle appropriate for the season (e.g., pastels for Spring, bright gold/yellow for Summer, orange/brown for Autumn, white/blue for Winter).</li><li><strong>Connecting with Seasonal Energy:</strong> Meditate on the specific energies and themes of the current season. What is nature teaching you at this time? How can you align your personal energies with the cycle of the Earth?</li><li><strong>Symbolic Representation:</strong> Gather natural items that represent the season (e.g., flowers for Spring, sun symbols for Summer, fallen leaves for Autumn, evergreen sprigs for Winter) and place them on your altar or in your sacred space.</li><li><strong>Seasonal Intention/Reflection:</strong> Depending on the season:<ul><li><strong>Spring:</strong> Set intentions for new growth, projects, and personal blossoming.</li><li><strong>Summer:</strong> Celebrate achievements, express joy and creativity, nurture what you've planted.</li><li><strong>Autumn:</strong> Express gratitude for your harvests (literal or metaphorical), release what's no longer needed, find balance.</li><li><strong>Winter:</strong> Rest, reflect on the past year, go within for deep wisdom, prepare for future rebirth.</li></ul>Write down your reflections or intentions.</li><li><strong>Offering/Gratitude:</strong> Make a small offering to the Earth or Spirit (e.g., seeds, water, incense, a song, a heartfelt thank you) in honor of the season.</li><li><strong>Closing:</strong> Thank the spirit of the season and any energies invoked. Close the circle. Extinguish the candle, carrying the seasonal blessings with you.</li>`;
                    break;
                default: 
                    ritualHTML += `<li>Set your specific intention for ${purpose.replace(/-/g, ' ')}. Light your candle, focusing your mind.</li><li>Meditate on this intention for several minutes, holding relevant crystals and visualizing your desired outcome.</li><li>Perform a symbolic action that represents your intention: this could be writing it down and anointing the paper, speaking it aloud with power, creating a small symbolic craft, or making a vow to yourself.</li><li>Affirm your intention as already manifest and express profound gratitude for its fulfillment.</li><li>Close the ritual space, feeling the energy of your intention anchored. Safely extinguish the candle.</li>`;
            }
            ritualHTML += `</ol>`;
            ritualHTML += `<p><strong>${signData.name} (${signData.element}, ${signData.quality}) Enhancement:</strong> As a ${signData.element} ${signData.quality} sign, you might enhance this ritual by:
                ${signData.element === 'Fire' ? `Incorporating more active movement, passionate declarations, using more candles or fire elements (safely!), and focusing on inspired action after the ritual.` : ''}
                ${signData.element === 'Earth' ? `Performing it outdoors if possible, using actual earth, stones, or plants, focusing on tangible outcomes and patient, steady manifestation. Grounding deeply before and after.` : ''}
                ${signData.element === 'Air' ? `Emphasizing spoken affirmations, writing detailed intentions or scripts, using specific incense or sound (bells, singing bowls, music), and mentally rehearsing your success.` : ''}
                ${signData.element === 'Water' ? `Using a bowl of consecrated water for scrying, cleansing, or as an offering. Focusing on the emotional connection to your intention, performing it near water if possible, or using divination tools like tarot afterwards for insight.` : ''}
                ${signData.quality === 'Cardinal' ? ` Being bold in your intentions and taking immediate first steps post-ritual.` : ''}
                ${signData.quality === 'Fixed' ? ` Creating a lasting altar or symbol for your intention and committing to long-term focus.` : ''}
                ${signData.quality === 'Mutable' ? ` Being open to multiple ways your intention can manifest and adapting your approach as needed post-ritual.` : ''}
            </p>`;
            ritualHTML += `<p><em>Always practice fire safety diligently if using candles or burning items. Trust your intuition to guide you in adapting this ritual to make it uniquely yours and most potent for your spiritual practice. The power of ritual comes from your sincere intention and belief.</em></p>`;
            container.innerHTML = ritualHTML;
        }

        function generateAffirmation() {
            const affirmation = affirmations[Math.floor(Math.random() * affirmations.length)];
            document.getElementById('dailyAffirmation').textContent = affirmation;
        }

        function calculateBiorhythms() {
            const birthDateStr = document.getElementById('biorhythmBirthDate').value;
            const analysisDateStr = document.getElementById('biorhythmAnalysisDate').value; 
            if (!birthDateStr) {
                alert('Please enter your birth date to calculate biorhythms.');
                document.getElementById('biorhythmChartDisplay').innerHTML = '<p style="text-align:center; padding-top: 80px;">Enter birth date to view chart.</p>';
                updateBiorhythmDisplay('physical', 0, 23, true); 
                updateBiorhythmDisplay('emotional', 0, 28, true);
                updateBiorhythmDisplay('intellectual', 0, 33, true);
                 const extraCyclesInfo = document.getElementById('biorhythms').querySelector('.interpretation');
                 if(extraCyclesInfo) extraCyclesInfo.innerHTML = '';
                return;
            }
            if (!analysisDateStr) { 
                alert('Please select an analysis date.');
                return;
            }
            const birthDate = new Date(birthDateStr);
            const analysisDate = new Date(analysisDateStr);
            const daysAlive = Math.floor((analysisDate.getTime() - birthDate.getTime()) / (1000 * 60 * 60 * 24));
            if (daysAlive < 0) {
                alert('Analysis date cannot be before your birth date.');
                return;
            }
            const physicalCycleLength = 23;
            const emotionalCycleLength = 28;
            const intellectualCycleLength = 33;
            const intuitionCycleLength = 38;
            const aestheticCycleLength = 43;
            const awarenessCycleLength = 48;
            const spiritualCycleLength = 53;
            const physicalValue = Math.sin((2 * Math.PI * daysAlive) / physicalCycleLength);
            const emotionalValue = Math.sin((2 * Math.PI * daysAlive) / emotionalCycleLength);
            const intellectualValue = Math.sin((2 * Math.PI * daysAlive) / intellectualCycleLength);
            const intuitionValue = Math.sin((2 * Math.PI * daysAlive) / intuitionCycleLength);
            updateBiorhythmDisplay('physical', physicalValue, physicalCycleLength);
            updateBiorhythmDisplay('emotional', emotionalValue, emotionalCycleLength);
            updateBiorhythmDisplay('intellectual', intellectualValue, intellectualCycleLength);
            let extraCyclesInfo = document.getElementById('biorhythms').querySelector('.interpretation');
            if (!extraCyclesInfo) {
                extraCyclesInfo = document.createElement('div');
                extraCyclesInfo.className = 'interpretation';
                extraCyclesInfo.style.marginTop = '20px';
                document.querySelector('#biorhythms .element-info').insertAdjacentElement('afterend', extraCyclesInfo);
            }
            const aestheticValue = Math.sin((2 * Math.PI * daysAlive) / aestheticCycleLength);
            const awarenessValue = Math.sin((2 * Math.PI * daysAlive) / awarenessCycleLength);
            const spiritualValue = Math.sin((2 * Math.PI * daysAlive) / spiritualCycleLength);
            extraCyclesInfo.innerHTML = `<h4>Secondary Rhythms for ${analysisDate.toLocaleDateString()}:</h4>
            <ul>
                <li><strong>Intuition (${intuitionCycleLength} days):</strong> ${getBiorhythmStatusText((intuitionValue + 1) / 2 * 100)} (${Math.round((intuitionValue + 1) / 2 * 100)}%) - Affects intuitive insights, gut feelings, and psychic sensitivity.</li>
                <li><strong>Aesthetic (${aestheticCycleLength} days):</strong> ${getBiorhythmStatusText((aestheticValue + 1) / 2 * 100)} (${Math.round((aestheticValue + 1) / 2 * 100)}%) - Influences appreciation for beauty, artistic sensitivity, creativity, and harmony.</li>
                <li><strong>Awareness (${awarenessCycleLength} days):</strong> ${getBiorhythmStatusText((awarenessValue + 1) / 2 * 100)} (${Math.round((awarenessValue + 1) / 2 * 100)}%) - Relates to perception, learning new things easily, and understanding of your surroundings and complex situations.</li>
                <li><strong>Spiritual (${spiritualCycleLength} days):</strong> ${getBiorhythmStatusText((spiritualValue + 1) / 2 * 100)} (${Math.round((spiritualValue + 1) / 2 * 100)}%) - Connects to your sense of inner peace, purpose, connection to something larger than yourself, and faith.</li>
            </ul>
            <p><em>Positive phases generally enhance these qualities, making it a good time to engage in related activities. Negative or low phases suggest a time for introspection, rest, or lower sensitivity/energy in these areas. Critical days (near the zero line, or transitional) can be unstable or bring heightened awareness to the cycle's themes. Use this information as a guide for self-awareness and planning.</em></p>`;
            drawBiorhythmChart(daysAlive, analysisDate);
        }
        
        function getBiorhythmStatusText(percentage) {
            if (percentage > 90) return "Peak Performance / Very High";
            else if (percentage > 70) return "High Energy / Favorable";        
            else if (percentage > 55) return "Positive / Above Average"; 
            else if (percentage >= 45 && percentage <= 55) return "Transitional / Critical Day"; 
            else if (percentage > 25) return "Low Energy / Recharge Phase"; 
            else if (percentage > 10) return "Very Low / Rest Recommended";
            else return "Deep Recharge / Recuperation"; 
        }

        function updateBiorhythmDisplay(cycleName, value, cycleLength, reset = false) {
            const bar = document.getElementById(`${cycleName}Bar`);
            const statusEl = document.getElementById(`${cycleName}Status`); 
            if (reset) {
                bar.style.width = `50%`;
                bar.style.background = `rgba(255, 255, 255, 0.2)`;
                statusEl.textContent = `Awaiting calculation...`;
                return;
            }
            const percentage = (value + 1) / 2 * 100; 
            bar.style.width = `${percentage}%`;
            const statusText = getBiorhythmStatusText(percentage);
            statusEl.textContent = `${statusText} (${Math.round(percentage)}%)`;
            if (statusText.includes("Critical")) {
                 bar.style.background = `linear-gradient(90deg, #ffd700, #ffaa00)`; 
            } else if (percentage > 55) { 
                bar.style.background = `linear-gradient(90deg, #a8e063, #56ab2f)`; 
            } else { 
                 bar.style.background = `linear-gradient(90deg, #ff4b1f, #ff9068)`; 
            }
        }
        
        function drawBiorhythmChart(currentDayInCycleForAnalysisDate, analysisDate) {
            const chartContainer = document.getElementById('biorhythmChartDisplay'); 
            chartContainer.innerHTML = ''; 
            const canvas = document.createElement('canvas');
            canvas.width = chartContainer.offsetWidth > 0 ? chartContainer.offsetWidth - 20 : 300; 
            canvas.height = chartContainer.offsetHeight > 0 ? chartContainer.offsetHeight -20 : 200;
            chartContainer.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            const daysToDisplayTotal = 30; 
            const daysBefore = Math.floor(daysToDisplayTotal / 2); 
            const cycleDefinitions = [
                { name: 'Physical', length: 23, color: '#2ecc71', symbol: 'P' }, 
                { name: 'Emotional', length: 28, color: '#e74c3c', symbol: 'E' }, 
                { name: 'Intellectual', length: 33, color: '#3498db', symbol: 'I' } 
            ];
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            const yZero = canvas.height / 2;
            ctx.beginPath(); 
            ctx.moveTo(0, yZero);
            ctx.lineTo(canvas.width, yZero);
            ctx.stroke();
            ctx.fillText("0%", canvas.width - 15, yZero - 2); 
            ctx.fillText("+100%", canvas.width - 25, 12);
            ctx.fillText("-100%", canvas.width - 25, canvas.height - 5);
            const xToday = canvas.width / 2; 
            ctx.beginPath(); 
            ctx.setLineDash([2, 2]); 
            ctx.moveTo(xToday, 0);
            ctx.lineTo(xToday, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]); 
            ctx.fillText(analysisDate.toLocaleDateString('en-US', {month:'short', day:'numeric'}), xToday, canvas.height - 5);
            for(let i = 0; i <= daysToDisplayTotal; i++) { 
                const xPos = (i / daysToDisplayTotal) * canvas.width;
                const dateForLabel = new Date(analysisDate.getTime() + (i - daysBefore) * 24*60*60*1000);
                if (i % 5 === 0 && i !== daysBefore) { 
                    ctx.fillText(dateForLabel.toLocaleDateString('en-US', {month:'short', day:'numeric'}), xPos, canvas.height - 5);
                }
                ctx.beginPath();
                ctx.moveTo(xPos, 0);
                ctx.lineTo(xPos, canvas.height);
                ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                ctx.stroke();
                ctx.strokeStyle = 'rgba(255,255,255,0.2)'; 
            }
            cycleDefinitions.forEach((cycle, index) => {
                ctx.strokeStyle = cycle.color;
                ctx.fillStyle = cycle.color;
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                for (let i = 0; i <= daysToDisplayTotal; i++) {
                    const dayOffsetFromWindowStart = currentDayInCycleForAnalysisDate - daysBefore + i;
                    const value = Math.sin((2 * Math.PI * dayOffsetFromWindowStart) / cycle.length);
                    const x = (i / daysToDisplayTotal) * canvas.width;
                    const y = yZero * (1 - value); 
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
                const legendY = 10 + (index * 15); 
                ctx.fillText(`${cycle.symbol} (${cycle.length}d)`, 30, legendY);
                ctx.beginPath();
                ctx.moveTo(5, legendY - 4); 
                ctx.lineTo(15, legendY - 4);
                ctx.stroke();
            });
            ctx.lineWidth = 1; 
        }

        function populateKnowledge() {
            const container = document.getElementById('knowledgeContent');
            container.innerHTML = '';
            Object.values(zodiacSigns).forEach(sign => {
                const signDiv = document.createElement('div');
                signDiv.className = 'knowledge-section';
                const keywordsString = `${sign.name} ${sign.element} ${sign.quality} ${sign.ruler} ${sign.keywords.join(' ')} ${sign.strengths.join(' ')} ${sign.weaknesses.join(' ')} ${sign.description.substring(0,150)}`;
                signDiv.setAttribute('data-keywords', keywordsString.toLowerCase());
                signDiv.innerHTML = `
                    <h3 class="knowledge-title">${sign.symbol} ${sign.name} (${sign.dates})</h3>
                    <div class="element-card">
                        <p><strong>Element:</strong> ${sign.element}</p><p><strong>Quality (Modality):</strong> ${sign.quality}</p>
                        <p><strong>Ruling Planet:</strong> ${sign.ruler}</p><p><strong>Keywords:</strong> ${sign.keywords.join(', ')}</p>
                    </div>
                    <div class="interpretation" style="margin-top:15px;">
                        <h4>Detailed Description:</h4><p>${sign.description}</p><h4>Strengths:</h4><p>${sign.strengths.join(', ')}.</p>
                        <h4>Weaknesses (Areas for Awareness & Growth):</h4><p>${sign.weaknesses.join(', ')}.</p>
                        <h4>Harmonizing Crystals:</h4><p>${sign.crystals.join(', ')}.</p><h4>Affirmation/Mantra:</h4><p>"<em>${sign.mantra}</em>"</p>
                    </div>`;
                container.appendChild(signDiv);
            });
            const elementsData = {
                'Fire': { signs: ['Aries', 'Leo', 'Sagittarius'], description: 'Fire signs are passionate, dynamic, enthusiastic, and temperamental. They are driven by inspiration, intuition, and impulse, bringing energy, light, and courage. They are natural leaders and pioneers, seeking self-expression and adventure, but can sometimes be impatient, arrogant, or overwhelming if not balanced. Fire is about action, faith, and the creative spirit.', keywords: 'Action Passion Inspiration Courage Creativity Enthusiasm Spirit', color: '#FF4500' },
                'Earth': { signs: ['Taurus', 'Virgo', 'Capricorn'], description: 'Earth signs are grounded, practical, realistic, and sensual. They are the builders of the zodiac, valuing stability, security, and tangible results. They are reliable, patient, and persistent, focused on the material world and its resources, but can sometimes be stubborn, overly materialistic, or slow to change if not balanced. Earth is about foundation, senses, and the physical realm.', keywords: 'Stability Practicality Sensuality Reliability Foundation Material Security', color: '#228B22' },
                'Air': { signs: ['Gemini', 'Libra', 'Aquarius'], description: 'Air signs are communicative, intellectual, analytical, and sociable. They are the thinkers, communicators, and ideators of the zodiac, bringing ideas, logic, objectivity, and social connections. They are curious, fair-minded, and value freedom of thought, but can sometimes be detached, indecisive, or overly theoretical if not balanced. Air is about intellect, relationships, and the mental realm.', keywords: 'Intellect Communication Ideas Logic Sociability Objectivity Relationships', color: '#FFD700' },
                'Water': { signs: ['Cancer', 'Scorpio', 'Pisces'], description: 'Water signs are emotional, intuitive, compassionate, and imaginative. They are the feelers and healers of the zodiac, attuned to the subtle realms of emotion, dreams, and the subconscious. They are empathetic, nurturing, and deeply connected, but can sometimes be overly sensitive, moody, or absorb negative energies if not balanced and protected. Water is about emotion, intuition, and the soul realm.', keywords: 'Emotion Intuition Compassion Imagination Empathy Healing Soul', color: '#1E90FF' }
            };
            const elementsSection = document.createElement('div');
            elementsSection.className = 'knowledge-section';
            elementsSection.setAttribute('data-keywords', 'elements fire earth air water astrology fundamentals elemental properties');
            elementsSection.innerHTML = `<h3 class="knowledge-title" style="color: #FFF;">The Four Astrological Elements</h3>`;
            Object.entries(elementsData).forEach(([name, data]) => {
                elementsSection.innerHTML += `
                    <div class="element-card" style="border-left-color: ${data.color}; margin-bottom:15px;">
                        <h4 style="color: ${data.color};">${name} Signs: ${data.signs.map(s => `${zodiacSigns[s.toLowerCase()].symbol} ${s}`).join(', ')}</h4>
                        <p>${data.description}</p><p><strong>Keywords:</strong> ${data.keywords}</p>
                    </div>`;
            });
            container.appendChild(elementsSection);
            const qualitiesData = {
                'Cardinal': { signs: ['Aries', 'Cancer', 'Libra', 'Capricorn'], description: 'Cardinal signs initiate the seasons (Spring, Summer, Autumn, Winter). They are enterprising, action-oriented, and represent new beginnings and leadership. They are the starters and pioneers, eager to make things happen and set new directions. They can sometimes be too forceful or start projects they don\'t finish if not balanced by other energies. Keywords: Initiative, Action, Leadership, New Beginnings, Enterprising, Starting.', symbol: '‚ûï' },
                'Fixed': { signs: ['Taurus', 'Leo', 'Scorpio', 'Aquarius'], description: 'Fixed signs occur in the middle of the seasons, representing stability and peak energy. They are stabilizing, determined, and represent sustenance, endurance, and willpower. They are the builders and preservers, focused on maintaining and deepening what has been started. They are loyal, resolute, and purposeful, but can sometimes be stubborn, resistant to change, or inflexible if not balanced. Keywords: Stability, Determination, Endurance, Preservation, Focus, Loyalty, Willpower.', symbol: '‚óºÔ∏è' },
                'Mutable': { signs: ['Gemini', 'Virgo', 'Sagittarius', 'Pisces'], description: 'Mutable signs end the seasons, preparing for transition and change. They are adaptable, flexible, and represent resourcefulness and synthesis. They are the communicators, analyzers, and integrators, able to see multiple perspectives and adjust to circumstances. They are versatile, understanding, and open-minded, but can sometimes be indecisive, scattered, or inconsistent if not balanced. Keywords: Adaptability, Flexibility, Change, Resourcefulness, Communication, Versatility, Synthesis.', symbol: '„Ä∞Ô∏è' }
            };
            const qualitiesSection = document.createElement('div');
            qualitiesSection.className = 'knowledge-section';
            qualitiesSection.setAttribute('data-keywords', 'qualities modalities cardinal fixed mutable astrology fundamentals modes');
            qualitiesSection.innerHTML = `<h3 class="knowledge-title" style="color: #FFF;">The Three Qualities (Modalities)</h3>`;
            Object.entries(qualitiesData).forEach(([name, data]) => {
                qualitiesSection.innerHTML += `
                     <div class="element-card" style="border-left-color: #AAA; margin-bottom:15px;">
                        <h4>${data.symbol} ${name} Signs: ${data.signs.map(s => `${zodiacSigns[s.toLowerCase()].symbol} ${s}`).join(', ')}</h4>
                        <p>${data.description}</p><p><strong>Keywords:</strong> ${data.keywords}</p>
                    </div>`;
            });
            container.appendChild(qualitiesSection);
        }

        function searchKnowledge() {
            const searchTerm = document.getElementById('searchBar').value.toLowerCase().trim();
            const sections = document.querySelectorAll('#knowledgeContent .knowledge-section');
            let foundMatch = false;
            sections.forEach(section => {
                const keywords = section.getAttribute('data-keywords');
                const sectionTitle = section.querySelector('h3')?.textContent.toLowerCase() || '';
                const sectionContent = section.textContent.toLowerCase(); 
                if (searchTerm === "" || keywords.includes(searchTerm) || sectionTitle.includes(searchTerm) || sectionContent.includes(searchTerm)) {
                    section.classList.remove('hidden-by-search');
                    section.style.display = ''; 
                    foundMatch = true;
                } else {
                    section.classList.add('hidden-by-search');
                    section.style.display = 'none'; 
                }
            }); 
            let noResultsMsg = document.getElementById('noKnowledgeResultsMsg');
            if (!foundMatch && searchTerm !== "") {
                if (!noResultsMsg) {
                    noResultsMsg = document.createElement('p');
                    noResultsMsg.id = 'noKnowledgeResultsMsg';
                    noResultsMsg.style.textAlign = 'center';
                    noResultsMsg.style.marginTop = '20px';
                    document.getElementById('knowledgeContent').appendChild(noResultsMsg);
                }
                noResultsMsg.textContent = `No knowledge base entries found matching "${searchTerm}". Try a different keyword.`;
                noResultsMsg.style.display = 'block';
            } else if (noResultsMsg) {
                noResultsMsg.style.display = 'none';
            }
        }
        
        function showTab(tabId, event) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            const selectedTabContent = document.getElementById(tabId);
            if (selectedTabContent) {
                 selectedTabContent.classList.add('active');
            }
            if (event && event.currentTarget) {
                 event.currentTarget.classList.add('active');
            } else { 
                const buttons = document.querySelectorAll('.tab-button');
                buttons.forEach(button => {
                    if (button.getAttribute('onclick').includes(`showTab('${tabId}'`)) {
                        button.classList.add('active');
                    }
                });
            }
            if (tabId === 'calendar') {
                generateCalendar(); 
                updateMoonPhaseDisplay();
            } else if (tabId === 'planets') {
                updatePlanetTracker(); 
            } else if (tabId === 'journal') {
                loadSavedJournalEntries(); 
                updateJournalPrompts(); 
            } else if (tabId === 'tarot') {
                setupTarotReading(); 
            } else if (tabId === 'biorhythms') {
                if (document.getElementById('biorhythmBirthDate') && document.getElementById('biorhythmBirthDate').value) {
                     calculateBiorhythms(); 
                } else {
                     document.getElementById('biorhythmChartDisplay').innerHTML = '<p style="text-align:center; padding-top: 80px;">Enter birth date to view chart.</p>';
                     updateBiorhythmDisplay('physical', 0, 23, true); 
                     updateBiorhythmDisplay('emotional', 0, 28, true);
                     updateBiorhythmDisplay('intellectual', 0, 33, true);
                     const extraCyclesInfoBio = document.getElementById('biorhythms').querySelector('.interpretation');
                     if(extraCyclesInfoBio) extraCyclesInfoBio.innerHTML = '';
                }
            } else if (tabId === 'knowledge') {
                 if (!document.getElementById('knowledgeContent').hasChildNodes()) { 
                    populateKnowledge();
                 }
                searchKnowledge(); 
            } else if (tabId === 'meditation') {
                 updateMeditation(); 
            } else if (tabId === 'dreams') {
                if (!document.getElementById('dreamSymbols').querySelector('.symbol-card')) { 
                    populateDreamSymbolGrid(); 
                }
            } else if (tabId === 'birth-chart') {
                const birthDateEl = document.getElementById('birthDateInput');
                const birthTimeEl = document.getElementById('birthTimeInput');
                if (birthDateEl && birthTimeEl && birthDateEl.value && birthTimeEl.value) {
                    generateBirthChart();
                } else {
                    document.getElementById('birthChartAnalysis').innerHTML = '<p>Enter your birth details to generate your (simulated) natal chart and cosmic blueprint.</p>';
                    document.getElementById('birthChartWheel').innerHTML = '';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>